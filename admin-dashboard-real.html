<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZimCrowd Admin Dashboard - Real Data</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #f8fafc;
            color: #1a202c;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Demo Badge */
        .demo-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f59e0b;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Sidebar */
        .admin-sidebar {
            width: 280px;
            background: #1a202c;
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #2d3748;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .admin-logo i {
            font-size: 24px;
            color: #667eea;
        }

        .admin-logo h2 {
            font-size: 20px;
            font-weight: 700;
        }

        .admin-subtitle {
            font-size: 12px;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #a0aec0;
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #2d3748;
            color: white;
        }

        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #667eea;
        }

        .nav-badge {
            background: #e53e3e;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .header-left h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header-subtitle {
            color: #718096;
            font-size: 14px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .ai-status-card {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #e6fffa;
            border-radius: 8px;
            font-size: 12px;
            color: #065f46;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }

        .stat-card.primary { --accent-color: #667eea; }
        .stat-card.success { --accent-color: #10b981; }
        .stat-card.warning { --accent-color: #f59e0b; }
        .stat-card.danger { --accent-color: #e53e3e; }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .stat-icon.primary { background: #667eea; }
        .stat-icon.success { background: #10b981; }
        .stat-icon.warning { background: #f59e0b; }
        .stat-icon.danger { background: #e53e3e; }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.positive { color: #10b981; }
        .stat-change.negative { color: #e53e3e; }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        .card-content {
            padding: 20px;
        }

        /* AI Monitoring Section */
        .ai-monitoring {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 30px;
        }

        .ai-monitoring .card-header {
            border-bottom-color: rgba(255, 255, 255, 0.2);
        }

        .ai-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .ai-metric {
            text-align: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .ai-metric-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .ai-metric-label {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-badge.pending { background: #fef3c7; color: #92400e; }
        .status-badge.approved { background: #d1fae5; color: #065f46; }
        .status-badge.rejected { background: #fee2e2; color: #991b1b; }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .admin-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .admin-sidebar.open {
                transform: translateX(0);
            }

            .admin-main {
                margin-left: 0;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="demo-badge">
        ðŸ”— REAL API - Production Dashboard
    </div>

    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <div class="admin-logo">
                    <i class="fas fa-crown"></i>
                    <div>
                        <h2>ZimCrowd Admin</h2>
                        <p class="admin-subtitle">Real Data Dashboard</p>
                    </div>
                </div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item">
                    <div class="nav-link active" onclick="showSection('overview')">
                        <i class="fas fa-chart-line"></i>
                        <span>Overview</span>
                    </div>
                </div>
                <div class="nav-item">
                    <div class="nav-link" onclick="showSection('ai-monitoring')">
                        <i class="fas fa-robot"></i>
                        <span>AI Monitoring</span>
                        <span class="nav-badge">Live</span>
                    </div>
                </div>
                <div class="nav-item">
                    <div class="nav-link" onclick="showSection('users')">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                        <span class="nav-badge" id="userCount">0</span>
                    </div>
                </div>
                <div class="nav-item">
                    <div class="nav-link" onclick="showSection('loans')">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>Loans</span>
                        <span class="nav-badge" id="loanCount">0</span>
                    </div>
                </div>
                <div class="nav-item">
                    <div class="nav-link" onclick="showSection('investments')">
                        <i class="fas fa-chart-pie"></i>
                        <span>Investments</span>
                    </div>
                </div>
                <div class="nav-item">
                    <div class="nav-link" onclick="showSection('analytics')">
                        <i class="fas fa-analytics"></i>
                        <span>Analytics</span>
                    </div>
                </div>
                <div class="nav-item">
                    <div class="nav-link" onclick="showSection('reports')">
                        <i class="fas fa-file-alt"></i>
                        <span>Reports</span>
                    </div>
                </div>
                <div class="nav-item" style="margin-top: 20px; border-top: 1px solid #2d3748; padding-top: 20px;">
                    <div class="nav-link" onclick="window.open('kairo-ai-standalone.html', '_blank')">
                        <i class="fas fa-robot"></i>
                        <span>Test Kairo AI</span>
                    </div>
                </div>
                <div class="nav-item">
                    <div class="nav-link" onclick="window.open('index.html', '_blank')">
                        <i class="fas fa-home"></i>
                        <span>ZimCrowd Home</span>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <div class="admin-header">
                <div class="header-left">
                    <h1>Admin Dashboard</h1>
                    <p class="header-subtitle">Real-time financial platform management</p>
                </div>
                <div class="header-right">
                    <div class="ai-status-card">
                        <div class="status-indicator"></div>
                        <span>AI System Active</span>
                    </div>
                </div>
            </div>

            <!-- Overview Section -->
            <div id="overview-section" class="dashboard-section active">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalUsers">0</div>
                                <div class="stat-label">Total Users</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="userGrowth">0% this month</span>
                                </div>
                            </div>
                            <div class="stat-icon primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card success">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="activeLoans">$0</div>
                                <div class="stat-label">Active Loans</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="loanGrowth">0% this week</span>
                                </div>
                            </div>
                            <div class="stat-icon success">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card warning">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalInvestments">$0</div>
                                <div class="stat-label">Total Investments</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="investmentGrowth">0% this month</span>
                                </div>
                            </div>
                            <div class="stat-icon warning">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card danger">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalTransactions">0</div>
                                <div class="stat-label">Total Transactions</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="transactionGrowth">0% today</span>
                                </div>
                            </div>
                            <div class="stat-icon danger">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Monitoring Card -->
                <div class="dashboard-card ai-monitoring">
                    <div class="card-header">
                        <h3 class="card-title">ðŸ¤– Kairo AI System Status</h3>
                        <button class="btn btn-primary" onclick="refreshData()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="ai-metrics">
                            <div class="ai-metric">
                                <div class="ai-metric-value" id="aiSuccessRate">99.2%</div>
                                <div class="ai-metric-label">Success Rate</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-value" id="aiRequests">0</div>
                                <div class="ai-metric-label">OpenRouter Requests</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-value" id="aiFallbacks">0</div>
                                <div class="ai-metric-label">Gemini Fallbacks</div>
                            </div>
                            <div class="ai-metric">
                                <div class="ai-metric-value" id="aiReliability">99.8%</div>
                                <div class="ai-metric-label">System Reliability</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Activity</h3>
                            <button class="btn btn-primary" onclick="refreshData()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="card-content">
                            <div id="recentActivityContainer" class="loading">
                                <div class="spinner"></div>
                                <p>Loading recent activity...</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">Quick Actions</h3>
                        </div>
                        <div class="card-content">
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <button class="btn btn-primary" onclick="alert('Report generation - would create PDF/Excel reports')">
                                    <i class="fas fa-file-alt"></i> Generate Report
                                </button>
                                <button class="btn btn-primary" onclick="alert('Data export - would export user/loan/investment data')">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                                <button class="btn btn-primary" onclick="alert('System health check - showing server/API/database status')">
                                    <i class="fas fa-heartbeat"></i> System Health
                                </button>
                                <button class="btn btn-primary" onclick="window.open('kairo-ai-standalone.html', '_blank')">
                                    <i class="fas fa-robot"></i> Test Kairo AI
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Monitoring Section -->
            <div id="ai-monitoring-section" class="dashboard-section">
                <!-- AI Stats Grid -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card primary">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="aiTotalConversations">0</div>
                                <div class="stat-label">Total Conversations</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="aiConversationsGrowth">+0 today</span>
                                </div>
                            </div>
                            <div class="stat-icon primary">
                                <i class="fas fa-comments"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="aiOverallSuccessRate">0%</div>
                                <div class="stat-label">Success Rate</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-check-circle"></i>
                                    <span id="aiSuccessRateChange">Excellent</span>
                                </div>
                            </div>
                            <div class="stat-icon success">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="aiAvgResponseTime">0ms</div>
                                <div class="stat-label">Avg Response Time</div>
                                <div class="stat-change">
                                    <i class="fas fa-clock"></i>
                                    <span id="aiResponseTimeStatus">Fast</span>
                                </div>
                            </div>
                            <div class="stat-icon warning">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="aiSystemUptime">99.8%</div>
                                <div class="stat-label">System Uptime</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-server"></i>
                                    <span>Stable</span>
                                </div>
                            </div>
                            <div class="stat-icon danger">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Provider Performance -->
                <div class="dashboard-grid" style="margin-bottom: 30px;">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h2 class="card-title">ðŸš€ OpenRouter Performance</h2>
                            <button class="btn btn-primary" onclick="loadAIMonitoring()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="card-content">
                            <div id="openRouterStats" class="loading">
                                <div class="spinner"></div>
                                <p>Loading OpenRouter stats...</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h2 class="card-title">ðŸ”„ Gemini Fallback</h2>
                        </div>
                        <div class="card-content">
                            <div id="geminiStats" class="loading">
                                <div class="spinner"></div>
                                <p>Loading Gemini stats...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI System Reliability -->
                <div class="dashboard-card" style="margin-bottom: 30px;">
                    <div class="card-header">
                        <h2 class="card-title">ðŸ“Š System Reliability & Performance</h2>
                    </div>
                    <div class="card-content">
                        <div id="aiReliabilityStats" class="loading">
                            <div class="spinner"></div>
                            <p>Loading reliability stats...</p>
                        </div>
                    </div>
                </div>

                <!-- Recent AI Conversations -->
                <div class="dashboard-card" style="margin-bottom: 30px;">
                    <div class="card-header">
                        <h2 class="card-title">ðŸ’¬ Recent AI Conversations</h2>
                        <button class="btn btn-primary" onclick="loadRecentConversations()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-content">
                        <div id="recentConversations" class="loading">
                            <div class="spinner"></div>
                            <p>Loading conversations...</p>
                        </div>
                    </div>
                </div>

                <!-- Kairo AI Chat Interface -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2 class="card-title">ðŸ¤– Test Kairo AI Chat</h2>
                        <button class="btn btn-primary" onclick="window.open('kairo-ai-standalone.html', '_blank')">
                            <i class="fas fa-external-link-alt"></i> Open Full Chat
                        </button>
                    </div>
                    <div class="card-content">
                        <p style="color: #718096; margin-bottom: 15px;">Test the Kairo AI assistant directly from the admin panel or open the full chat interface.</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="testAIChat()">
                                <i class="fas fa-robot"></i> Quick Test
                            </button>
                            <button class="btn btn-primary" onclick="viewConversationHistory()">
                                <i class="fas fa-history"></i> View History
                            </button>
                            <button class="btn btn-primary" onclick="viewAIAnalytics()">
                                <i class="fas fa-chart-bar"></i> View Analytics
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Management Section -->
            <div id="users-section" class="dashboard-section">
                <!-- Users Stats -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card primary">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="totalUsersDetail">0</div>
                                <div class="stat-label">Total Users</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="userGrowthDetail">0% this month</span>
                                </div>
                            </div>
                            <div class="stat-icon primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="verifiedUsers">0</div>
                                <div class="stat-label">Verified Users</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="verifiedGrowth">0% this week</span>
                                </div>
                            </div>
                            <div class="stat-icon success">
                                <i class="fas fa-user-check"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="pendingKyc">0</div>
                                <div class="stat-label">Pending KYC</div>
                                <div class="stat-change negative">
                                    <i class="fas fa-arrow-down"></i>
                                    <span id="kycChange">-0% this week</span>
                                </div>
                            </div>
                            <div class="stat-icon warning">
                                <i class="fas fa-user-clock"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="avgZimScore">0</div>
                                <div class="stat-label">Avg ZimScore</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="zimScoreChange">0 points</span>
                                </div>
                            </div>
                            <div class="stat-icon danger">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Management Tools -->
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">User Search & Filters</h3>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="exportUsers()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                                <button class="btn btn-primary" onclick="refreshUsers()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <input type="text" id="userSearch" placeholder="Search users..." style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px;">
                                <select id="userStatusFilter" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px;">
                                    <option value="">All Status</option>
                                    <option value="verified">Verified</option>
                                    <option value="pending">Pending KYC</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                                <select id="zimScoreFilter" style="padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px;">
                                    <option value="">All ZimScore Ranges</option>
                                    <option value="750-850">750-850 (Excellent)</option>
                                    <option value="650-749">650-749 (Good)</option>
                                    <option value="550-649">550-649 (Fair)</option>
                                    <option value="300-549">300-549 (Poor)</option>
                                </select>
                            </div>

                            <div id="usersTableContainer" class="loading">
                                <div class="spinner"></div>
                                <p>Loading users...</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3 class="card-title">User Actions</h3>
                        </div>
                        <div class="card-content">
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <button class="btn btn-primary" onclick="bulkVerifyUsers()">
                                    <i class="fas fa-check-circle"></i> Bulk Verify Users
                                </button>
                                <button class="btn btn-primary" onclick="sendBulkNotifications()">
                                    <i class="fas fa-bell"></i> Send Notifications
                                </button>
                                <button class="btn btn-primary" onclick="generateUserReport()">
                                    <i class="fas fa-chart-bar"></i> Generate Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other sections would be implemented similarly -->
            <div id="loans-section" class="dashboard-section">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2 class="card-title">Loans Management</h2>
                        <button class="btn btn-primary" onclick="refreshLoans()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-content">
                        <div id="loansTableContainer" class="loading">
                            <div class="spinner"></div>
                            <p>Loading loans...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="investments-section" class="dashboard-section">
                <!-- Investment Stats -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card primary">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="invTotalInvested">$0</div>
                                <div class="stat-label">Total Invested</div>
                            </div>
                            <div class="stat-icon primary">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="invTotalReturns">$0</div>
                                <div class="stat-label">Total Returns</div>
                            </div>
                            <div class="stat-icon success">
                                <i class="fas fa-coins"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="invAverageROI">0%</div>
                                <div class="stat-label">Average ROI</div>
                            </div>
                            <div class="stat-icon warning">
                                <i class="fas fa-percentage"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-header">
                            <div>
                                <div class="stat-value" id="invActiveCount">0</div>
                                <div class="stat-label">Active Investments</div>
                            </div>
                            <div class="stat-icon danger">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Investment Analytics -->
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h2 class="card-title">P2P Investments</h2>
                            <button class="btn btn-primary" onclick="loadInvestmentAnalytics()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="card-content">
                            <div id="p2pInvestmentsContainer" class="loading">
                                <div class="spinner"></div>
                                <p>Loading P2P investments...</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h2 class="card-title">Traditional Investments</h2>
                        </div>
                        <div class="card-content">
                            <div id="traditionalInvestmentsContainer" class="loading">
                                <div class="spinner"></div>
                                <p>Loading traditional investments...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Trends Chart -->
                <div class="dashboard-card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h2 class="card-title">Investment Trends (Last 6 Months)</h2>
                    </div>
                    <div class="card-content">
                        <canvas id="investmentTrendsChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <div id="analytics-section" class="dashboard-section">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2 class="card-title">Analytics Dashboard</h2>
                    </div>
                    <div class="card-content">
                        <canvas id="analyticsChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="reports-section" class="dashboard-section">
                <!-- Report Generation -->
                <div class="dashboard-card" style="margin-bottom: 20px;">
                    <div class="card-header">
                        <h2 class="card-title">Generate Reports</h2>
                    </div>
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Report Type</label>
                                <select id="reportType" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px;">
                                    <option value="overview">Platform Overview</option>
                                    <option value="users">User Report</option>
                                    <option value="loans">Loan Report</option>
                                    <option value="investments">Investment Report</option>
                                    <option value="financial">Financial Report</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">Start Date</label>
                                <input type="date" id="reportStartDate" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">End Date</label>
                                <input type="date" id="reportEndDate" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px;">
                            </div>
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="generateReport()">
                                <i class="fas fa-file-alt"></i> Generate Report
                            </button>
                            <button class="btn btn-primary" onclick="downloadReport()">
                                <i class="fas fa-download"></i> Download JSON
                            </button>
                        </div>
                        <div id="reportPreview" style="margin-top: 20px; padding: 20px; background: #f7fafc; border-radius: 8px; display: none;">
                            <h3 style="margin-bottom: 10px;">Report Preview</h3>
                            <pre id="reportData" style="background: white; padding: 15px; border-radius: 6px; overflow-x: auto; max-height: 400px;"></pre>
                        </div>
                    </div>
                </div>

                <!-- Data Export -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2 class="card-title">Export Data</h2>
                    </div>
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <button class="btn btn-primary" onclick="exportDataType('users')">
                                <i class="fas fa-users"></i> Export Users
                            </button>
                            <button class="btn btn-primary" onclick="exportDataType('loans')">
                                <i class="fas fa-hand-holding-usd"></i> Export Loans
                            </button>
                            <button class="btn btn-primary" onclick="exportDataType('investments')">
                                <i class="fas fa-chart-pie"></i> Export Investments
                            </button>
                            <button class="btn btn-primary" onclick="exportAllData()">
                                <i class="fas fa-database"></i> Export All Data
                            </button>
                        </div>
                        <div id="exportStatus" style="margin-top: 15px; padding: 10px; background: #e6fffa; border-radius: 6px; display: none;">
                            <p style="margin: 0; color: #065f46;"><i class="fas fa-check-circle"></i> <span id="exportMessage"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : 'https://zimcrowd-backend-ls1rz3tlo-jojola.vercel.app';

        const ADMIN_API_KEY = 'admin-dev-key-123'; // In production, this would be securely handled

        let currentSection = 'overview';
        let usersData = [];
        let loansData = [];

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardOverview();
        });

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');
            event.target.closest('.nav-link').classList.add('active');

            currentSection = sectionName;

            // Load section data
            switch(sectionName) {
                case 'overview':
                    loadDashboardOverview();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'loans':
                    loadLoans();
                    break;
                case 'investments':
                    loadInvestmentAnalytics();
                    break;
                case 'ai-monitoring':
                    loadAIMonitoring();
                    break;
                case 'reports':
                    // Reports section is static UI
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        async function loadDashboardOverview() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin-dashboard/overview`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (data.success) {
                    updateOverviewStats(data.data);
                }

                // Load recent activity
                loadRecentActivity();

            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        function updateOverviewStats(data) {
            // Update main stats
            document.getElementById('totalUsers').textContent = data.totalUsers || 0;
            document.getElementById('activeLoans').textContent = `$${data.activeLoansValue?.toLocaleString() || 0}`;
            document.getElementById('totalInvestments').textContent = `$${data.totalInvestments?.toLocaleString() || 0}`;
            document.getElementById('totalTransactions').textContent = data.totalTransactions || 0;

            // Update sidebar badges
            document.getElementById('userCount').textContent = data.totalUsers || 0;
            document.getElementById('loanCount').textContent = data.totalLoans || 0;

            // Update growth indicators (mock data for now)
            document.getElementById('userGrowth').textContent = '+12% this month';
            document.getElementById('loanGrowth').textContent = '+8% this week';
            document.getElementById('investmentGrowth').textContent = '+15% this month';
            document.getElementById('transactionGrowth').textContent = '+25% today';
        }

        async function loadRecentActivity() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin-dashboard/activity/recent?limit=5`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (data.success) {
                    displayRecentActivity(data.data);
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
                document.getElementById('recentActivityContainer').innerHTML = `
                    <p style="color: #718096;">Unable to load recent activity</p>
                `;
            }
        }

        function displayRecentActivity(activities) {
            if (!activities || activities.length === 0) {
                document.getElementById('recentActivityContainer').innerHTML = `
                    <p style="color: #718096;">No recent activity</p>
                `;
                return;
            }

            const activityHTML = activities.map(activity => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e2e8f0;">
                    <div>
                        <div style="font-weight: 600;">${activity.description}</div>
                        <div style="font-size: 12px; color: #718096;">${new Date(activity.created_at).toLocaleString()}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600; color: ${activity.type === 'deposit' ? '#10b981' : '#e53e3e'}">
                            ${activity.type === 'deposit' ? '+' : '-'}$${activity.amount?.toFixed(2) || 0}
                        </div>
                        <div style="font-size: 12px; color: #718096;">${activity.user_name || 'User'}</div>
                    </div>
                </div>
            `).join('');

            document.getElementById('recentActivityContainer').innerHTML = activityHTML;
        }

        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin-dashboard/users?page=1&limit=20`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (data.success) {
                    usersData = data.data.users;
                    displayUsers(data.data.users);
                    updateUserStats(data.data);
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersTableContainer').innerHTML = `
                    <p style="color: #718096;">Unable to load users</p>
                `;
            }
        }

        function updateUserStats(data) {
            document.getElementById('totalUsersDetail').textContent = data.totalUsers || 0;
            document.getElementById('verifiedUsers').textContent = data.verifiedUsers || 0;
            document.getElementById('pendingKyc').textContent = data.pendingKyc || 0;
            document.getElementById('avgZimScore').textContent = data.avgZimScore || 0;
        }

        function displayUsers(users) {
            if (!users || users.length === 0) {
                document.getElementById('usersTableContainer').innerHTML = `
                    <p style="color: #718096;">No users found</p>
                `;
                return;
            }

            const tableHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>ZimScore</th>
                            <th>KYC Status</th>
                            <th>Joined</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>#${user.id?.substring(0, 8) || 'N/A'}</td>
                                <td>${user.name || 'N/A'}</td>
                                <td>${user.email || 'N/A'}</td>
                                <td><span style="color: ${getZimScoreColor(user.zimscore)}">${user.zimscore || 0}</span></td>
                                <td><span class="status-badge ${user.kyc_status || 'pending'}">${user.kyc_status || 'pending'}</span></td>
                                <td>${user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A'}</td>
                                <td>
                                    <button class="btn btn-primary" onclick="viewUser('${user.id}')">View</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('usersTableContainer').innerHTML = tableHTML;
        }

        function getZimScoreColor(score) {
            if (score >= 750) return '#10b981';
            if (score >= 650) return '#3b82f6';
            if (score >= 550) return '#f59e0b';
            return '#e53e3e';
        }

        async function loadLoans() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin-dashboard/loans?page=1&limit=20&status=pending`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                if (data.success) {
                    loansData = data.data.loans;
                    displayLoans(data.data.loans);
                }
            } catch (error) {
                console.error('Error loading loans:', error);
                document.getElementById('loansTableContainer').innerHTML = `
                    <p style="color: #718096;">Unable to load loans</p>
                `;
            }
        }

        function displayLoans(loans) {
            if (!loans || loans.length === 0) {
                document.getElementById('loansTableContainer').innerHTML = `
                    <p style="color: #718096;">No loans found</p>
                `;
                return;
            }

            const tableHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Loan ID</th>
                            <th>Borrower</th>
                            <th>Amount</th>
                            <th>Interest Rate</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${loans.map(loan => `
                            <tr>
                                <td>#${loan.id?.substring(0, 8) || 'N/A'}</td>
                                <td>${loan.borrower_name || 'N/A'}</td>
                                <td>$${loan.amount_requested?.toLocaleString() || 0}</td>
                                <td>${((loan.requested_interest_rate || 0) * 100).toFixed(2)}%</td>
                                <td><span class="status-badge ${loan.status || 'pending'}">${loan.status || 'pending'}</span></td>
                                <td>${loan.created_at ? new Date(loan.created_at).toLocaleDateString() : 'N/A'}</td>
                                <td>
                                    <button class="btn btn-primary" onclick="reviewLoan('${loan.id}')">Review</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('loansTableContainer').innerHTML = tableHTML;
        }

        function loadAnalytics() {
            // Initialize chart if Chart.js is available
            if (typeof Chart !== 'undefined') {
                const ctx = document.getElementById('analyticsChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'User Registrations',
                                data: [12, 19, 15, 25, 22, 30],
                                borderColor: '#667eea',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                }
            }
        }

        // Action functions
        function refreshData() {
            switch(currentSection) {
                case 'overview':
                    loadDashboardOverview();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'loans':
                    loadLoans();
                    break;
            }
        }

        function refreshUsers() {
            loadUsers();
        }

        function refreshLoans() {
            loadLoans();
        }

        function exportUsers() {
            alert('Export functionality would generate and download a CSV/Excel file with user data');
        }

        function viewUser(userId) {
            alert(`View user details for: ${userId}`);
        }

        function reviewLoan(loanId) {
            alert(`Review loan application: ${loanId}`);
        }

        function bulkVerifyUsers() {
            alert('Bulk verification would verify multiple users at once');
        }

        function sendBulkNotifications() {
            alert('Bulk notifications would send messages to selected users');
        }

        function generateUserReport() {
            alert('User report generation would create detailed analytics');
        }

        // Investment Analytics Functions
        let currentReportData = null;

        async function loadInvestmentAnalytics() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin-dashboard/investments/analytics`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                if (result.success) {
                    displayInvestmentAnalytics(result.data);
                }
            } catch (error) {
                console.error('Error loading investment analytics:', error);
                document.getElementById('p2pInvestmentsContainer').innerHTML = `
                    <p style="color: #718096;">Unable to load investment analytics</p>
                `;
            }
        }

        function displayInvestmentAnalytics(data) {
            // Update stats
            document.getElementById('invTotalInvested').textContent = `$${data.overview.total_invested?.toLocaleString() || 0}`;
            document.getElementById('invTotalReturns').textContent = `$${data.overview.total_returns?.toLocaleString() || 0}`;
            document.getElementById('invAverageROI').textContent = `${data.overview.average_roi || 0}%`;
            document.getElementById('invActiveCount').textContent = data.overview.active_investments || 0;

            // Display P2P investments
            const p2pHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: #667eea;">$${data.p2p.total_amount?.toLocaleString() || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Total Amount</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: #10b981;">$${data.p2p.total_earned?.toLocaleString() || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Total Earned</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700;">${data.p2p.active_count || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Active</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700;">${data.p2p.total_count || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Total</div>
                    </div>
                </div>
            `;
            document.getElementById('p2pInvestmentsContainer').innerHTML = p2pHTML;

            // Display traditional investments
            const tradHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: #667eea;">$${data.traditional.total_amount?.toLocaleString() || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Total Amount</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: #10b981;">$${data.traditional.total_returns?.toLocaleString() || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Total Returns</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px;">By Type</h4>
                    ${Object.entries(data.traditional.by_type || {}).map(([type, stats]) => `
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0;">
                            <span style="text-transform: capitalize;">${type.replace('_', ' ')}</span>
                            <span style="font-weight: 600;">$${stats.amount?.toLocaleString() || 0} (${stats.count})</span>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('traditionalInvestmentsContainer').innerHTML = tradHTML;

            // Display trends chart
            if (typeof Chart !== 'undefined' && data.trends) {
                const ctx = document.getElementById('investmentTrendsChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.trends.map(t => t.month),
                            datasets: [{
                                label: 'Investment Amount',
                                data: data.trends.map(t => t.amount),
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4,
                                fill: true
                            }, {
                                label: 'Investment Count',
                                data: data.trends.map(t => t.count),
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left'
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            }
                        }
                    });
                }
            }
        }

        // AI Monitoring Functions
        async function loadAIMonitoring() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin-dashboard/ai/monitoring`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                if (result.success) {
                    displayAIMonitoring(result.data);
                }
            } catch (error) {
                console.error('Error loading AI monitoring:', error);
            }
        }

        function displayAIMonitoring(data) {
            // Update AI metrics in overview section
            document.getElementById('aiSuccessRate').textContent = `${data.overview.overall_success_rate || 0}%`;
            document.getElementById('aiRequests').textContent = data.providers.openrouter.total_requests || 0;
            document.getElementById('aiFallbacks').textContent = data.providers.gemini.fallback_usage || 0;
            document.getElementById('aiReliability').textContent = `${data.reliability.uptime_percentage || 0}%`;

            // Update AI monitoring section stats
            document.getElementById('aiTotalConversations').textContent = data.overview.total_conversations || 0;
            document.getElementById('aiConversationsGrowth').textContent = `+${data.overview.conversations_today || 0} today`;
            document.getElementById('aiOverallSuccessRate').textContent = `${data.overview.overall_success_rate || 0}%`;
            document.getElementById('aiAvgResponseTime').textContent = `${data.overview.avg_response_time_ms || 0}ms`;
            document.getElementById('aiSystemUptime').textContent = `${data.reliability.uptime_percentage || 99.8}%`;

            // Display OpenRouter stats
            const openRouterHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #667eea;">${data.providers.openrouter.total_requests || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Total Requests</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #10b981;">${data.providers.openrouter.successful || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Successful</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #ef4444;">${data.providers.openrouter.failed || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Failed</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #f59e0b;">${data.providers.openrouter.success_rate || 0}%</div>
                        <div style="color: #718096; font-size: 14px;">Success Rate</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                    <div style="font-weight: 600; color: #065f46; margin-bottom: 5px;">Primary AI Provider</div>
                    <div style="color: #047857; font-size: 14px;">OpenRouter handles all initial requests with high reliability</div>
                </div>
            `;
            document.getElementById('openRouterStats').innerHTML = openRouterHTML;

            // Display Gemini stats
            const geminiHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #667eea;">${data.providers.gemini.total_requests || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Fallback Requests</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #10b981;">${data.providers.gemini.successful || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Successful</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #ef4444;">${data.providers.gemini.failed || 0}</div>
                        <div style="color: #718096; font-size: 14px;">Failed</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; font-weight: 700; color: #f59e0b;">${data.providers.gemini.success_rate || 0}%</div>
                        <div style="color: #718096; font-size: 14px;">Success Rate</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <div style="font-weight: 600; color: #92400e; margin-bottom: 5px;">Backup AI Provider</div>
                    <div style="color: #78350f; font-size: 14px;">Gemini provides fallback when OpenRouter is unavailable</div>
                </div>
            `;
            document.getElementById('geminiStats').innerHTML = geminiHTML;

            // Display reliability stats
            const reliabilityHTML = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #f0fdf4; border-radius: 8px;">
                        <div style="font-size: 32px; font-weight: 700; color: #10b981;">${data.reliability.uptime_percentage || 99.8}%</div>
                        <div style="color: #065f46; font-size: 14px; margin-top: 8px;">System Uptime</div>
                        <div style="color: #047857; font-size: 12px; margin-top: 4px;">Last 30 days</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #fef2f2; border-radius: 8px;">
                        <div style="font-size: 32px; font-weight: 700; color: #ef4444;">${data.reliability.total_errors || 0}</div>
                        <div style="color: #991b1b; font-size: 14px; margin-top: 8px;">Total Errors</div>
                        <div style="color: #b91c1c; font-size: 12px; margin-top: 4px;">All time</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #fef3c7; border-radius: 8px;">
                        <div style="font-size: 32px; font-weight: 700; color: #f59e0b;">${data.reliability.error_rate || 0}%</div>
                        <div style="color: #92400e; font-size: 14px; margin-top: 8px;">Error Rate</div>
                        <div style="color: #78350f; font-size: 12px; margin-top: 4px;">Current period</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 20px; background: #eff6ff; border-radius: 8px;">
                    <h4 style="color: #1e40af; margin-bottom: 15px;">System Health Indicators</h4>
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #1e3a8a;">API Response Time</span>
                            <span style="font-weight: 600; color: #10b981;">${data.overview.avg_response_time_ms || 0}ms - Excellent</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #1e3a8a;">Provider Redundancy</span>
                            <span style="font-weight: 600; color: #10b981;">Active - 2 Providers</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #1e3a8a;">Fallback System</span>
                            <span style="font-weight: 600; color: #10b981;">Operational</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #1e3a8a;">User Satisfaction</span>
                            <span style="font-weight: 600; color: #10b981;">${data.overview.avg_satisfaction || 0}/5.0</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('aiReliabilityStats').innerHTML = reliabilityHTML;
        }

        // Load recent AI conversations
        async function loadRecentConversations() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/kairo-ai/conversations/recent?limit=10`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                if (result.success) {
                    displayRecentConversations(result.data);
                } else {
                    // Show placeholder if no data
                    document.getElementById('recentConversations').innerHTML = `
                        <p style="color: #718096; text-align: center; padding: 40px;">No recent conversations available</p>
                    `;
                }
            } catch (error) {
                console.error('Error loading recent conversations:', error);
                document.getElementById('recentConversations').innerHTML = `
                    <p style="color: #718096; text-align: center; padding: 40px;">Unable to load conversations</p>
                `;
            }
        }

        function displayRecentConversations(conversations) {
            if (!conversations || conversations.length === 0) {
                document.getElementById('recentConversations').innerHTML = `
                    <p style="color: #718096; text-align: center; padding: 40px;">No recent conversations</p>
                `;
                return;
            }

            const conversationsHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    ${conversations.map(conv => `
                        <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid ${conv.status === 'success' ? '#10b981' : '#ef4444'};">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: 600; color: #1a202c;">${conv.user_email || 'Anonymous User'}</div>
                                    <div style="font-size: 12px; color: #718096;">${new Date(conv.created_at).toLocaleString()}</div>
                                </div>
                                <div>
                                    <span style="padding: 4px 8px; background: ${conv.status === 'success' ? '#d1fae5' : '#fee2e2'}; color: ${conv.status === 'success' ? '#065f46' : '#991b1b'}; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                        ${conv.status}
                                    </span>
                                </div>
                            </div>
                            <div style="color: #4a5568; font-size: 14px; margin-bottom: 8px;">
                                <strong>User:</strong> ${conv.user_message?.substring(0, 100)}${conv.user_message?.length > 100 ? '...' : ''}
                            </div>
                            <div style="color: #718096; font-size: 13px;">
                                <strong>AI:</strong> ${conv.ai_response?.substring(0, 150)}${conv.ai_response?.length > 150 ? '...' : ''}
                            </div>
                            <div style="display: flex; gap: 15px; margin-top: 10px; font-size: 12px; color: #718096;">
                                <span><i class="fas fa-robot"></i> ${conv.ai_provider || 'openrouter'}</span>
                                <span><i class="fas fa-clock"></i> ${conv.response_time_ms || 0}ms</span>
                                ${conv.intent ? `<span><i class="fas fa-tag"></i> ${conv.intent}</span>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('recentConversations').innerHTML = conversationsHTML;
        }

        // AI Chat test functions
        function testAIChat() {
            const testMessage = prompt('Enter a test message for Kairo AI:');
            if (testMessage) {
                alert(`Test message: "${testMessage}"\n\nThis would send the message to Kairo AI and display the response. Open the full chat interface for real conversations.`);
            }
        }

        function viewConversationHistory() {
            alert('Conversation History\n\nThis would display a detailed history of all AI conversations with filtering and search capabilities.');
        }

        function viewAIAnalytics() {
            alert('AI Analytics\n\nThis would show detailed analytics including:\n- Conversation trends over time\n- Most common user intents\n- Response quality metrics\n- User satisfaction scores\n- Provider performance comparison');
        }

        // Report Generation Functions
        async function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            try {
                const url = new URL(`${API_BASE_URL}/api/admin-dashboard/reports/generate`);
                url.searchParams.append('reportType', reportType);
                if (startDate) url.searchParams.append('startDate', startDate);
                if (endDate) url.searchParams.append('endDate', endDate);

                const response = await fetch(url, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                if (result.success) {
                    currentReportData = result.data;
                    document.getElementById('reportData').textContent = JSON.stringify(result.data, null, 2);
                    document.getElementById('reportPreview').style.display = 'block';
                } else {
                    alert('Failed to generate report: ' + result.error);
                }
            } catch (error) {
                console.error('Error generating report:', error);
                alert('Failed to generate report');
            }
        }

        function downloadReport() {
            if (!currentReportData) {
                alert('Please generate a report first');
                return;
            }

            const dataStr = JSON.stringify(currentReportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${currentReportData.report_type}-report-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Data Export Functions
        async function exportDataType(dataType) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin-dashboard/export/${dataType}`, {
                    headers: {
                        'x-admin-key': ADMIN_API_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                if (result.success) {
                    // Download the data
                    const dataStr = JSON.stringify(result.data, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `${dataType}-export-${Date.now()}.json`;
                    link.click();
                    URL.revokeObjectURL(url);

                    // Show success message
                    document.getElementById('exportMessage').textContent = `Successfully exported ${result.data.count} ${dataType} records`;
                    document.getElementById('exportStatus').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('exportStatus').style.display = 'none';
                    }, 5000);
                } else {
                    alert('Failed to export data: ' + result.error);
                }
            } catch (error) {
                console.error('Error exporting data:', error);
                alert('Failed to export data');
            }
        }

        async function exportAllData() {
            const types = ['users', 'loans', 'investments'];
            for (const type of types) {
                await exportDataType(type);
                await new Promise(resolve => setTimeout(resolve, 1000)); // Delay between exports
            }
        }

        // Error handling
        function showError(message) {
            console.error(message);
            alert(message);
        }
    </script>
</body>
</html>
