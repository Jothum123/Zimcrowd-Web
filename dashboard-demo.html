<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Demo - Mock Data</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Load mock data and data service -->
    <script src="js/mock-data.js"></script>
    <script src="js/data-service.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #0f172a;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: #38e77b;
            margin-bottom: 10px;
        }

        .toggle-section {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #334155;
        }

        .toggle-btn {
            padding: 12px 24px;
            background: #38e77b;
            color: #0f172a;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(56, 231, 123, 0.4);
        }

        .toggle-btn.inactive {
            background: #334155;
            color: #94a3b8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1e293b;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #334155;
        }

        .stat-card h3 {
            font-size: 32px;
            color: #38e77b;
            margin-bottom: 8px;
        }

        .stat-card p {
            color: #94a3b8;
            font-size: 14px;
        }

        .section {
            background: #1e293b;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #334155;
        }

        .section h2 {
            color: #38e77b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item {
            background: #0f172a;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #334155;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .item-title {
            font-weight: 600;
            font-size: 16px;
        }

        .item-amount {
            color: #38e77b;
            font-weight: 600;
            font-size: 18px;
        }

        .item-details {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #94a3b8;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.active {
            background: rgba(56, 231, 123, 0.2);
            color: #38e77b;
        }

        .badge.pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .badge.completed {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #334155;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #38e77b, #34d399);
            transition: width 0.3s;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #334155;
            border-top-color: #38e77b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-chart-line"></i> Dashboard Demo with Mock Data</h1>
        <p style="color: #94a3b8; margin-bottom: 30px;">
            This demo shows realistic mock data in the exact format expected by the live API.
            Toggle between mock data and real API to test the integration.
        </p>

        <!-- Toggle Section -->
        <div class="toggle-section">
            <h3 style="margin-bottom: 15px;">Data Source</h3>
            <button class="toggle-btn" id="mockBtn" onclick="enableMockData()">
                <i class="fas fa-database"></i> Use Mock Data
            </button>
            <button class="toggle-btn inactive" id="realBtn" onclick="enableRealAPI()">
                <i class="fas fa-cloud"></i> Use Real API
            </button>
            <p style="margin-top: 15px; color: #94a3b8; font-size: 14px;">
                <i class="fas fa-info-circle"></i> 
                <span id="statusText">Currently using mock data (safe for testing)</span>
            </p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="walletBalance">$0.00</h3>
                <p>Wallet Balance</p>
            </div>
            <div class="stat-card">
                <h3 id="totalInvested">$0.00</h3>
                <p>Total Invested</p>
            </div>
            <div class="stat-card">
                <h3 id="totalEarned">$0.00</h3>
                <p>Total Earned</p>
            </div>
            <div class="stat-card">
                <h3 id="activeLoans">0</h3>
                <p>Active Loans</p>
            </div>
        </div>

        <!-- Loans Section -->
        <div class="section">
            <h2><i class="fas fa-hand-holding-usd"></i> My Loans</h2>
            <div id="loansContainer" class="loading">
                <div class="spinner"></div>
                <p>Loading loans...</p>
            </div>
        </div>

        <!-- Investments Section -->
        <div class="section">
            <h2><i class="fas fa-chart-pie"></i> My Investments</h2>
            <div id="investmentsContainer" class="loading">
                <div class="spinner"></div>
                <p>Loading investments...</p>
            </div>
        </div>

        <!-- Transactions Section -->
        <div class="section">
            <h2><i class="fas fa-exchange-alt"></i> Recent Transactions</h2>
            <div id="transactionsContainer" class="loading">
                <div class="spinner"></div>
                <p>Loading transactions...</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize with mock data enabled
        DataService.init({ useMockData: true });

        // Toggle functions
        function enableMockData() {
            DataService.enableMockData();
            document.getElementById('mockBtn').classList.remove('inactive');
            document.getElementById('realBtn').classList.add('inactive');
            document.getElementById('statusText').textContent = 'Currently using mock data (safe for testing)';
            loadDashboardData();
        }

        function enableRealAPI() {
            DataService.disableMockData();
            document.getElementById('mockBtn').classList.add('inactive');
            document.getElementById('realBtn').classList.remove('inactive');
            document.getElementById('statusText').textContent = 'Currently using real API (requires authentication)';
            loadDashboardData();
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load wallet
                const walletData = await DataService.getWallet();
                if (walletData.success) {
                    document.getElementById('walletBalance').textContent = 
                        `$${walletData.data.balance.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                    document.getElementById('totalInvested').textContent = 
                        `$${walletData.data.total_invested.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                    document.getElementById('totalEarned').textContent = 
                        `$${walletData.data.total_earned.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                }

                // Load loans
                const loansData = await DataService.getLoans(1, 10);
                if (loansData.success) {
                    displayLoans(loansData.data.loans);
                    document.getElementById('activeLoans').textContent = 
                        loansData.data.loans.filter(l => l.status === 'active').length;
                }

                // Load investments
                const investmentsData = await DataService.getInvestments(1, 10);
                if (investmentsData.success) {
                    displayInvestments(investmentsData.data.investments);
                }

                // Load transactions
                const transactionsData = await DataService.getTransactions(1, 5);
                if (transactionsData.success) {
                    displayTransactions(transactionsData.data.transactions);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Display loans
        function displayLoans(loans) {
            const container = document.getElementById('loansContainer');
            if (!loans || loans.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8;">No loans found</p>';
                return;
            }

            container.innerHTML = loans.map(loan => `
                <div class="item">
                    <div class="item-header">
                        <div>
                            <div class="item-title">${loan.purpose}</div>
                            <span class="badge ${loan.status}">${loan.status.toUpperCase()}</span>
                        </div>
                        <div class="item-amount">$${loan.amount.toLocaleString()}</div>
                    </div>
                    <div class="item-details">
                        <span><i class="fas fa-percent"></i> ${loan.interest_rate}% APR</span>
                        <span><i class="fas fa-calendar"></i> ${loan.term_months} months</span>
                        <span><i class="fas fa-chart-line"></i> ${loan.risk_rating}</span>
                    </div>
                    ${loan.status === 'pending' ? `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${loan.funding_progress}%"></div>
                        </div>
                        <p style="font-size: 12px; color: #94a3b8; margin-top: 4px;">
                            ${loan.funding_progress}% funded
                        </p>
                    ` : `
                        <p style="font-size: 12px; color: #94a3b8; margin-top: 8px;">
                            <i class="fas fa-check-circle" style="color: #38e77b;"></i>
                            ${loan.payments_made} of ${loan.payments_made + loan.payments_remaining} payments made
                        </p>
                    `}
                </div>
            `).join('');
        }

        // Display investments
        function displayInvestments(investments) {
            const container = document.getElementById('investmentsContainer');
            if (!investments || investments.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8;">No investments found</p>';
                return;
            }

            container.innerHTML = investments.map(inv => `
                <div class="item">
                    <div class="item-header">
                        <div>
                            <div class="item-title">${inv.borrower_name} - ${inv.loan_purpose}</div>
                            <span class="badge ${inv.status}">${inv.status.toUpperCase()}</span>
                        </div>
                        <div class="item-amount">$${inv.amount.toLocaleString()}</div>
                    </div>
                    <div class="item-details">
                        <span><i class="fas fa-percent"></i> ${inv.interest_rate}% APR</span>
                        <span><i class="fas fa-coins"></i> Earned: $${inv.earned_interest.toFixed(2)}</span>
                        <span><i class="fas fa-chart-line"></i> ${inv.risk_rating}</span>
                    </div>
                    <p style="font-size: 12px; color: #94a3b8; margin-top: 8px;">
                        ${inv.status === 'completed' 
                            ? `<i class="fas fa-check-circle" style="color: #38e77b;"></i> Investment completed`
                            : `Next payment: $${inv.next_payment_amount.toFixed(2)} on ${new Date(inv.next_payment_date).toLocaleDateString()}`
                        }
                    </p>
                </div>
            `).join('');
        }

        // Display transactions
        function displayTransactions(transactions) {
            const container = document.getElementById('transactionsContainer');
            if (!transactions || transactions.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8;">No transactions found</p>';
                return;
            }

            const typeIcons = {
                'investment': 'fa-chart-line',
                'repayment': 'fa-hand-holding-usd',
                'deposit': 'fa-arrow-down',
                'withdrawal': 'fa-arrow-up',
                'interest': 'fa-coins'
            };

            container.innerHTML = transactions.map(txn => `
                <div class="item">
                    <div class="item-header">
                        <div>
                            <div class="item-title">
                                <i class="fas ${typeIcons[txn.type] || 'fa-exchange-alt'}"></i>
                                ${txn.description}
                            </div>
                            <span class="badge ${txn.status}">${txn.status.toUpperCase()}</span>
                        </div>
                        <div class="item-amount" style="color: ${txn.type === 'deposit' || txn.type === 'interest' ? '#38e77b' : '#fbbf24'}">
                            ${txn.type === 'deposit' || txn.type === 'interest' ? '+' : '-'}$${txn.amount.toFixed(2)}
                        </div>
                    </div>
                    <div class="item-details">
                        <span><i class="fas fa-calendar"></i> ${new Date(txn.created_at).toLocaleDateString()}</span>
                        <span><i class="fas fa-hashtag"></i> ${txn.reference}</span>
                    </div>
                </div>
            `).join('');
        }

        // Load data on page load
        loadDashboardData();
    </script>
</body>
</html>
