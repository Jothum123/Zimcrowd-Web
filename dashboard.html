<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://zimcrowd-backend.vercel.app http://localhost:3000;">
    <title>Dashboard - ZimCrowd</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome Icons - Try multiple CDNs for reliability -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" onerror="this.onerror=null;this.href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css';">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css" crossorigin="anonymous">
    <!-- styles.css removed - it was forcing light mode -->
    <script src="js/api-config-new.js"></script>
    <script src="js/api-helper.js"></script>
    <script src="js/api-client.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #0f172a !important;
            color: white !important;
            transition: all 0.3s ease;
        }

        body.light-mode {
            background: #f8fafc !important;
            color: #1f2937 !important;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar - Always Dark */
        .dashboard-sidebar {
            width: 280px;
            background: #111111 !important;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 20px;
            border-right: 1px solid #1a1a1a !important;
        }

        body.light-mode .dashboard-sidebar {
            background: #111111 !important;
            border-right: 1px solid #1a1a1a !important;
        }

        .sidebar-logo img {
            width: 150px;
            margin-bottom: 40px;
        }

        .user-info {
            background: #1a1a1a !important;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #2a2a2a !important;
        }

        body.light-mode .user-info {
            background: #1a1a1a !important;
            border: 1px solid #2a2a2a !important;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #38e77b, #34d399);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: white;
        }

        .user-details h4 {
            margin-bottom: 5px;
            color: white !important;
        }

        body.light-mode .user-details h4 {
            color: white !important;
        }

        .user-details p {
            font-size: 12px;
            color: #94a3b8 !important;
        }

        body.light-mode .user-details p {
            color: #94a3b8 !important;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: #94a3b8;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 5px;
            transition: all 0.3s;
            font-weight: 500;
        }

        body.light-mode .nav-link {
            color: #94a3b8 !important;
        }

        .nav-link:hover {
            background: #1a1a1a !important;
            color: #e5e5e5 !important;
        }

        body.light-mode .nav-link:hover {
            background: #1a1a1a !important;
            color: #e5e5e5 !important;
        }

        .nav-link.active {
            background: linear-gradient(135deg, rgba(56, 231, 123, 0.2), rgba(52, 211, 153, 0.15)) !important;
            color: #38e77b !important;
            border-left: 3px solid #38e77b !important;
            padding-left: 12px;
            box-shadow: 0 0 20px rgba(56, 231, 123, 0.1) !important;
        }

        body.light-mode .nav-link.active {
            background: linear-gradient(135deg, rgba(56, 231, 123, 0.2), rgba(52, 211, 153, 0.15)) !important;
            color: #38e77b !important;
            border-left: 3px solid #38e77b !important;
            box-shadow: 0 0 20px rgba(56, 231, 123, 0.1) !important;
        }

        .nav-link i {
            width: 20px;
            font-size: 18px;
        }

        .nav-link.active i {
            color: #38e77b !important;
        }

        body.light-mode .nav-link.active i {
            color: #38e77b !important;
        }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #1a1a1a !important;
        }

        body.light-mode .sidebar-footer {
            border-top: 1px solid #1a1a1a !important;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #1a1a1a !important;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #2a2a2a !important;
        }

        body.light-mode .theme-toggle {
            background: #1a1a1a !important;
            border: 1px solid #2a2a2a !important;
        }

        .theme-toggle:hover {
            background: #2a2a2a !important;
            border-color: #38e77b !important;
        }

        body.light-mode .theme-toggle:hover {
            background: #2a2a2a !important;
            border-color: #38e77b !important;
        }

        .theme-toggle span {
            color: white !important;
            font-weight: 500;
        }

        body.light-mode .theme-toggle span {
            color: white !important;
        }

        .theme-toggle i {
            color: #38e77b !important;
            font-size: 18px;
        }

        body.light-mode .theme-toggle i {
            color: #38e77b !important;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(239, 68, 68, 0.1) !important;
            color: #ef4444 !important;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
            border: 1px solid rgba(239, 68, 68, 0.2) !important;
        }

        body.light-mode .logout-btn {
            background: rgba(239, 68, 68, 0.1) !important;
            border: 1px solid rgba(239, 68, 68, 0.2) !important;
            color: #ef4444 !important;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.3) !important;
        }

        body.light-mode .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.3) !important;
        }

        /* Main Content */
        .dashboard-content {
            margin-left: 280px;
            flex: 1;
            padding: 30px;
            background: #0f172a;
            min-height: 100vh;
        }

        body.light-mode .dashboard-content {
            background: #f8fafc;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: #1e293b;
            padding: 20px 30px;
            border-radius: 12px;
            border: 1px solid #334155;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        body.light-mode .content-header {
            background: white;
            border: 2px solid #d1d5db;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .content-header h1 {
            font-size: 32px;
            color: white;
        }

        body.light-mode .content-header h1 {
            color: #1f2937;
        }

        .content-header h2 {
            color: white;
        }

        body.light-mode .content-header h2 {
            color: #1f2937;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .header-user {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
        }

        .header-user-avatar {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #38e77b, #34d399);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: white;
        }

        .header-user-info h4 {
            font-size: 14px;
            color: white;
            margin-bottom: 2px;
        }

        body.light-mode .header-user-info h4 {
            color: #1f2937;
        }

        .header-user-info p {
            font-size: 11px;
            color: #94a3b8;
        }

        body.light-mode .header-user-info p {
            color: #6b7280;
        }

        .header-notification {
            position: relative;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .header-notification {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
        }

        .header-notification:hover {
            background: rgba(56, 231, 123, 0.1);
            border-color: #38e77b;
        }

        .header-notification i {
            color: white;
            font-size: 18px;
        }

        body.light-mode .header-notification i {
            color: #1f2937;
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 18px;
            height: 18px;
            background: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
            border: 2px solid #0f172a;
        }

        body.light-mode .notification-badge {
            border-color: white;
        }

        /* Notification Dropdown Panel */
        .notification-panel {
            position: absolute;
            top: 60px;
            right: 20px;
            width: 400px;
            max-height: 600px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-heavy);
            display: none;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
        }

        .notification-panel.active {
            display: flex;
        }

        .notification-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body:not(.light-mode) .notification-header {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .notification-header {
            border-bottom-color: rgba(0, 0, 0, 0.1);
        }

        .notification-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .notification-header .mark-all-read {
            font-size: 13px;
            color: var(--color-green);
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .notification-header .mark-all-read:hover {
            text-decoration: underline;
        }

        .notification-list {
            flex: 1;
            overflow-y: auto;
            max-height: 500px;
        }

        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        body.light-mode .notification-item {
            border-bottom-color: rgba(0, 0, 0, 0.05);
        }

        .notification-item:hover {
            background: rgba(56, 231, 123, 0.05);
        }

        .notification-item.unread {
            background: rgba(56, 231, 123, 0.08);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-icon.success {
            background: rgba(56, 231, 123, 0.1);
            color: var(--color-green);
        }

        .notification-icon.info {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .notification-icon.warning {
            background: rgba(249, 115, 22, 0.1);
            color: #f97316;
        }

        .notification-icon.danger {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 4px;
        }

        .notification-time {
            font-size: 12px;
            color: #64748b;
        }

        .notification-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        body.light-mode .notification-footer {
            border-top-color: rgba(0, 0, 0, 0.1);
        }

        .notification-footer a {
            color: var(--color-green);
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: var(--transition-normal);
        }

        .notification-footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .notification-panel {
                width: calc(100vw - 40px);
                right: 20px;
            }
        }

        section h2,
        section h3 {
            color: white;
        }

        body.light-mode section h2,
        body.light-mode section h3 {
            color: #1f2937;
        }

        /* Dashboard Sections */
        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #334155;
        }

        body.light-mode .stat-card {
            background: white;
            border: 2px solid #d1d5db;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 32px;
            color: #38e77b;
            margin-bottom: 8px;
        }

        .stat-card p {
            color: #94a3b8;
            font-size: 14px;
        }

        body.light-mode .stat-card p {
            color: #6b7280;
        }

        /* Loan Cards */
        .loan-card {
            background: #1e293b;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #334155;
            margin-bottom: 20px;
        }

        body.light-mode .loan-card {
            background: white;
            border: 2px solid #d1d5db;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .loan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .loan-header > div:first-child {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }

        .loan-header h4 {
            font-size: 20px;
            color: white;
            margin-right: 10px;
        }

        body.light-mode .loan-header h4 {
            color: #1f2937;
        }

        .loan-amount {
            font-size: 28px;
            font-weight: 700;
            color: #38e77b;
        }

        .loan-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        /* Risk Badge / Star Ratings */
        .risk-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .risk-badge.low {
            background: rgba(56, 231, 123, 0.15);
            color: #38e77b;
        }

        .risk-badge.medium {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .risk-badge.high {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .risk-badge i {
            font-size: 10px;
        }

        .risk-badge i.fas.fa-star {
            color: inherit;
        }

        .risk-badge .rating-text {
            margin-left: 4px;
            font-weight: 700;
        }

        /* Progress Bar */
        .loan-progress {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #334155;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        body.light-mode .progress-bar {
            background: #e5e7eb;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #38e77b, #34d399);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 500;
        }

        body.light-mode .progress-text {
            color: #6b7280;
        }

        .loan-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #334155;
        }

        body.light-mode .detail-row {
            border-bottom-color: #e5e7eb;
        }

        .detail-row span {
            color: #94a3b8;
        }

        body.light-mode .detail-row span {
            color: #6b7280;
        }

        .detail-row strong {
            color: white;
        }

        body.light-mode .detail-row strong {
            color: #1f2937;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        body.light-mode .tabs {
            border-bottom-color: #e5e7eb;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #38e77b;
            border-bottom-color: #38e77b;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Elements */
        select,
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            background: #1e293b;
            color: white;
            border: 1px solid #334155;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 14px;
            transition: all 0.3s;
        }

        body.light-mode select,
        body.light-mode input[type="text"],
        body.light-mode input[type="email"],
        body.light-mode input[type="tel"],
        body.light-mode input[type="date"],
        body.light-mode input[type="number"],
        body.light-mode input[type="password"] {
            background: white;
            color: #1f2937;
            border: 1px solid #d1d5db;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: #38e77b;
        }

        label {
            color: #94a3b8;
        }

        body.light-mode label {
            color: #6b7280;
        }

        /* Buttons */
        .btn-primary {
            padding: 12px 24px;
            background: linear-gradient(135deg, #38e77b, #34d399);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 231, 123, 0.3);
        }

        /* Page Number Buttons */
        .page-number-btn {
            min-width: 40px;
            height: 40px;
            padding: 8px 12px;
            background: #1e293b;
            color: #94a3b8;
            border: 1px solid #334155;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-number-btn:hover {
            background: #334155;
            color: white;
            border-color: #38e77b;
            transform: translateY(-2px);
        }

        .page-number-btn.active {
            background: linear-gradient(135deg, #38e77b, #34d399);
            color: white;
            border-color: #38e77b;
        }

        .page-number-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        body.light-mode .page-number-btn {
            background: white;
            color: #64748b;
            border: 2px solid #e2e8f0;
        }

        body.light-mode .page-number-btn:hover {
            background: #f1f5f9;
            border-color: #38e77b;
            color: #1e293b;
        }

        body.light-mode .page-number-btn.active {
            background: linear-gradient(135deg, #38e77b, #34d399);
            color: white;
            border-color: #38e77b;
        }

        /* Stat Card Icon Container */
        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
        }

        .stat-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        /* Featured Balance Card */
        .featured-balance-card {
            background: linear-gradient(135deg, #38e77b 0%, #34d399 100%);
            border: none;
            box-shadow: 0 8px 32px rgba(56, 231, 123, 0.3);
            position: relative;
            overflow: hidden;
        }

        .featured-balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .featured-balance-card h3,
        .featured-balance-card p {
            color: white !important;
            position: relative;
            z-index: 1;
        }

        .featured-balance-card h3 {
            font-size: 36px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        body.light-mode .featured-balance-card {
            background: linear-gradient(135deg, #38e77b 0%, #34d399 100%);
            box-shadow: 0 8px 32px rgba(56, 231, 123, 0.4);
        }

        /* Document Upload Areas */
        .document-upload-area {
            background: #0f172a;
            border: 2px dashed #334155;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        body.light-mode .document-upload-area {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .action-card {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        body.light-mode .action-card {
            background: white;
            border: 2px solid #d1d5db;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .action-card:hover {
            transform: translateY(-4px);
            border-color: #38e77b;
        }

        body.light-mode .action-card:hover {
            border-color: #38e77b;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .action-card i {
            font-size: 32px;
            color: #38e77b;
            margin-bottom: 15px;
        }

        .action-card h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: white;
        }

        body.light-mode .action-card h3 {
            color: #1f2937;
        }

        .action-card p {
            font-size: 14px;
            color: #94a3b8;
        }

        body.light-mode .action-card p {
            color: #6b7280;
        }

        /* ============================================ */
        /* MOBILE RESPONSIVENESS */
        /* ============================================ */

        /* Hamburger Menu Button */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        body.light-mode .mobile-menu-toggle {
            background: white;
            border: 2px solid #d1d5db;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .mobile-menu-toggle i {
            color: white;
            font-size: 24px;
        }

        body.light-mode .mobile-menu-toggle i {
            color: #1f2937;
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Tablet Styles (768px - 1024px) */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Mobile Styles (< 768px) */
        @media (max-width: 768px) {
            /* Show hamburger menu */
            .mobile-menu-toggle {
                display: flex;
            }

            /* Hide sidebar by default, show as overlay when active */
            .dashboard-sidebar {
                position: fixed;
                left: -280px;
                transition: left 0.3s ease;
                z-index: 1000;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            }

            .dashboard-sidebar.active {
                left: 0;
            }

            /* Adjust main content */
            .dashboard-content {
                margin-left: 0;
                padding: 100px 15px 20px 15px;
            }

            /* Compact header */
            .content-header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                margin-bottom: 0;
                border-radius: 0;
            }

            .content-header h1 {
                font-size: 24px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .header-user {
                padding: 6px 12px;
            }

            .header-user-info h4 {
                font-size: 12px;
            }

            .header-user-info p {
                font-size: 10px;
            }

            /* Stack stats in single column */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            /* Stack action cards */
            .quick-actions {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            /* Loan cards full width */
            .loan-details {
                grid-template-columns: 1fr;
            }

            /* Simplify tabs */
            .tabs {
                flex-wrap: wrap;
                gap: 8px;
            }

            .tab-btn {
                padding: 10px 16px;
                font-size: 14px;
            }

            /* Transaction filters stack */
            .content-header > div:last-child {
                flex-direction: column;
                width: 100%;
            }

            select {
                width: 100%;
            }

            /* Sidebar adjustments for mobile */
            .sidebar-logo img {
                width: 120px;
                margin-bottom: 30px;
            }

            .nav-link {
                padding: 14px 15px;
                font-size: 16px;
            }

            .nav-link i {
                font-size: 20px;
            }
        }

        /* Small Mobile (< 480px) */
        @media (max-width: 480px) {
            .content-header h1 {
                font-size: 20px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-card h3 {
                font-size: 28px;
            }

            .loan-card {
                padding: 20px;
            }

            .loan-header h4 {
                font-size: 18px;
            }

            .loan-amount {
                font-size: 24px;
            }

            .action-card {
                padding: 20px;
            }

            .action-card i {
                font-size: 28px;
            }

            .header-user-avatar {
                width: 30px;
                height: 30px;
                font-size: 12px;
            }

            .header-notification {
                width: 35px;
                height: 35px;
            }

            .notification-badge {
                width: 16px;
                height: 16px;
                font-size: 9px;
            }
        }

        /* ============================================ */
        /* CSS VARIABLES FOR PORTFOLIO CARDS */
        /* ============================================ */
        
        :root {
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-light: 0 2px 10px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.12);
            --shadow-heavy: 0 8px 40px rgba(0, 0, 0, 0.16);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --color-green: #38e77b;
            --color-black: #1a1a1a;
            --border-radius-lg: 16px;
            --border-radius-md: 12px;
        }

        body.light-mode {
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --color-black: #1a1a1a;
        }

        body:not(.light-mode) {
            --glass-bg: rgba(30, 41, 59, 0.95);
            --glass-border: rgba(255, 255, 255, 0.1);
            --color-black: #f1f5f9;
        }

        /* ============================================ */
        /* INVESTMENT PORTFOLIO TABLE STYLES */
        /* ============================================ */

        .investments-table-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-medium);
            overflow: hidden;
            margin-top: 20px;
        }

        .table-header {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(56, 231, 123, 0.05), rgba(59, 130, 246, 0.05));
        }

        body:not(.light-mode) .table-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            color: var(--color-black);
        }

        .table-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .table-stats .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body:not(.light-mode) .table-stats .stat-item {
            background: rgba(30, 41, 59, 0.8);
            color: #94a3b8;
        }

        .table-stats .stat-item i {
            color: var(--color-green);
        }

        /* Portfolio Cards Layout - Horizontal Content Format */
        .portfolio-cards {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 20px;
        }

        .portfolio-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-lg);
            padding: 16px 20px;
            box-shadow: var(--shadow-medium);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 20px;
            min-height: 80px;
            max-height: 80px;
        }

        .portfolio-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-green), #34d399);
            opacity: 0;
            transition: var(--transition-normal);
        }

        .portfolio-card:hover::before {
            opacity: 1;
        }

        .portfolio-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-heavy);
        }

        .portfolio-card .card-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            min-width: 220px;
            max-width: 220px;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .borrower-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .borrower-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-green), #34d399);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(56, 231, 123, 0.3);
            flex-shrink: 0;
        }

        .borrower-details {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .borrower-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-black);
            margin-bottom: 2px;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }

        .borrower-purpose {
            font-size: 11px;
            color: #6b7280;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }

        body:not(.light-mode) .borrower-purpose {
            color: #94a3b8;
        }

        .portfolio-card .risk-badge {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-black);
            background: none !important;
            padding: 0;
            border: none !important;
            border-radius: 0;
            min-width: auto;
            height: auto;
            display: flex;
            align-items: center;
            gap: 2px;
            white-space: nowrap;
            position: static;
            margin-top: 4px;
            box-shadow: none;
        }

        .portfolio-card .risk-badge i {
            font-size: 10px;
        }

        .portfolio-card .risk-badge .rating-text {
            margin-left: 4px;
            font-size: 11px;
            font-weight: 700;
        }

        .portfolio-card .risk-badge.low {
            color: var(--color-green) !important;
        }

        .portfolio-card .risk-badge.low i {
            color: var(--color-green) !important;
        }

        .portfolio-card .risk-badge.medium {
            color: #f59e0b !important;
        }

        .portfolio-card .risk-badge.medium i {
            color: #f59e0b !important;
        }

        .portfolio-card .card-body {
            display: flex;
            align-items: center;
            gap: 24px;
            flex: 1;
        }

        .card-metrics {
            display: flex;
            gap: 24px;
            flex: 1;
            align-items: flex-start;
        }

        .metric-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
            min-width: 0;
        }

        .metric-label {
            font-size: 10px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            text-align: left;
        }

        body:not(.light-mode) .metric-label {
            color: #94a3b8;
        }

        .metric-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-black);
            white-space: nowrap;
            text-align: left;
            line-height: 1.2;
        }

        .metric-value.returns-positive {
            color: var(--color-green);
        }

        .card-progress {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 100px;
            max-width: 100px;
            align-self: flex-start;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-info span {
            font-size: 11px;
            font-weight: 600;
            color: #6b7280;
        }

        body:not(.light-mode) .progress-info span {
            color: #94a3b8;
        }

        .progress-info span:last-child {
            color: var(--color-black);
        }

        .card-progress .progress-bar {
            width: 100%;
            height: 5px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        body:not(.light-mode) .card-progress .progress-bar {
            background: rgba(255, 255, 255, 0.1);
        }

        .card-progress .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-green), #34d399);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
            transition: width 0.8s ease;
        }

        .card-actions {
            display: flex;
            gap: 6px;
            margin-left: auto;
        }

        .card-actions .btn-icon {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            color: #6b7280;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            transition: var(--transition-normal);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        body:not(.light-mode) .card-actions .btn-icon {
            background: rgba(30, 41, 59, 0.8);
            color: #94a3b8;
        }

        .card-actions .btn-icon:hover {
            background: var(--color-green);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(56, 231, 123, 0.3);
        }

        /* Table Footer and Pagination */
        .table-footer {
            padding: 20px 30px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            background: rgba(0, 0, 0, 0.02);
        }

        body:not(.light-mode) .table-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
        }

        .table-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #e5e7eb;
            color: var(--color-black);
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
            transition: var(--transition-normal);
        }

        body:not(.light-mode) .btn-outline {
            border-color: #334155;
            color: #94a3b8;
        }

        .btn-outline:hover:not(:disabled) {
            background: rgba(56, 231, 123, 0.1);
            border-color: var(--color-green);
            color: var(--color-green);
        }

        .pagination-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition-normal);
        }

        .pagination-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(56, 231, 123, 0.2);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        body:not(.light-mode) .pagination-info {
            color: #94a3b8;
        }

        /* Responsive Design for Portfolio Cards */
        @media (max-width: 1200px) {
            .portfolio-card {
                flex-wrap: wrap;
                gap: 16px;
                min-height: auto;
                max-height: none;
            }

            .portfolio-card .card-header {
                min-width: auto;
            }

            .card-metrics {
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .portfolio-card {
                flex-direction: column;
                align-items: flex-start;
                padding: 20px;
                gap: 16px;
                min-height: auto;
                max-height: none;
            }

            .portfolio-card .card-header {
                width: 100%;
                justify-content: space-between;
            }

            .portfolio-card .card-body {
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .card-metrics {
                width: 100%;
                flex-direction: column;
                gap: 12px;
            }

            .card-progress {
                width: 100%;
                max-width: none;
            }

            .card-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .table-stats {
                flex-direction: column;
                gap: 10px;
            }

            .table-stats .stat-item {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .portfolio-card {
                padding: 16px;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                padding: 20px;
            }
        }

        /* ============================================ */
        /* AI CHAT WIDGET (KAIRO AI) */
        /* ============================================ */

        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .chat-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #38e77b, #34d399);
            border: none;
            box-shadow: 0 4px 20px rgba(56, 231, 123, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .chat-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(56, 231, 123, 0.6);
        }

        .chat-toggle i {
            font-size: 28px;
            color: white;
        }

        .chat-window {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 380px;
            height: 550px;
            background: #1e293b;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #334155;
        }

        body.light-mode .chat-window {
            background: white;
            border: 2px solid #d1d5db;
        }

        .chat-window.active {
            display: flex;
        }

        .chat-header {
            background: linear-gradient(135deg, #38e77b, #34d399);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-avatar {
            width: 45px;
            height: 45px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-avatar i {
            font-size: 24px;
            color: #38e77b;
        }

        .chat-header-text h3 {
            color: white;
            font-size: 18px;
            margin-bottom: 2px;
        }

        .chat-header-text p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
        }

        .chat-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            color: white;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            background: #0f172a;
            max-height: 300px;
            scroll-behavior: smooth;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #38e77b;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #34d399;
        }

        body.light-mode .chat-messages {
            background: #f9fafb;
        }

        body.light-mode .chat-messages::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        .chat-message {
            margin-bottom: 16px;
            display: flex;
            gap: 10px;
        }

        .chat-message.ai {
            flex-direction: row;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #38e77b, #34d399);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message-avatar i {
            color: white;
            font-size: 16px;
        }

        .chat-message.user .message-avatar {
            background: #3b82f6;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            background: #1e293b;
            color: white;
        }

        body.light-mode .message-bubble {
            background: white;
            color: #1f2937;
            border: 1px solid #e5e7eb;
        }

        .chat-message.user .message-bubble {
            background: #3b82f6;
            color: white;
        }

        body.light-mode .chat-message.user .message-bubble {
            background: #3b82f6;
            color: white;
            border: none;
        }

        .message-time {
            font-size: 10px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .quick-replies {
            padding: 10px 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            background: #0f172a;
            border-top: 1px solid #334155;
        }

        body.light-mode .quick-replies {
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
        }

        .quick-reply-btn {
            padding: 8px 16px;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 20px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        body.light-mode .quick-reply-btn {
            background: white;
            border: 1px solid #d1d5db;
            color: #1f2937;
        }

        .quick-reply-btn:hover {
            background: #38e77b;
            border-color: #38e77b;
            color: white;
        }

        .chat-input-container {
            padding: 16px;
            background: #1e293b;
            border-top: 1px solid #334155;
            display: flex;
            gap: 10px;
        }

        body.light-mode .chat-input-container {
            background: white;
            border-top: 1px solid #e5e7eb;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 25px;
            color: white;
            outline: none;
        }

        body.light-mode .chat-input {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            color: #1f2937;
        }

        .chat-input::placeholder {
            color: #64748b;
        }

        .chat-send-btn {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #38e77b, #34d399);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
        }

        .chat-send-btn i {
            font-size: 18px;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #64748b;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        @media (max-width: 768px) {
            .chat-window {
                width: calc(100vw - 40px);
                height: calc(100vh - 120px);
                bottom: 70px;
                right: 20px;
                left: 20px;
            }

            .chat-toggle {
                width: 55px;
                height: 55px;
            }
        }

        /* Profile Completion Banner */
        .profile-completion-banner {
            position: relative;
            margin-bottom: 30px;
            animation: slideDownBanner 0.6s ease-out;
        }

        @keyframes slideDownBanner {
            from {
                transform: translateY(-120%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .banner-content {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 16px;
            padding: 24px 30px;
            box-shadow:
                0 0 60px rgba(239, 68, 68, 0.3),
                0 0 120px rgba(239, 68, 68, 0.2),
                0 0 180px rgba(239, 68, 68, 0.1),
                0 25px 50px rgba(239, 68, 68, 0.15),
                0 0 0 1px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            gap: 20px;
            color: #0f172a;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(239, 68, 68, 0.6);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            animation: registrationBannerEntrance 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes registrationBannerEntrance {
            0% {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
                filter: drop-shadow(0 0 0 rgba(239, 68, 68, 0));
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: drop-shadow(0 0 60px rgba(239, 68, 68, 0.3));
            }
        }

        .banner-content:hover {
            transform: translateY(-3px);
            box-shadow:
                0 16px 56px rgba(239, 68, 68, 0.45),
                0 0 80px rgba(239, 68, 68, 0.35),
                0 0 140px rgba(239, 68, 68, 0.25),
                0 0 0 1px rgba(239, 68, 68, 0.5);
            border-color: rgba(239, 68, 68, 0.8);
        }

        .banner-icon {
            font-size: 36px;
            opacity: 0.95;
            flex-shrink: 0;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.3));
            }
            50% {
                transform: scale(1.08);
                filter: drop-shadow(0 0 30px rgba(239, 68, 68, 0.5));
            }
        }

        .banner-text {
            flex: 1;
        }

        .banner-text h3 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #0f172a;
        }

        .banner-text p {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
            color: rgba(15, 23, 42, 0.85);
        }

        .banner-importance {
            font-size: 13px;
            font-style: italic;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(15, 23, 42, 0.15);
        }

        .banner-importance strong {
            font-weight: 700;
            color: #0f172a;
        }

        .banner-click-hint {
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            display: inline-block;
            color: #0f172a;
        }

        .banner-actions {
            display: flex;
            align-items: flex-start;
        }

        .btn-dismiss {
            background: rgba(15, 23, 42, 0.15);
            border: none;
            color: #0f172a;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .btn-dismiss:hover {
            background: rgba(239, 68, 68, 0.25);
            transform: rotate(90deg);
        }

        @media (max-width: 768px) {
            .banner-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 20px;
            }

            .banner-icon {
                font-size: 32px;
            }

            .banner-text h3 {
                font-size: 20px;
            }

            .banner-text p {
                font-size: 13px;
            }

            .banner-click-hint {
                width: 100%;
                text-align: center;
            }

            .btn-dismiss {
                position: absolute;
                top: 12px;
                right: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Sidebar -->
    <aside class="dashboard-sidebar" id="sidebar">
        <div class="sidebar-logo">
            <img src="assets/images/Zimcrowd_Dark.png" alt="ZimCrowd">
        </div>

        <nav>
            <ul class="nav-menu">
                <li>
                    <a href="#" class="nav-link active" data-section="overview">
                        <i class="fas fa-home"></i>
                        <span>Overview</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-section="loans">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>My Loans</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-section="wallet">
                        <i class="fas fa-wallet"></i>
                        <span>Wallet</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-section="investments">
                        <i class="fas fa-chart-line"></i>
                        <span>Investments</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-section="transactions">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Transactions</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-section="referrals">
                        <i class="fas fa-gift"></i>
                        <span>Referral Program</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link" data-section="settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-text">Dark Mode</span>
                <i class="fas fa-moon" id="theme-icon"></i>
            </div>
            <a href="login.html" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-content">
        <header class="content-header">
            <h1 id="page-title">Dashboard Overview</h1>
            <div class="header-actions">
                <div class="header-notification" id="notification-btn" onclick="toggleNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notification-count">3</span>
                </div>
                <div class="header-user">
                    <div class="header-user-avatar" id="nav-avatar">TM</div>
                    <div class="header-user-info">
                        <h4>Tendai Moyo</h4>
                        <p>Premium Member</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notification-panel">
            <div class="notification-header">
                <h3>Notifications</h3>
                <span class="mark-all-read" onclick="markAllAsRead()">Mark all as read</span>
            </div>
            <div class="notification-list">
                <!-- Investment Return Notification -->
                <div class="notification-item unread" onclick="markAsRead(this)">
                    <div class="notification-icon success">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Investment Return Received</div>
                        <div class="notification-message">You received $75.00 from Tendai M.'s education loan</div>
                        <div class="notification-time">2 hours ago</div>
                    </div>
                </div>

                <!-- Payment Due Notification -->
                <div class="notification-item unread" onclick="markAsRead(this)">
                    <div class="notification-icon warning">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Payment Due Soon</div>
                        <div class="notification-message">Your loan payment of $250.00 is due in 3 days</div>
                        <div class="notification-time">5 hours ago</div>
                    </div>
                </div>

                <!-- New Investment Opportunity -->
                <div class="notification-item unread" onclick="markAsRead(this)">
                    <div class="notification-icon info">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">New Investment Opportunity</div>
                        <div class="notification-message">A new business loan opportunity matching your criteria is available</div>
                        <div class="notification-time">1 day ago</div>
                    </div>
                </div>

                <!-- Loan Approved -->
                <div class="notification-item" onclick="markAsRead(this)">
                    <div class="notification-icon success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Loan Application Approved</div>
                        <div class="notification-message">Your loan application for $5,000 has been approved</div>
                        <div class="notification-time">2 days ago</div>
                    </div>
                </div>

                <!-- Account Verification -->
                <div class="notification-item" onclick="markAsRead(this)">
                    <div class="notification-icon success">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Account Verified</div>
                        <div class="notification-message">Your identity verification has been completed successfully</div>
                        <div class="notification-time">3 days ago</div>
                    </div>
                </div>

                <!-- Wallet Deposit -->
                <div class="notification-item" onclick="markAsRead(this)">
                    <div class="notification-icon success">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Wallet Credited</div>
                        <div class="notification-message">$1,000.00 has been added to your wallet</div>
                        <div class="notification-time">4 days ago</div>
                    </div>
                </div>

                <!-- Security Alert -->
                <div class="notification-item" onclick="markAsRead(this)">
                    <div class="notification-icon danger">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">Security Alert</div>
                        <div class="notification-message">New login detected from Harare, Zimbabwe</div>
                        <div class="notification-time">5 days ago</div>
                    </div>
                </div>
            </div>
            <div class="notification-footer">
                <a href="#" onclick="viewAllNotifications(); return false;">View All Notifications</a>
            </div>
        </div>

        <!-- Overview Section -->
        <section id="overview-section" class="dashboard-section active">
            <!-- Profile Completion Banner -->
            <div class="profile-completion-banner" id="profileCompletionBanner" style="display: none;" onclick="completeRegistration()">
                <div class="banner-content">
                    <div class="banner-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="banner-text">
                        <h3>Complete Your Registration</h3>
                        <p>To fully access ZimCrowd's features and apply for loans, please complete your profile verification. This includes KYC verification, personal details, and payment method setup.</p>
                        <p class="banner-importance"><strong>Why complete registration?</strong> It helps us verify your identity, assess your creditworthiness, and provide you with personalized loan offers and better interest rates.</p>
                        <p class="banner-click-hint">Click anywhere on this banner to get started </p>
                    </div>
                    <div class="banner-actions">
                        <button class="btn-dismiss" onclick="event.stopPropagation(); dismissBanner();">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>$15,450</h3>
                    <p>Total Balance</p>
                </div>
                <div class="stat-card">
                    <h3>$12,450</h3>
                    <p>Total Loans</p>
                </div>
                <div class="stat-card">
                    <h3>$8,200</h3>
                    <p>Investments</p>
                </div>
                <div class="stat-card">
                    <h3>5</h3>
                    <p>Active Loans</p>
                </div>
            </div>

            <!-- Primary Market Section -->
            <div style="margin: 40px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;"> Primary Market - New Loan Opportunities</h2>
                    <a href="primary-market.html" style="color: #38e77b; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 5px;">
                        View All <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                <div id="primaryMarketLoans" class="portfolio-cards" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Primary market loans will be loaded here -->
                    <div style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #38e77b;"></i>
                        <p style="margin-top: 10px; color: #94a3b8;">Loading investment opportunities...</p>
                    </div>
                </div>
            </div>

            <!-- Secondary Market Section -->
            <div style="margin: 40px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;"> Secondary Market - Trade Existing Investments</h2>
                    <a href="secondary-market.html" style="color: #38e77b; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 5px;">
                        View All <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                <div id="secondaryMarketLoans" class="portfolio-cards" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Secondary market loans will be loaded here -->
                    <div style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #38e77b;"></i>
                        <p style="margin-top: 10px; color: #94a3b8;">Loading trading opportunities...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- My Loans Section -->
        <section id="loans-section" class="dashboard-section">
            <h2 style="margin-bottom: 30px;">My Loans</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(56, 231, 123, 0.1);">
                        <i class="fas fa-sack-dollar" style="color: #38e77b;"></i>
                    </div>
                    <h3 id="totalLoanAmount">$0</h3>
                    <p>Total Loan Amount</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(59, 130, 246, 0.1);">
                        <i class="fas fa-calendar-days" style="color: #3b82f6;"></i>
                    </div>
                    <h3 id="averageTerm">0 Months</h3>
                    <p>Average Term</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-percent" style="color: #f59e0b;"></i>
                    </div>
                    <h3 id="averageInterest">0%</h3>
                    <p>Average Interest</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(168, 85, 247, 0.1);">
                        <i class="fas fa-file-invoice-dollar" style="color: #a855f7;"></i>
                    </div>
                    <h3 id="activeLoansCount">0 Active</h3>
                    <p>Current Loans</p>
                </div>
            </div>

            <!-- Direct Loan CTA -->
            <div style="margin: 30px 0; padding: 25px; background: linear-gradient(135deg, #38e07b 0%, #2ecc71 100%); border-radius: 16px; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i class="fas fa-bolt" style="color: white; font-size: 24px;"></i>
                        <span style="background: rgba(255,255,255,0.3); padding: 4px 12px; border-radius: 12px; color: white; font-size: 12px; font-weight: 600;">ZimCrowd Direct</span>
                    </div>
                    <h3 style="color: white; font-size: 24px; margin-bottom: 8px;">Need Instant Funding?</h3>
                    <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">Get guaranteed approval and funds in minutes with ZimCrowd Direct loans</p>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="window.location.href='direct-loan-request.html'" style="padding: 12px 24px; background: white; color: #2ecc71; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <i class="fas fa-rocket"></i> Get Instant Loan
                        </button>
                        <button onclick="showDirectLoanInfo()" style="padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(10px);">
                            <i class="fas fa-info-circle"></i> Learn More
                        </button>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchLoanTab('active')">Active Loans (<span id="activeLoansTabCount">0</span>)</button>
                <button class="tab-btn" onclick="switchLoanTab('completed')">Completed (<span id="completedLoansTabCount">0</span>)</button>
                <button class="tab-btn" onclick="switchLoanTab('applications')">Applications (<span id="pendingLoansTabCount">0</span>)</button>
            </div>

            <div id="active-tab" class="tab-content active" data-loan-container="active">
                <div class="loan-card">
                    <div class="loan-header">
                        <div>
                            <h4>Personal Loan</h4>
                            <span class="loan-status">Active</span>
                            <span class="risk-badge low">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span class="rating-text">4.5/5</span>
                            </span>
                        </div>
                        <div class="loan-amount">$3,500</div>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>Monthly Payment</span>
                            <strong>$185.50</strong>
                        </div>
                        <div class="detail-row">
                            <span>Interest Rate</span>
                            <strong>7.5%</strong>
                        </div>
                        <div class="detail-row">
                            <span>Term</span>
                            <strong>24 months</strong>
                        </div>
                        <div class="detail-row">
                            <span>Next Payment</span>
                            <strong>Dec 15, 2024</strong>
                        </div>
                    </div>
                    <div class="loan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%"></div>
                        </div>
                        <div class="progress-text">45% paid off</div>
                    </div>
                </div>

                <div class="loan-card">
                    <div class="loan-header">
                        <div>
                            <h4>Business Loan</h4>
                            <span class="loan-status">Active</span>
                            <span class="risk-badge medium">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <i class="far fa-star"></i>
                                <span class="rating-text">3.5/5</span>
                            </span>
                        </div>
                        <div class="loan-amount">$5,000</div>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>Monthly Payment</span>
                            <strong>$312.50</strong>
                        </div>
                        <div class="detail-row">
                            <span>Interest Rate</span>
                            <strong>9.2%</strong>
                        </div>
                        <div class="detail-row">
                            <span>Term</span>
                            <strong>18 months</strong>
                        </div>
                        <div class="detail-row">
                            <span>Next Payment</span>
                            <strong>Dec 20, 2024</strong>
                        </div>
                    </div>
                    <div class="loan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 30%"></div>
                        </div>
                        <div class="progress-text">30% paid off</div>
                    </div>
                </div>

                <div class="loan-card">
                    <div class="loan-header">
                        <div>
                            <h4>Education Loan</h4>
                            <span class="loan-status">Active</span>
                            <span class="risk-badge low">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <span class="rating-text">5.0/5</span>
                            </span>
                        </div>
                        <div class="loan-amount">$3,950</div>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>Monthly Payment</span>
                            <strong>$165.42</strong>
                        </div>
                        <div class="detail-row">
                            <span>Interest Rate</span>
                            <strong>6.8%</strong>
                        </div>
                        <div class="detail-row">
                            <span>Term</span>
                            <strong>30 months</strong>
                        </div>
                        <div class="detail-row">
                            <span>Next Payment</span>
                            <strong>Dec 10, 2024</strong>
                        </div>
                    </div>
                    <div class="loan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 62%"></div>
                        </div>
                        <div class="progress-text">62% paid off</div>
                    </div>
                </div>

                <!-- Pagination for Active Loans -->
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 30px; padding: 20px; background: rgba(15, 23, 42, 0.5); border-radius: 12px;" data-pagination="activeLoans">
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('activeLoans', 'prev')" data-prev-btn>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;" data-page-buttons>
                        <button onclick="goToPage('activeLoans', 1)" class="page-number-btn active" data-page-btn="1">1</button>
                        <button onclick="goToPage('activeLoans', 2)" class="page-number-btn" data-page-btn="2">2</button>
                        <span style="color: #94a3b8; font-size: 14px; margin-left: 10px;">
                            Page <span style="font-weight: 600; color: #38e77b;" data-page-number>1</span> of 2 (5 active loans)
                        </span>
                    </div>
                    
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('activeLoans', 'next')" data-next-btn>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div id="completed-tab" class="tab-content" data-loan-container="completed">
                <div class="loan-card">
                    <div class="loan-header">
                        <div>
                            <h4>Personal Loan</h4>
                            <span class="loan-status" style="background: rgba(56, 231, 123, 0.2); color: #38e77b;">Completed</span>
                            <span class="risk-badge low">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <span class="rating-text">5.0/5</span>
                            </span>
                        </div>
                        <div class="loan-amount">$2,000</div>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>Total Paid</span>
                            <strong>$2,120</strong>
                        </div>
                        <div class="detail-row">
                            <span>Interest Paid</span>
                            <strong>$120</strong>
                        </div>
                        <div class="detail-row">
                            <span>Completion Date</span>
                            <strong>Oct 15, 2024</strong>
                        </div>
                    </div>
                    <div class="loan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                        <div class="progress-text">100% paid off</div>
                    </div>
                </div>
            </div>

            <div id="applications-tab" class="tab-content" data-loan-container="pending">
                <div class="loan-card">
                    <div class="loan-header">
                        <div>
                            <h4>Car Loan Application</h4>
                            <span class="loan-status" style="background: rgba(245, 158, 11, 0.2); color: #f59e0b;">Under Review</span>
                            <span class="risk-badge medium">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                                <span class="rating-text">4.0/5</span>
                            </span>
                        </div>
                        <div class="loan-amount">$8,000</div>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>Application Date</span>
                            <strong>Nov 25, 2024</strong>
                        </div>
                        <div class="detail-row">
                            <span>Estimated Rate</span>
                            <strong>7.2%</strong>
                        </div>
                        <div class="detail-row">
                            <span>Status</span>
                            <strong>Document Review</strong>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Wallet Section -->
        <section id="wallet-section" class="dashboard-section">
            <h2 style="margin-bottom: 30px;">Wallet & Funds</h2>
            
            <div class="stats-grid">
                <div class="stat-card featured-balance-card">
                    <div class="stat-icon" style="background: rgba(255, 255, 255, 0.2);">
                        <i class="fas fa-wallet" style="color: white;"></i>
                    </div>
                    <h3 id="walletAvailableBalance">$0.00</h3>
                    <p>Available Balance</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-clock" style="color: #f59e0b;"></i>
                    </div>
                    <h3 id="walletPending">$0.00</h3>
                    <p>Pending</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(59, 130, 246, 0.1);">
                        <i class="fas fa-receipt" style="color: #3b82f6;"></i>
                    </div>
                    <h3 id="walletTotalTransactions">$0.00</h3>
                    <p>Total Transactions</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(168, 85, 247, 0.1);">
                        <i class="fas fa-calendar-check" style="color: #a855f7;"></i>
                    </div>
                    <h3 id="walletThisMonth">$0.00</h3>
                    <p>This Month</p>
                </div>
            </div>

            <h3 style="margin: 30px 0 20px;">Quick Actions</h3>
            <div class="quick-actions">
                <div class="action-card" onclick="showDepositModal()" style="cursor: pointer;">
                    <i class="fas fa-plus"></i>
                    <h3>Add Funds</h3>
                    <p>Deposit money</p>
                </div>
                <div class="action-card" onclick="showWithdrawModal()" style="cursor: pointer;">
                    <i class="fas fa-minus"></i>
                    <h3>Withdraw</h3>
                    <p>Transfer to bank</p>
                </div>
                <div class="action-card" onclick="showTransferModal()" style="cursor: pointer;">
                    <i class="fas fa-exchange-alt"></i>
                    <h3>Transfer</h3>
                    <p>Send to others</p>
                </div>
                <div class="action-card" onclick="loadWalletTransactions()" style="cursor: pointer;">
                    <i class="fas fa-history"></i>
                    <h3>History</h3>
                    <p>View transactions</p>
                </div>
            </div>

            <h3 style="margin: 40px 0 20px;">Recent Transactions</h3>
            <div id="walletRecentTransactions" class="transaction-list" style="display: flex; flex-direction: column; gap: 15px;">
                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-down" style="color: #38e77b;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Loan Disbursement</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Nov 20, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 20px;">+$3,500</div>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(239, 68, 68, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="color: #ef4444;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Loan Payment</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Nov 15, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 20px; font-weight: 700; color: #ef4444;">-$185.50</div>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-down" style="color: #38e77b;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Investment Return</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Nov 10, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 20px;">+$125.00</div>
                        </div>
                    </div>
                </div>

                <!-- Pagination for Wallet Transactions -->
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 30px; padding: 20px; background: rgba(15, 23, 42, 0.5); border-radius: 12px;" data-pagination="walletTransactions">
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('walletTransactions', 'prev')" data-prev-btn>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;" data-page-buttons>
                        <button onclick="goToPage('walletTransactions', 1)" class="page-number-btn active" data-page-btn="1">1</button>
                        <button onclick="goToPage('walletTransactions', 2)" class="page-number-btn" data-page-btn="2">2</button>
                        <button onclick="goToPage('walletTransactions', 3)" class="page-number-btn" data-page-btn="3">3</button>
                        <span style="color: #94a3b8; font-size: 14px; margin-left: 10px;">
                            Page <span style="font-weight: 600; color: #38e77b;" data-page-number>1</span> of 3 (18 transactions)
                        </span>
                    </div>
                    
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('walletTransactions', 'next')" data-next-btn>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Investments Section -->
        <section id="investments-section" class="dashboard-section">
            <h2 style="margin-bottom: 30px;">My Investments</h2>

            <div class="tabs" style="margin-bottom: 30px;">
                <button class="tab-btn active" onclick="switchInvestmentTab('portfolio')">My Portfolio</button>
                <button class="tab-btn" onclick="switchInvestmentTab('secondary')">Secondary Market</button>
                <button class="tab-btn" onclick="switchInvestmentTab('performance')">Performance</button>
            </div>

            <!-- My Portfolio Tab -->
            <div id="portfolio-tab" class="tab-content active">
                <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(56, 231, 123, 0.1);">
                        <i class="fas fa-chart-line" style="color: #38e77b;"></i>
                    </div>
                    <h3 id="portfolioTotalInvested">$0</h3>
                    <p>Total Invested</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(59, 130, 246, 0.1);">
                        <i class="fas fa-arrow-trend-up" style="color: #3b82f6;"></i>
                    </div>
                    <h3 id="portfolioAvgReturn">0%</h3>
                    <p>Average Return</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-briefcase" style="color: #f59e0b;"></i>
                    </div>
                    <h3 id="portfolioActiveCount">0</h3>
                    <p>Active Investments</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(168, 85, 247, 0.1);">
                        <i class="fas fa-coins" style="color: #a855f7;"></i>
                    </div>
                    <h3 id="portfolioTotalReturns">$0</h3>
                    <p>Total Returns</p>
                </div>
            </div>

            <!-- Your Investment Portfolio -->
            <div class="investments-table-container">
                <div class="table-header">
                    <h3>Your Investment Portfolio</h3>
                    <div class="table-stats">
                        <span class="stat-item">
                            <i class="fas fa-chart-line"></i>
                            <span id="portfolioHeaderInvested">$0.00 Total Invested</span>
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-trending-up"></i>
                            <span id="portfolioHeaderReturns">$0.00 Total Returns</span>
                        </span>
                        <span class="stat-item">
                            <i class="fas fa-percentage"></i>
                            <span id="portfolioHeaderAvgReturn">0% Avg. Return</span>
                        </span>
                    </div>
                </div>

                <div id="portfolioCardsContainer" class="portfolio-cards">
                    <!-- Tendai M. - Education Loan -->
                    <div class="portfolio-card">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">T</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">Tendai M.</div>
                                    <div class="borrower-purpose">Education Loan</div>
                                    <span class="risk-badge low">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <span class="rating-text">4.5/5</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Principal</span>
                                    <span class="metric-value">$500.00</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Returns</span>
                                    <span class="metric-value returns-positive">+$75.00 (15%)</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Monthly Return</span>
                                    <span class="metric-value">$6.25</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Progress</span>
                                    <span>45%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 45%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-icon" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" title="Auto-invest Similar">
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Rufaro N. - Business Loan -->
                    <div class="portfolio-card">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">R</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">Rufaro N.</div>
                                    <div class="borrower-purpose">Business Loan</div>
                                    <span class="risk-badge medium">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <i class="far fa-star"></i>
                                        <span class="rating-text">3.5/5</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Principal</span>
                                    <span class="metric-value">$1,000.00</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Returns</span>
                                    <span class="metric-value returns-positive">+$200.00 (20%)</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Monthly Return</span>
                                    <span class="metric-value">$16.67</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Progress</span>
                                    <span>75%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 75%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-icon" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" title="Auto-invest Similar">
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Chipo K. - Medical Loan -->
                    <div class="portfolio-card">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">C</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">Chipo K.</div>
                                    <div class="borrower-purpose">Medical Loan</div>
                                    <span class="risk-badge low">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <span class="rating-text">4.5/5</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Principal</span>
                                    <span class="metric-value">$300.00</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Returns</span>
                                    <span class="metric-value returns-positive">+$36.00 (12%)</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Monthly Return</span>
                                    <span class="metric-value">$3.00</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Progress</span>
                                    <span>90%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 90%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-icon" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" title="Auto-invest Similar">
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Tawanda S. - Home Improvement -->
                    <div class="portfolio-card">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">T</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">Tawanda S.</div>
                                    <div class="borrower-purpose">Home Improvement</div>
                                    <span class="risk-badge low">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <span class="rating-text">4.5/5</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Principal</span>
                                    <span class="metric-value">$750.00</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Returns</span>
                                    <span class="metric-value returns-positive">+$105.00 (14%)</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Monthly Return</span>
                                    <span class="metric-value">$8.75</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Progress</span>
                                    <span>35%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 35%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-icon" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" title="Auto-invest Similar">
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Nyasha D. - Education Loan -->
                    <div class="portfolio-card">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">N</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">Nyasha D.</div>
                                    <div class="borrower-purpose">Education Loan</div>
                                    <span class="risk-badge low">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <span class="rating-text">4.5/5</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Principal</span>
                                    <span class="metric-value">$400.00</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Returns</span>
                                    <span class="metric-value returns-positive">+$48.00 (12%)</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Monthly Return</span>
                                    <span class="metric-value">$4.00</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Progress</span>
                                    <span>60%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 60%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-icon" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" title="Auto-invest Similar">
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Farai M. - Business Startup -->
                    <div class="portfolio-card">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">F</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">Farai M.</div>
                                    <div class="borrower-purpose">Business Startup</div>
                                    <span class="risk-badge medium">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <i class="far fa-star"></i>
                                        <span class="rating-text">3.5/5</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Principal</span>
                                    <span class="metric-value">$1,500.00</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Returns</span>
                                    <span class="metric-value returns-positive">+$270.00 (18%)</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Monthly Return</span>
                                    <span class="metric-value">$22.50</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Progress</span>
                                    <span>25%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 25%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-icon" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" title="Auto-invest Similar">
                                <i class="fas fa-robot"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Pagination for Investment Portfolio -->
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 30px; padding: 20px; background: rgba(15, 23, 42, 0.5); border-radius: 12px;" data-pagination="myPortfolio">
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('myPortfolio', 'prev')" data-prev-btn>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;" data-page-buttons>
                        <button onclick="goToPage('myPortfolio', 1)" class="page-number-btn active" data-page-btn="1">1</button>
                        <button onclick="goToPage('myPortfolio', 2)" class="page-number-btn" data-page-btn="2">2</button>
                        <button onclick="goToPage('myPortfolio', 3)" class="page-number-btn" data-page-btn="3">3</button>
                        <span style="color: #94a3b8; font-size: 14px; margin-left: 10px;">
                            Page <span style="font-weight: 600; color: #38e77b;" data-page-number>1</span> of 3 (8 investments)
                        </span>
                    </div>
                    
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('myPortfolio', 'next')" data-next-btn>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            </div>

            <!-- Secondary Market Tab -->
            <div id="secondary-tab" class="tab-content">
                <div class="loan-card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Browse Secondary Market</h3>
                    <p style="color: #94a3b8; margin-bottom: 20px;">Purchase performing loan positions from other lenders</p>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <select style="padding: 10px 15px;">
                            <option>All Risk Levels</option>
                            <option>Low Risk</option>
                            <option>Medium Risk</option>
                            <option>High Risk</option>
                        </select>
                        <select style="padding: 10px 15px;">
                            <option>All Terms</option>
                            <option>< 6 months</option>
                            <option>6-12 months</option>
                            <option>> 12 months</option>
                        </select>
                        <select style="padding: 10px 15px;">
                            <option>Sort: Highest Yield</option>
                            <option>Sort: Lowest Risk</option>
                            <option>Sort: Shortest Term</option>
                            <option>Sort: Price Low to High</option>
                        </select>
                    </div>
                </div>

                <!-- Secondary Market Loan 1 -->
                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h4>Medical Equipment Loan</h4>
                            <div style="display: flex; gap: 10px; margin-top: 8px;">
                                <span class="risk-badge low">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    <span class="rating-text">4.5/5</span>
                                </span>
                                <span style="padding: 4px 12px; background: rgba(56, 231, 123, 0.1); color: #38e77b; border-radius: 12px; font-size: 12px; font-weight: 600;">Low Risk</span>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 24px;">$1,850</div>
                            <p style="color: #64748b; font-size: 12px;">Purchase Price</p>
                        </div>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>Original Lender</span>
                            <strong>Michael K.</strong>
                        </div>
                        <div class="detail-row">
                            <span>Remaining Term</span>
                            <strong>8 months</strong>
                        </div>
                        <div class="detail-row">
                            <span>Expected Yield</span>
                            <strong style="color: #38e77b;">14.2%</strong>
                        </div>
                        <div class="detail-row">
                            <span>Monthly Return</span>
                            <strong>$32.50</strong>
                        </div>
                        <div class="detail-row">
                            <span>Total Return</span>
                            <strong style="color: #38e77b;">+$260</strong>
                        </div>
                        <div class="detail-row">
                            <span>Payment History</span>
                            <strong style="color: #38e77b;">100% On-Time</strong>
                        </div>
                    </div>
                    <div class="loan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                        <div class="progress-text">60% completed (12 of 20 payments)</div>
                    </div>
                    <button class="btn-primary" style="width: 100%; margin-top: 15px;">Purchase Loan Position</button>
                </div>

                <!-- Secondary Market Loan 2 -->
                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h4>Small Business Expansion</h4>
                            <div style="display: flex; gap: 10px; margin-top: 8px;">
                                <span class="risk-badge medium">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    <i class="far fa-star"></i>
                                    <span class="rating-text">3.5/5</span>
                                </span>
                                <span style="padding: 4px 12px; background: rgba(249, 115, 22, 0.1); color: #f97316; border-radius: 12px; font-size: 12px; font-weight: 600;">Medium Risk</span>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 24px;">$2,400</div>
                            <p style="color: #64748b; font-size: 12px;">Purchase Price</p>
                        </div>
                    </div>
                    <div class="loan-details">
                        <div class="detail-row">
                            <span>Original Lender</span>
                            <strong>Sarah T.</strong>
                        </div>
                        <div class="detail-row">
                            <span>Remaining Term</span>
                            <strong>11 months</strong>
                        </div>
                        <div class="detail-row">
                            <span>Expected Yield</span>
                            <strong style="color: #38e77b;">17.5%</strong>
                        </div>
                        <div class="detail-row">
                            <span>Monthly Return</span>
                            <strong>$42.00</strong>
                        </div>
                        <div class="detail-row">
                            <span>Total Return</span>
                            <strong style="color: #38e77b;">+$462</strong>
                        </div>
                        <div class="detail-row">
                            <span>Payment History</span>
                            <strong style="color: #38e77b;">95% On-Time</strong>
                        </div>
                    </div>
                    <div class="loan-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%"></div>
                        </div>
                        <div class="progress-text">45% completed (9 of 20 payments)</div>
                    </div>
                    <button class="btn-primary" style="width: 100%; margin-top: 15px;">Purchase Loan Position</button>
                </div>

                <!-- Pagination for Secondary Market -->
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 30px; padding: 20px; background: rgba(15, 23, 42, 0.5); border-radius: 12px;" data-pagination="secondaryMarket">
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('secondaryMarket', 'prev')" data-prev-btn>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div style="display: flex; align-items: center; gap: 8px;" data-page-buttons>
                        <button onclick="goToPage('secondaryMarket', 1)" class="page-number-btn active" data-page-btn="1">1</button>
                        <button onclick="goToPage('secondaryMarket', 2)" class="page-number-btn" data-page-btn="2">2</button>
                        <button onclick="goToPage('secondaryMarket', 3)" class="page-number-btn" data-page-btn="3">3</button>
                        <span style="color: #94a3b8; font-size: 14px; margin-left: 10px;">Page <span style="font-weight: 600; color: #38e77b;" data-page-number>1</span> of 3 (15 available loans)</span>
                    </div>
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('secondaryMarket', 'next')" data-next-btn>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Performance Tab -->
            <div id="performance-tab" class="tab-content">
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <h3 id="perfTotalEarnings" style="font-size: 32px; color: #38e77b;">+$0</h3>
                        <p>Total Earnings (All Time)</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="perfThisMonth" style="font-size: 32px; color: #3b82f6;">+$0</h3>
                        <p>This Month</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="perfAvgReturn" style="font-size: 32px; color: #a855f7;">0%</h3>
                        <p>Average Annual Return</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="perfOnTimePayments" style="font-size: 32px; color: #38e77b;">0%</h3>
                        <p>On-Time Payments</p>
                    </div>
                </div>

                <div class="loan-card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 20px;">Performance Over Time</h3>
                    <div style="height: 300px; background: #0f172a; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                        <div style="text-align: center;">
                            <i class="fas fa-chart-line" style="font-size: 64px; margin-bottom: 15px;"></i>
                            <p>Chart.js will be integrated here</p>
                            <p style="font-size: 14px; margin-top: 10px;">Line chart showing investment returns over time</p>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">Investment Breakdown</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <div style="height: 200px; background: #0f172a; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                <div style="text-align: center;">
                                    <i class="fas fa-chart-pie" style="font-size: 48px; margin-bottom: 10px;"></i>
                                    <p>Portfolio Allocation</p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px;">Risk Distribution</h4>
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #38e77b;"> Low Risk</span>
                                    <strong id="riskLowPercent">0%</strong>
                                </div>
                                <div style="background: #0f172a; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div id="riskLowBar" style="width: 0%; height: 100%; background: #38e77b;"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #f97316;"> Medium Risk</span>
                                    <strong id="riskMediumPercent">0%</strong>
                                </div>
                                <div style="background: #0f172a; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div id="riskMediumBar" style="width: 0%; height: 100%; background: #f97316;"></div>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="color: #ef4444;"> High Risk</span>
                                    <strong id="riskHighPercent">0%</strong>
                                </div>
                                <div style="background: #0f172a; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div id="riskHighBar" style="width: 0%; height: 100%; background: #ef4444;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Transactions Section -->
        <section id="transactions-section" class="dashboard-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2>Transaction History</h2>
                <div style="display: flex; gap: 10px;">
                    <select id="transactionTypeFilter" onchange="filterTransactions()" style="padding: 10px 15px; background: #1e293b; border: 1px solid #334155; border-radius: 8px; color: #e2e8f0; cursor: pointer;">
                        <option value="">All Types</option>
                        <option value="deposit">Deposits</option>
                        <option value="withdrawal">Withdrawals</option>
                        <option value="loan_payment">Loan Payments</option>
                        <option value="loan_disbursement">Loan Disbursements</option>
                        <option value="investment">Investments</option>
                        <option value="investment_return">Investment Returns</option>
                        <option value="transfer">Transfers</option>
                    </select>
                    <select id="transactionDateFilter" onchange="filterTransactions()" style="padding: 10px 15px; background: #1e293b; border: 1px solid #334155; border-radius: 8px; color: #e2e8f0; cursor: pointer;">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="3months">Last 3 Months</option>
                        <option value="year">This Year</option>
                    </select>
                    <button onclick="exportTransactions()" class="btn-secondary" style="padding: 10px 20px;">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>

            <div id="transactionsListContainer" style="display: flex; flex-direction: column; gap: 15px;">
                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-chart-line" style="color: #38e77b;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Investment Return</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Sarah's Education Loan  Nov 25, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 20px;">+$31.67</div>
                            <span class="loan-status" style="font-size: 11px;">Completed</span>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(239, 68, 68, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-hand-holding-usd" style="color: #ef4444;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Loan Payment</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Business Loan  Nov 20, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 20px; font-weight: 700; color: #ef4444;">-$312.50</div>
                            <span class="loan-status" style="font-size: 11px;">Completed</span>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-wallet" style="color: #38e77b;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Wallet Deposit</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Bank Transfer  Nov 18, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 20px;">+$1,000</div>
                            <span class="loan-status" style="font-size: 11px;">Completed</span>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(239, 68, 68, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-hand-holding-usd" style="color: #ef4444;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Loan Payment</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Personal Loan  Nov 15, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 20px; font-weight: 700; color: #ef4444;">-$185.50</div>
                            <span class="loan-status" style="font-size: 11px;">Completed</span>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-chart-line" style="color: #38e77b;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Investment Return</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Business Expansion Fund  Nov 12, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 20px;">+$49.33</div>
                            <span class="loan-status" style="font-size: 11px;">Completed</span>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-hand-holding-usd" style="color: #38e77b;"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">Loan Disbursement</h4>
                                <p style="color: #94a3b8; font-size: 14px;">Education Loan  Nov 10, 2024</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 20px;">+$3,950</div>
                            <span class="loan-status" style="font-size: 11px;">Completed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination for Transactions -->
            <div id="transactionsPagination" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 30px; padding: 20px; background: rgba(15, 23, 42, 0.5); border-radius: 12px;">
                <button id="transactionsPrevBtn" class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changeTransactionsPage('prev')">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                
                <!-- Page Info -->
                <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                    <span style="color: #94a3b8; font-size: 14px;">
                        Page <span id="transactionsCurrentPage" style="font-weight: 600; color: #38e77b;">1</span> of <span id="transactionsTotalPages">1</span> (<span id="transactionsTotalCount">0</span> transactions)
                    </span>
                </div>
                
                <button id="transactionsNextBtn" class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changeTransactionsPage('next')">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>

        <!-- Referral Program Section -->
        <section id="referrals-section" class="dashboard-section">
            <h2 style="margin-bottom: 30px;">Referral Program</h2>

            <!-- Referral Overview -->
            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="flex: 1;">
                            <h3 id="refTotalReferrals" style="font-size: 32px; font-weight: 700; margin-bottom: 5px;">0</h3>
                            <p style="color: #94a3b8;">Total Referrals</p>
                        </div>
                        <div style="width: 60px; height: 60px; background: rgba(56, 231, 123, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-users" style="font-size: 28px; color: #38e77b;"></i>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="flex: 1;">
                            <h3 id="refTotalEarnings" style="font-size: 32px; font-weight: 700; margin-bottom: 5px;">$0</h3>
                            <p style="color: #94a3b8;">Total Earnings</p>
                        </div>
                        <div style="width: 60px; height: 60px; background: rgba(59, 130, 246, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-dollar-sign" style="font-size: 28px; color: #3b82f6;"></i>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="flex: 1;">
                            <h3 id="refActiveLoans" style="font-size: 32px; font-weight: 700; margin-bottom: 5px;">0</h3>
                            <p style="color: #94a3b8;">Active Loans</p>
                        </div>
                        <div style="width: 60px; height: 60px; background: rgba(168, 85, 247, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-chart-line" style="font-size: 28px; color: #a855f7;"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referral Code & QR -->
            <div class="loan-card" style="margin-bottom: 20px;">
                <h3 style="margin-bottom: 20px;">Your Referral Code</h3>
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 30px; align-items: center;">
                    <div>
                        <p style="color: #94a3b8; margin-bottom: 15px;">Share your unique code and earn rewards when friends join Zimcrowd!</p>
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
                            <div style="flex: 1; padding: 16px 20px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; display: flex; align-items: center; justify-content: space-between;">
                                <span id="referralCodeDisplay" style="font-size: 24px; font-weight: 700; letter-spacing: 2px; color: #38e77b;">Loading...</span>
                                <button onclick="copyReferralCode()" style="background: rgba(56, 231, 123, 0.1); border: none; padding: 10px 20px; border-radius: 8px; color: #38e77b; cursor: pointer; font-weight: 600;">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button id="shareWhatsApp" class="btn-primary" style="flex: 1; min-width: 150px;">
                                <i class="fab fa-whatsapp"></i> Share on WhatsApp
                            </button>
                            <button id="shareFacebook" class="btn-secondary" style="flex: 1; min-width: 150px;">
                                <i class="fab fa-facebook"></i> Share on Facebook
                            </button>
                            <button id="shareTwitter" class="btn-secondary" style="flex: 1; min-width: 150px;">
                                <i class="fab fa-twitter"></i> Share on Twitter
                            </button>
                            <button id="shareEmail" class="btn-secondary" style="flex: 1; min-width: 150px;">
                                <i class="fas fa-envelope"></i> Share via Email
                            </button>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div id="referralQRCode" style="width: 200px; height: 200px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; padding: 20px;">
                            <div>
                                <div style="width: 160px; height: 160px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-qrcode" style="font-size: 100px; color: #1e293b;"></i>
                                </div>
                            </div>
                        </div>
                        <p style="color: #94a3b8; font-size: 12px; margin-top: 10px;">Scan to refer</p>
                    </div>
                </div>
            </div>

            <!-- How It Works -->
            <div class="loan-card" style="margin-bottom: 20px;">
                <h3 style="margin-bottom: 20px;">How It Works</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px;">
                        <div style="width: 60px; height: 60px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            <i class="fas fa-share-alt" style="font-size: 24px; color: #38e77b;"></i>
                        </div>
                        <h4 style="margin-bottom: 10px;">1. Share Your Code</h4>
                        <p style="color: #94a3b8; font-size: 14px;">Share your unique referral code with friends and family</p>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="width: 60px; height: 60px; background: rgba(59, 130, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            <i class="fas fa-user-plus" style="font-size: 24px; color: #3b82f6;"></i>
                        </div>
                        <h4 style="margin-bottom: 10px;">2. They Sign Up</h4>
                        <p style="color: #94a3b8; font-size: 14px;">Your referrals create an account using your code</p>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="width: 60px; height: 60px; background: rgba(168, 85, 247, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            <i class="fas fa-hand-holding-usd" style="font-size: 24px; color: #a855f7;"></i>
                        </div>
                        <h4 style="margin-bottom: 10px;">3. They Get a Loan</h4>
                        <p style="color: #94a3b8; font-size: 14px;">When they successfully complete their first loan</p>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="width: 60px; height: 60px; background: rgba(249, 115, 22, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            <i class="fas fa-gift" style="font-size: 24px; color: #f97316;"></i>
                        </div>
                        <h4 style="margin-bottom: 10px;">4. You Earn Rewards</h4>
                        <p style="color: #94a3b8; font-size: 14px;">Receive $25 bonus in your wallet</p>
                    </div>
                </div>
            </div>

            <!-- Referral History -->
            <div class="loan-card">
                <h3 style="margin-bottom: 20px;">Your Referrals</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid #334155;">
                                <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Name</th>
                                <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Join Date</th>
                                <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Status</th>
                                <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Loans</th>
                                <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Earnings</th>
                            </tr>
                        </thead>
                        <tbody id="referralHistoryTable">
                            <!-- Referrals will be loaded here dynamically -->
                            <tr style="border-bottom: 1px solid #334155;">
                                <td style="padding: 16px;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">MJ</div>
                                        <span>Mike Johnson</span>
                                    </div>
                                </td>
                                <td style="padding: 16px;">2024-10-20</td>
                                <td style="padding: 16px;">
                                    <span style="padding: 4px 12px; background: rgba(56, 231, 123, 0.1); color: #38e77b; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                        <i class="fas fa-check-circle"></i> Active
                                    </span>
                                </td>
                                <td style="padding: 16px;">2 loans</td>
                                <td style="padding: 16px; color: #38e77b; font-weight: 600;">$50</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #334155;">
                                <td style="padding: 16px;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #a855f7, #9333ea); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">SW</div>
                                        <span>Sarah Williams</span>
                                    </div>
                                </td>
                                <td style="padding: 16px;">2024-11-02</td>
                                <td style="padding: 16px;">
                                    <span style="padding: 4px 12px; background: rgba(249, 115, 22, 0.1); color: #f97316; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                        <i class="fas fa-clock"></i> Pending
                                    </span>
                                </td>
                                <td style="padding: 16px;">0 loans</td>
                                <td style="padding: 16px; color: #64748b;">$0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination for Referrals -->
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; margin-top: 20px; padding: 15px 0;" data-pagination="referrals">
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('referrals', 'prev')" data-prev-btn>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div style="display: flex; align-items: center; gap: 8px;" data-page-buttons>
                        <button onclick="goToPage('referrals', 1)" class="page-number-btn active" data-page-btn="1">1</button>
                        <button onclick="goToPage('referrals', 2)" class="page-number-btn" data-page-btn="2">2</button>
                        <span style="color: #94a3b8; font-size: 13px; margin-left: 10px;">Page <span style="font-weight: 600; color: #38e77b;" data-page-number>1</span> of 2 (12 referrals)</span>
                    </div>
                    <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('referrals', 'next')" data-next-btn>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-section" class="dashboard-section">
            <h2 style="margin-bottom: 30px;">Account Settings</h2>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchSettingsTab('profile')">Profile</button>
                <button class="tab-btn" onclick="switchSettingsTab('security')">Security</button>
                <button class="tab-btn" onclick="switchSettingsTab('notifications')">Notifications</button>
                <button class="tab-btn" onclick="switchSettingsTab('display')">Display</button>
                <button class="tab-btn" onclick="switchSettingsTab('investment')">Investment</button>
                <button class="tab-btn" onclick="switchSettingsTab('privacy')">Privacy</button>
                <button class="tab-btn" onclick="switchSettingsTab('documents')">Documents</button>
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content active">
                <!-- Profile Completion Status -->
                <div class="loan-card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Profile Completion</h3>
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="color: #94a3b8; font-size: 14px;">Complete your profile to unlock all features</span>
                                <span style="font-weight: 700; color: var(--color-green);" id="completion-percentage">0%</span>
                            </div>
                            <div style="background: #334155; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; background: linear-gradient(90deg, var(--color-green), #34d399); border-radius: 4px; width: 0%; transition: width 0.5s ease;" id="completion-bar"></div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <span style="padding: 4px 12px; background: rgba(56, 231, 123, 0.1); color: var(--color-green); border-radius: 12px; font-size: 12px;" id="completion-status">Getting Started</span>
                    </div>
                </div>
                <!-- Profile Picture Section -->
                <div class="loan-card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 20px;">Profile Picture</h3>
                    <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap;">
                        <div style="position: relative;">
                            <div id="profile-avatar" style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #38e77b, #34d399); display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: 700; color: white; box-shadow: 0 8px 24px rgba(56, 231, 123, 0.3); overflow: hidden;">
                                <span id="profile-initials">TM</span>
                            </div>
                            <button onclick="document.getElementById('profile-upload').click()" style="position: absolute; bottom: 0; right: 0; width: 40px; height: 40px; border-radius: 50%; background: var(--color-green); border: 3px solid #1e293b; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition-normal);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" title="Upload Photo">
                                <i class="fas fa-camera" style="color: white; font-size: 16px;"></i>
                            </button>
                            <button id="remove-icon-btn" onclick="removeProfilePicture()" style="position: absolute; top: 0; right: 0; width: 40px; height: 40px; border-radius: 50%; background: #ef4444; border: 3px solid #1e293b; display: none; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition-normal);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" title="Remove Photo">
                                <i class="fas fa-times" style="color: white; font-size: 16px;"></i>
                            </button>
                        </div>
                        <div style="flex: 1; min-width: 250px;">
                            <h4 style="margin-bottom: 10px; color: var(--text-primary);">Change Profile Picture</h4>
                            <p style="color: #94a3b8; margin-bottom: 15px; font-size: 14px;">Upload a new profile picture. JPG, PNG or GIF. Max size 5MB.</p>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <label for="profile-upload" class="btn-primary" style="cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-upload"></i>
                                    <span>Upload New</span>
                                    <input type="file" id="profile-upload" accept="image/*" style="display: none;">
                                </label>
                                <button class="btn-primary" style="display: inline-flex; align-items: center; gap: 8px;" onclick="saveProfilePicture()">
                                    <i class="fas fa-save"></i>
                                    <span>Save</span>
                                </button>
                                <button style="cursor: pointer; display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: #ef4444; color: white; border: none; border-radius: 8px; font-family: 'Space Grotesk', sans-serif; font-weight: 600; font-size: 14px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(239, 68, 68, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)';" onclick="removeProfilePicture()">
                                    <i class="fas fa-trash"></i>
                                    <span>Remove</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">Personal Information</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">First Name</label>
                            <input type="text" id="firstName" placeholder="Enter first name">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Last Name</label>
                            <input type="text" id="lastName" placeholder="Enter last name">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Email</label>
                            <input type="email" id="email" placeholder="Enter email address">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Phone</label>
                            <input type="tel" id="phone" placeholder="Enter phone number">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Date of Birth</label>
                            <input type="date" id="dateOfBirth">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Country</label>
                            <select id="country">
                                <option value="">Select country</option>
                                <option value="ZW">Zimbabwe</option>
                                <option value="ZA">South Africa</option>
                                <option value="KE">Kenya</option>
                                <option value="NG">Nigeria</option>
                                <option value="GH">Ghana</option>
                                <option value="TZ">Tanzania</option>
                                <option value="UG">Uganda</option>
                                <option value="RW">Rwanda</option>
                                <option value="ZM">Zambia</option>
                                <option value="BW">Botswana</option>
                                <option value="NA">Namibia</option>
                                <option value="MZ">Mozambique</option>
                                <option value="ET">Ethiopia</option>
                                <option value="EG">Egypt</option>
                                <option value="MA">Morocco</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary" style="margin-top: 20px;" onclick="saveProfileInfo()">Save Changes</button>
                </div>

                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Address Information</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="grid-column: 1 / -1;">
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Street Address</label>
                            <input type="text" id="streetAddress" placeholder="Enter street address">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">City</label>
                            <select id="city">
                                <option value="">Select city</option>
                                <option value="Harare">Harare</option>
                                <option>Bulawayo</option>
                                <option>Mutare</option>
                                <option>Gweru</option>
                                <option>Kwekwe</option>
                                <option>Kadoma</option>
                                <option>Masvingo</option>
                                <option>Chinhoyi</option>
                                <option>Marondera</option>
                                <option>Norton</option>
                                <option>Chegutu</option>
                                <option>Bindura</option>
                                <option>Zvishavane</option>
                                <option>Victoria Falls</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Suburb/District</label>
                            <input type="text" id="suburb" placeholder="Enter suburb/district">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Postal Code</label>
                            <input type="text" id="postalCode" placeholder="Enter postal code">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-input" id="profileEmail" placeholder="your.email@example.com">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-input" id="profilePhone" placeholder="+263 77 123 4567">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Date of Birth</label>
                                <input type="date" class="form-input" id="profileDob">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gender</label>
                                <select class="form-select" id="profileGender">
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                    <option value="prefer-not-to-say">Prefer not to say</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-input" id="profileAddress" placeholder="Your current address">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Bio</label>
                            <textarea class="form-input" id="profileBio" rows="3" placeholder="Tell us a bit about yourself..."></textarea>
                        </div>

                        <div style="margin-top: 30px;">
                            <button type="button" class="btn btn-primary" onclick="saveProfile()">
                                <i class="fas fa-save"></i> Save Profile Changes
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetProfile()" style="margin-left: 10px;">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Social Login Info -->
                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Social Login Information</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: rgba(56, 231, 123, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(56, 231, 123, 0.3);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <i class="fab fa-google" style="color: #38e77b; font-size: 20px;"></i>
                                <span style="font-weight: 600; color: #38e77b;">Google Account</span>
                            </div>
                            <p id="googleStatus" style="color: #94a3b8; font-size: 14px; margin: 0;">Not connected</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <i class="fab fa-facebook" style="color: #3b82f6; font-size: 20px;"></i>
                                <span style="font-weight: 600; color: #3b82f6;">Facebook Account</span>
                            </div>
                            <p id="facebookStatus" style="color: #94a3b8; font-size: 14px; margin: 0;">Not connected</p>
                        </div>
                    </div>
                </div>

                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">Change Password</h3>
                    <div style="display: flex; flex-direction: column; gap: 20px; max-width: 500px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Enter current password">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">New Password</label>
                            <input type="password" id="newPassword" placeholder="Enter new password">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; color: #94a3b8; font-size: 14px;">Confirm New Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password">
                        </div>
                    </div>
                    <button class="btn-primary" style="margin-top: 20px;" onclick="changePassword()">Update Password</button>
                </div>

                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Two-Factor Authentication</h3>
                    <p style="color: #94a3b8; margin-bottom: 20px;">Add an extra layer of security to your account</p>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="twoFactorAuth" style="width: 20px; height: 20px;">
                            <span>Enable Two-Factor Authentication</span>
                        </label>
                    </div>
                    <button class="btn-primary" style="margin-top: 20px;" onclick="saveSecuritySettings()">Save Security Settings</button>
                </div>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications-tab" class="tab-content">
                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">Email Notifications</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="emailLoanReminders" checked style="width: 20px; height: 20px;">
                            <span>Loan payment reminders</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="emailInvestmentReturns" checked style="width: 20px; height: 20px;">
                            <span>Investment returns</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="emailLoanOpportunities" checked style="width: 20px; height: 20px;">
                            <span>New loan opportunities</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="emailMarketing" style="width: 20px; height: 20px;">
                            <span>Marketing emails</span>
                        </label>
                    </div>
                </div>

                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Push Notifications</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="pushTransactionAlerts" checked style="width: 20px; height: 20px;">
                            <span>Transaction alerts</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="pushAccountActivity" checked style="width: 20px; height: 20px;">
                            <span>Account activity</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="pushPromotional" style="width: 20px; height: 20px;">
                            <span>Promotional offers</span>
                        </label>
                    </div>
                    <button class="btn-primary" style="margin-top: 20px;" onclick="saveNotificationSettings()">Save Notification Preferences</button>
                </div>
            </div>

            <!-- Display Preferences Tab -->
            <div id="display-tab" class="tab-content">
                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">Display Options</h3>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Language</label>
                            <select id="displayLanguage" style="width: 100%; max-width: 300px;">
                                <option value="en" selected>English</option>
                                <option>Shona</option>
                                <option>Ndebele</option>
                                <option>Swahili</option>
                                <option>Zulu</option>
                                <option>Afrikaans</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Currency Display</label>
                            <select id="displayCurrency" style="width: 100%; max-width: 300px;">
                                <option value="USD" selected>USD ($)</option>
                                <option>ZWL (Z$)</option>
                                <option>ZAR (R)</option>
                                <option>KES (KSh)</option>
                                <option>NGN ()</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Date Format</label>
                            <select id="displayDateFormat" style="width: 100%; max-width: 300px;">
                                <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                <option>MM/DD/YYYY</option>
                                <option>YYYY-MM-DD</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="displayAnimations" checked style="width: 20px; height: 20px;">
                                <span>Show dashboard animations</span>
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="displayCompactView" checked style="width: 20px; height: 20px;">
                                <span>Compact view mode</span>
                            </label>
                        </div>
                    </div>
                    <button class="btn-primary" style="margin-top: 20px;" onclick="saveDisplaySettings()">Save Display Settings</button>
                </div>
            </div>

            <!-- Investment Preferences Tab -->
            <div id="investment-tab" class="tab-content">
                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">Auto-Investment Settings</h3>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 15px;">
                                <input type="checkbox" style="width: 20px; height: 20px;">
                                <span style="font-weight: 600;">Enable Auto-Invest</span>
                            </label>
                            <p style="color: #94a3b8; font-size: 13px; margin-left: 30px;">Automatically invest in loans that match your criteria</p>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Investment Amount per Loan</label>
                            <input type="number" placeholder="$100" style="width: 100%; max-width: 300px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Maximum Total Investment</label>
                            <input type="number" placeholder="$5000" style="width: 100%; max-width: 300px;">
                        </div>
                    </div>
                </div>

                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Risk Preferences</h3>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Preferred Risk Level</label>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" checked style="width: 18px; height: 18px;">
                                    <span style="color: var(--color-green);">Low Risk</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" checked style="width: 18px; height: 18px;">
                                    <span style="color: #f59e0b;">Medium Risk</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" style="width: 18px; height: 18px;">
                                    <span style="color: #ef4444;">High Risk</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Loan Categories</label>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" checked style="width: 18px; height: 18px;">
                                    <span>Education Loans</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" checked style="width: 18px; height: 18px;">
                                    <span>Business Loans</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" checked style="width: 18px; height: 18px;">
                                    <span>Medical Loans</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" style="width: 18px; height: 18px;">
                                    <span>Home Improvement</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" style="width: 18px; height: 18px;">
                                    <span>Agricultural Loans</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Minimum Borrower Rating</label>
                            <select style="width: 100%; max-width: 300px;">
                                <option>Any Rating</option>
                                <option>3+ Stars</option>
                                <option selected>4+ Stars</option>
                                <option>4.5+ Stars</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-primary" style="margin-top: 20px;">Save Investment Preferences</button>
                </div>
            </div>

            <!-- Privacy Settings Tab -->
            <div id="privacy-tab" class="tab-content">
                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">Profile Privacy</h3>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 12px; color: #94a3b8; font-size: 14px; font-weight: 600;">Profile Visibility</label>
                            <select id="profileVisibility" style="width: 100%; max-width: 400px;">
                                <option value="public" selected>Public - Visible to all users</option>
                                <option>Private - Only visible to connected users</option>
                                <option>Hidden - Not visible to anyone</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="showPortfolio" checked style="width: 20px; height: 20px;">
                                <span>Show my investment portfolio publicly</span>
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="showLoanHistory" style="width: 20px; height: 20px;">
                                <span>Show my loan history publicly</span>
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="allowMessages" checked style="width: 20px; height: 20px;">
                                <span>Allow other users to send me messages</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Data & Privacy</h3>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="allowCookies" checked style="width: 20px; height: 20px;">
                                <span>Allow cookies for better experience</span>
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="shareData" style="width: 20px; height: 20px;">
                                <span>Share anonymized data for platform improvement</span>
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="thirdPartyAnalytics" style="width: 20px; height: 20px;">
                                <span>Allow third-party analytics</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Account Actions</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div>
                            <button class="btn-primary" style="display: inline-flex; align-items: center; gap: 8px;" onclick="downloadMyData()">
                                <i class="fas fa-download"></i>
                                <span>Download My Data</span>
                            </button>
                            <p style="color: #94a3b8; font-size: 13px; margin-top: 8px;">Get a copy of all your account data</p>
                        </div>
                        <div>
                            <button onclick="deactivateAccount()" style="cursor: pointer; display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: #f59e0b; color: white; border: none; border-radius: 8px; font-family: 'Space Grotesk', sans-serif; font-weight: 600; font-size: 14px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                                <i class="fas fa-user-slash"></i>
                                <span>Deactivate Account</span>
                            </button>
                            <p style="color: #94a3b8; font-size: 13px; margin-top: 8px;">Temporarily disable your account</p>
                        </div>
                        <div>
                            <button onclick="deleteAccount()" style="cursor: pointer; display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: #ef4444; color: white; border: none; border-radius: 8px; font-family: 'Space Grotesk', sans-serif; font-weight: 600; font-size: 14px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">
                                <i class="fas fa-trash-alt"></i>
                                <span>Delete Account</span>
                            </button>
                            <p style="color: #94a3b8; font-size: 13px; margin-top: 8px;">Permanently delete your account and all data</p>
                        </div>
                    </div>
                    <button class="btn-primary" style="margin-top: 20px;" onclick="savePrivacySettings()">Save Privacy Settings</button>
                </div>
            </div>

            <!-- Documents Tab -->
            <div id="documents-tab" class="tab-content">
                <div class="loan-card">
                    <h3 style="margin-bottom: 20px;">KYC Documents & Verification</h3>
                    <p style="color: #94a3b8; margin-bottom: 25px;">Upload your documents for identity verification. All documents are encrypted and stored securely.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <!-- National ID -->
                        <div class="document-upload-area" onmouseover="this.style.borderColor='#38e77b'" onmouseout="this.style.borderColor='#334155'">
                            <i class="fas fa-id-card" style="font-size: 48px; color: #38e77b; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">National ID</h4>
                            <p style="color: #64748b; font-size: 14px; margin-bottom: 15px;">Upload front and back of ID</p>
                            <span style="padding: 6px 16px; background: rgba(56, 231, 123, 0.1); color: #38e77b; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                <i class="fas fa-check-circle"></i> Verified
                            </span>
                            <input type="file" accept="image/*,application/pdf" style="display: none;" id="nationalId">
                            <button onclick="document.getElementById('nationalId').click()" class="btn-secondary" style="margin-top: 15px; width: 100%;"><i class="fas fa-cloud-arrow-up"></i> Update Document</button>
                        </div>

                        <!-- Payslip -->
                        <div class="document-upload-area" onmouseover="this.style.borderColor='#f97316'" onmouseout="this.style.borderColor='#334155'">
                            <i class="fas fa-file-invoice-dollar" style="font-size: 48px; color: #f97316; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Payslip / Proof of Income</h4>
                            <p style="color: #64748b; font-size: 14px; margin-bottom: 15px;">Recent payslip (last 3 months)</p>
                            <span style="padding: 6px 16px; background: rgba(249, 115, 22, 0.1); color: #f97316; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                <i class="fas fa-clock"></i> Pending Review
                            </span>
                            <input type="file" accept="image/*,application/pdf" style="display: none;" id="payslip">
                            <button onclick="document.getElementById('payslip').click()" class="btn-secondary" style="margin-top: 15px; width: 100%;"><i class="fas fa-cloud-arrow-up"></i> Upload Document</button>
                        </div>

                        <!-- Employment Contract -->
                        <div class="document-upload-area" onmouseover="this.style.borderColor='#3b82f6'" onmouseout="this.style.borderColor='#334155'">
                            <i class="fas fa-file-contract" style="font-size: 48px; color: #3b82f6; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Employment Contract</h4>
                            <p style="color: #64748b; font-size: 14px; margin-bottom: 15px;">Current employment contract</p>
                            <span style="padding: 6px 16px; background: rgba(239, 68, 68, 0.1); color: #ef4444; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                <i class="fas fa-times-circle"></i> Not Uploaded
                            </span>
                            <input type="file" accept="image/*,application/pdf" style="display: none;" id="contract">
                            <button onclick="document.getElementById('contract').click()" class="btn-secondary" style="margin-top: 15px; width: 100%;"><i class="fas fa-cloud-arrow-up"></i> Upload Document</button>
                        </div>

                        <!-- Bank Statement -->
                        <div class="document-upload-area" onmouseover="this.style.borderColor='#38e77b'" onmouseout="this.style.borderColor='#334155'">
                            <i class="fas fa-university" style="font-size: 48px; color: #38e77b; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Bank Statement</h4>
                            <p style="color: #64748b; font-size: 14px; margin-bottom: 15px;">Last 3 months bank statement</p>
                            <span style="padding: 6px 16px; background: rgba(56, 231, 123, 0.1); color: #38e77b; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                <i class="fas fa-check-circle"></i> Verified
                            </span>
                            <input type="file" accept="image/*,application/pdf" style="display: none;" id="bankStatement">
                            <button onclick="document.getElementById('bankStatement').click()" class="btn-secondary" style="margin-top: 15px; width: 100%;"><i class="fas fa-cloud-arrow-up"></i> Update Document</button>
                        </div>

                        <!-- Proof of Address -->
                        <div class="document-upload-area" onmouseover="this.style.borderColor='#38e77b'" onmouseout="this.style.borderColor='#334155'">
                            <i class="fas fa-home" style="font-size: 48px; color: #a855f7; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Proof of Address</h4>
                            <p style="color: #64748b; font-size: 14px; margin-bottom: 15px;">Utility bill or lease agreement</p>
                            <span style="padding: 6px 16px; background: rgba(56, 231, 123, 0.1); color: #38e77b; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                <i class="fas fa-check-circle"></i> Verified
                            </span>
                            <input type="file" accept="image/*,application/pdf" style="display: none;" id="proofAddress">
                            <button onclick="document.getElementById('proofAddress').click()" class="btn-secondary" style="margin-top: 15px; width: 100%;"><i class="fas fa-cloud-arrow-up"></i> Update Document</button>
                        </div>

                        <!-- Additional Documents -->
                        <div class="document-upload-area" onmouseover="this.style.borderColor='#64748b'" onmouseout="this.style.borderColor='#334155'">
                            <i class="fas fa-folder-plus" style="font-size: 48px; color: #64748b; margin-bottom: 15px;"></i>
                            <h4 style="margin-bottom: 10px;">Additional Documents</h4>
                            <p style="color: #64748b; font-size: 14px; margin-bottom: 15px;">Any supporting documents</p>
                            <span style="padding: 6px 16px; background: rgba(100, 116, 139, 0.1); color: #64748b; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                <i class="fas fa-info-circle"></i> Optional
                            </span>
                            <input type="file" accept="image/*,application/pdf" multiple style="display: none;" id="additionalDocs">
                            <button onclick="document.getElementById('additionalDocs').click()" class="btn-secondary" style="margin-top: 15px; width: 100%;"><i class="fas fa-cloud-arrow-up"></i> Upload Documents</button>
                        </div>
                    </div>
                </div>

                <div class="loan-card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Document History</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 1px solid #334155;">
                                    <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Document Type</th>
                                    <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Upload Date</th>
                                    <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Status</th>
                                    <th style="padding: 12px; text-align: left; color: #94a3b8; font-size: 13px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="border-bottom: 1px solid #334155;">
                                    <td style="padding: 16px;"><i class="fas fa-id-card" style="margin-right: 8px; color: #38e77b;"></i> National ID</td>
                                    <td style="padding: 16px;">2024-11-01</td>
                                    <td style="padding: 16px;"><span style="padding: 4px 12px; background: rgba(56, 231, 123, 0.1); color: #38e77b; border-radius: 12px; font-size: 12px;">Verified</span></td>
                                    <td style="padding: 16px;">
                                        <button class="btn-secondary btn-sm" style="margin-right: 8px;"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn-secondary btn-sm"><i class="fas fa-arrow-down-to-line"></i> Download</button>
                                    </td>
                                </tr>
                                <tr style="border-bottom: 1px solid #334155;">
                                    <td style="padding: 16px;"><i class="fas fa-file-invoice-dollar" style="margin-right: 8px; color: #f97316;"></i> Payslip</td>
                                    <td style="padding: 16px;">2024-11-08</td>
                                    <td style="padding: 16px;"><span style="padding: 4px 12px; background: rgba(249, 115, 22, 0.1); color: #f97316; border-radius: 12px; font-size: 12px;">Pending</span></td>
                                    <td style="padding: 16px;">
                                        <button class="btn-secondary btn-sm" style="margin-right: 8px;"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn-secondary btn-sm"><i class="fas fa-arrow-down-to-line"></i> Download</button>
                                    </td>
                                </tr>
                                <tr style="border-bottom: 1px solid #334155;">
                                    <td style="padding: 16px;"><i class="fas fa-university" style="margin-right: 8px; color: #38e77b;"></i> Bank Statement</td>
                                    <td style="padding: 16px;">2024-10-28</td>
                                    <td style="padding: 16px;"><span style="padding: 4px 12px; background: rgba(56, 231, 123, 0.1); color: #38e77b; border-radius: 12px; font-size: 12px;">Verified</span></td>
                                    <td style="padding: 16px;">
                                        <button class="btn-secondary btn-sm" style="margin-right: 8px;"><i class="fas fa-eye"></i> View</button>
                                        <button class="btn-secondary btn-sm"><i class="fas fa-arrow-down-to-line"></i> Download</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination for Document History -->
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; margin-top: 20px; padding: 15px 0;" data-pagination="documents">
                        <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('documents', 'prev')" data-prev-btn>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <div style="display: flex; align-items: center; gap: 8px;" data-page-buttons>
                            <button onclick="goToPage('documents', 1)" class="page-number-btn active" data-page-btn="1">1</button>
                            <button onclick="goToPage('documents', 2)" class="page-number-btn" data-page-btn="2">2</button>
                            <span style="color: #94a3b8; font-size: 13px; margin-left: 10px;">Page <span style="font-weight: 600; color: #38e77b;" data-page-number>1</span> of 2 (8 documents)</span>
                        </div>
                        <button class="btn-primary" style="display: flex; align-items: center; gap: 8px;" onclick="changePage('documents', 'next')" data-next-btn>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Kairo AI Chat Widget -->
        <div class="chat-widget">
            <button class="chat-toggle" id="chatToggle">
                <i class="fas fa-comments"></i>
            </button>
            <div class="chat-window" id="chatWindow">
                <div class="chat-header">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; overflow: hidden; border: 2px solid #38e77b;">
                            <img src="assets/images/3d-cartoon-character.jpg" alt="Kairo AI" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div>
                            <h3 style="margin: 0; font-size: 16px;">Kairo AI</h3>
                            <p style="margin: 0; font-size: 12px; color: #94a3b8;">Your Financial Assistant</p>
                        </div>
                    </div>
                    <button class="chat-close" id="chatClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="chat-body">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message-bubble">
                            <p>Hello! I'm Kairo, your AI financial assistant. I can help you with:</p>
                            <ul style="text-align: left; margin: 15px 0; padding-left: 20px;">
                                <li style="margin: 5px 0;"> Personal profile information</li>
                                <li style="margin: 5px 0;"> Next of kin details</li>
                                <li style="margin: 5px 0;"> Identity documents upload</li>
                                <li style="margin: 5px 0;"> Employment details verification</li>
                                <li style="margin: 5px 0;"> Payment method setup</li>
                            </ul>
                            <p style="margin-top: 10px;">How can I assist you today?</p>
                        </div>
                    </div>
                </div>
                <div class="quick-replies">
                    <button class="quick-reply-btn" onclick="sendQuickReply('What is my ZimScore?')">My ZimScore</button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('Show my next payment')">Next Payment</button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('Investment opportunities')">Investments</button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('How do I apply for a loan?')">Apply for Loan</button>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type your message...">
                    <button class="chat-send-btn" id="chatSend">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // API CONFIGURATION & UTILITY
        // ============================================
        const API_BASE_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : 'https://zimcrowd-backend-dz18dm4h9-jojola.vercel.app';

        // ZimCrowd API Utility
        window.ZimCrowdAPI = {
            token: null,
            
            setToken(token) {
                this.token = token;
            },
            
            async request(endpoint, options = {}) {
                const headers = {
                    'Content-Type': 'application/json',
                    ...options.headers
                };
                
                if (this.token) {
                    headers['Authorization'] = `Bearer ${this.token}`;
                }
                
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...options,
                    headers
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'API request failed');
                }
                
                return data;
            },
            
            // Profile APIs
            async getProfile() {
                return this.request('/api/profile');
            },
            
            // Dashboard APIs
            async getDashboardOverview() {
                return this.request('/api/dashboard/overview');
            },
            
            // Wallet APIs
            async getWalletBalance() {
                return this.request('/api/wallet/balance');
            },
            
            async getWalletTransactions(page = 1, limit = 10) {
                return this.request(`/api/wallet/transactions?page=${page}&limit=${limit}`);
            },
            
            // Loans APIs
            async getLoans(page = 1, limit = 10) {
                return this.request(`/api/loans?page=${page}&limit=${limit}`);
            },
            
            async getMyLoans(page = 1, limit = 10, status = null) {
                const statusParam = status ? `&status=${status}` : '';
                return this.request(`/api/loans/my-loans?page=${page}&limit=${limit}${statusParam}`);
            },
            
            async getLoanStats() {
                return this.request('/api/loans/stats');
            },
            
            async getLoanDetails(loanId) {
                return this.request(`/api/loans/${loanId}`);
            },
            
            // Investments APIs
            async getInvestments(page = 1, limit = 10) {
                return this.request(`/api/investments/my-investments?page=${page}&limit=${limit}`);
            },
            
            async getInvestmentPortfolio() {
                return this.request('/api/investments/portfolio');
            },
            
            async getInvestmentStats() {
                return this.request('/api/investments/performance');
            },
            
            // Transactions APIs
            async getTransactions(page = 1, limit = 10) {
                return this.request(`/api/transactions?page=${page}&limit=${limit}`);
            },
            
            // Wallet APIs
            async getWalletStats() {
                return this.request('/api/wallet/stats');
            },
            
            async getWalletTransactions(page = 1, limit = 20) {
                return this.request(`/api/wallet/transactions?page=${page}&limit=${limit}`);
            },
            
            async depositFunds(amount, paymentMethod, reference = '') {
                return this.request('/api/wallet/deposit', {
                    method: 'POST',
                    body: JSON.stringify({ amount, payment_method: paymentMethod, reference })
                });
            },
            
            async withdrawFunds(amount, paymentMethod, accountDetails) {
                return this.request('/api/wallet/withdraw', {
                    method: 'POST',
                    body: JSON.stringify({ amount, payment_method: paymentMethod, account_details: accountDetails })
                });
            },
            
            async transferFunds(recipientId, amount, description = '') {
                return this.request('/api/wallet/transfer', {
                    method: 'POST',
                    body: JSON.stringify({ recipient_id: recipientId, amount, description })
                });
            },
            
            async getPaymentMethods() {
                return this.request('/api/wallet/payment-methods');
            },
            
            // ZimScore API
            async getZimScore() {
                return this.request('/api/zimscore');
            },
            
            // Primary Market API
            async getPrimaryMarketLoans(page = 1, limit = 6) {
                return this.request(`/api/p2p-primary-market/available-loans?page=${page}&limit=${limit}`);
            },
            
            async getPrimaryMarketStats() {
                return this.request('/api/primary-market');
            },
            
            // Secondary Market API
            async getSecondaryMarketLoans(page = 1, limit = 6) {
                return this.request(`/api/p2p-secondary-market/listings?page=${page}&limit=${limit}`);
            },
            
            async getSecondaryMarketStats() {
                return this.request('/api/secondary-market');
            },
            
            // Notifications API
            async getNotifications() {
                return this.request('/api/notifications');
            },
            
            async markNotificationRead(notificationId) {
                return this.request(`/api/notifications/${notificationId}/read`, {
                    method: 'PUT'
                });
            },
            
            // Referrals API
            async getReferralStats() {
                return this.request('/api/referrals/stats');
            },
            
            async getReferralCode() {
                return this.request('/api/referrals/code');
            },
            
            async getReferrals(page = 1, limit = 10) {
                return this.request(`/api/referrals/my-referrals?page=${page}&limit=${limit}`);
            },
            
            // Settings APIs
            async updateProfile(data) {
                return this.request('/api/profile/update', {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });
            },
            
            async changePassword(oldPassword, newPassword) {
                return this.request('/api/profile/change-password', {
                    method: 'POST',
                    body: JSON.stringify({ oldPassword, newPassword })
                });
            },
            
            async updateNotificationSettings(settings) {
                return this.request('/api/profile/notification-settings', {
                    method: 'PUT',
                    body: JSON.stringify(settings)
                });
            },
            
            // Logout
            async logout() {
                return this.request('/api/auth/logout', {
                    method: 'POST'
                });
            }
        };

        // Mobile Menu Toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');

        function toggleMobileMenu() {
            sidebar.classList.toggle('active');
            mobileOverlay.classList.toggle('active');
            
            // Change icon
            const icon = mobileMenuToggle.querySelector('i');
            if (sidebar.classList.contains('active')) {
                icon.className = 'fas fa-times';
            } else {
                icon.className = 'fas fa-bars';
            }
        }

        // Toggle menu on button click
        mobileMenuToggle.addEventListener('click', toggleMobileMenu);

        // Close menu when overlay is clicked
        mobileOverlay.addEventListener('click', toggleMobileMenu);

        // Close menu when a nav link is clicked (on mobile)
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    toggleMobileMenu();
                }
            });
        });

        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Hide all sections
                document.querySelectorAll('.dashboard-section').forEach(s => s.classList.remove('active'));
                
                // Show selected section
                const section = this.getAttribute('data-section');
                document.getElementById(section + '-section').classList.add('active');
                
                // Update page title in header
                const title = this.querySelector('span').textContent;
                const pageTitle = document.getElementById('page-title');
                if (section === 'overview') {
                    pageTitle.textContent = 'Dashboard Overview';
                } else {
                    pageTitle.textContent = title;
                }

                // Load section-specific data
                if (section === 'loans') {
                    loadLoansData();
                } else if (section === 'wallet') {
                    loadWalletData();
                } else if (section === 'investments') {
                    loadInvestmentsData();
                } else if (section === 'transactions') {
                    loadTransactionsData();
                } else if (section === 'referrals') {
                    loadReferralsData();
                } else if (section === 'settings') {
                    loadSettingsData();
                }
            });
        });

        // Tab switching for loans
        function switchTab(tabName) {
            document.querySelectorAll('#loans-section .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#loans-section .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Tab switching for settings
        function switchSettingsTab(tabName) {
            document.querySelectorAll('#settings-section .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#settings-section .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Tab switching for investments
        function switchInvestmentTab(tabName) {
            document.querySelectorAll('#investments-section .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#investments-section .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Show direct loan information
        function showDirectLoanInfo() {
            alert(` ZimCrowd Direct - Instant Funding

 GUARANTEED APPROVAL
 Get approved instantly based on your ZimScore
 No waiting for lenders
 Funds directly from ZimCrowd Capital

 INSTANT DISBURSEMENT
 Funds in your wallet within minutes
 No delays or waiting periods
 Available 24/7

 TRANSPARENT PRICING
 Fixed fees (5-12% based on ZimScore)
 No hidden charges
 Clear APR disclosure

 FLEXIBLE TERMS
 7, 14, or 30-day repayment options
 Early repayment available
 Build your ZimScore with on-time payments

How it works:
1. Click "Get Instant Loan"
2. Review your personalized offer
3. Sign agreement electronically
4. Receive funds instantly!`);
        }

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const icon = document.getElementById('theme-icon');
            const text = document.getElementById('theme-text');
            
            if (document.body.classList.contains('light-mode')) {
                icon.className = 'fas fa-sun';
                text.textContent = 'Light Mode';
                localStorage.setItem('theme', 'light');
            } else {
                icon.className = 'fas fa-moon';
                text.textContent = 'Dark Mode';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme - Default to DARK mode
        window.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            console.log('Saved theme:', savedTheme);
            
            // Default to dark mode
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('theme-icon').className = 'fas fa-sun';
                document.getElementById('theme-text').textContent = 'Light Mode';
                console.log('Applied light mode');
            } else {
                // Ensure dark mode is active (remove light-mode if present)
                document.body.classList.remove('light-mode');
                document.getElementById('theme-icon').className = 'fas fa-moon';
                document.getElementById('theme-text').textContent = 'Dark Mode';
                localStorage.setItem('theme', 'dark');
                console.log('Applied dark mode (default)');
            }
        });

        // AI Chat Widget (Kairo AI) Functionality
        const chatToggle = document.getElementById('chatToggle');
        const chatWindow = document.getElementById('chatWindow');
        const chatClose = document.getElementById('chatClose');
        const chatInput = document.getElementById('chatInput');
        const chatSend = document.getElementById('chatSend');
        const chatMessages = document.getElementById('chatMessages');

        // Toggle chat window
        chatToggle.addEventListener('click', function() {
            chatWindow.classList.toggle('active');
        });

        chatClose.addEventListener('click', function() {
            chatWindow.classList.remove('active');
        });

        // AI Response Generator
        function getAIResponse(message) {
            const responses = {
                'zimscore': {
                    keywords: ['zimscore', 'credit score', 'score', 'tier'],
                    response: "Your current ZimScore is 785 (Tier A). You've improved 45 points this month through consistent payments. Your credit limit is $2,500. Keep up the great work! "
                },
                'payment': {
                    keywords: ['payment', 'due', 'next payment', 'pay'],
                    response: "Your next payment of $187.50 for Loan #1234 is due on December 15, 2025. You have sufficient funds in your wallet. Would you like me to set up an auto-payment reminder?"
                },
                'investment': {
                    keywords: ['invest', 'investment', 'opportunity', 'opportunities'],
                    response: "Based on your risk preference, I recommend: 1) Education loan (Low risk, 10.2% yield), 2) Small business loan (Medium risk, 12.8% yield). Your current portfolio is 70% low-risk investments. Would you like to see more details?"
                },
                'loan': {
                    keywords: ['loan', 'apply', 'borrow', 'request'],
                    response: "To apply for a loan: 1) Go to Market tab, 2) Tap 'Request Loan', 3) Fill in amount and purpose, 4) Submit for community funding. With your Tier A score, you qualify for rates as low as 8% APR. "
                },
                'balance': {
                    keywords: ['balance', 'wallet', 'funds', 'money'],
                    response: "Your current balance is $15,450 (Available) + $1,250 (CrowdCredits). You have $2,500 in pending investments and 3 active loans. Everything looks healthy! "
                },
                'market': {
                    keywords: ['market', 'opportunities today', 'good investment'],
                    response: "Today features: 3 new education loans (8-12% yields), 2 medical loans (10-14% yields), and 1 ZimCredit instant loan. Market activity is high with 85% of loans funded within 24 hours. "
                },
                'help': {
                    keywords: ['help', 'support', 'assistance', 'how'],
                    response: "I'm here to help! I can assist with:  Checking your ZimScore,  Viewing payment schedules,  Investment recommendations,  Loan applications,  Market insights. Just ask me anything!"
                }
            };

            const lowerMessage = message.toLowerCase();
            
            for (const [key, data] of Object.entries(responses)) {
                if (data.keywords.some(keyword => lowerMessage.includes(keyword))) {
                    return data.response;
                }
            }

            return "I'm not sure I understand that. Could you rephrase? I can help with ZimScore, payments, investments, loans, balance, and market insights. What would you like to know? ";
        }

        // Load user profile data from social auth and localStorage
        function loadUserProfile() {
            // Get social auth data from localStorage (set during auth callback)
            const socialAuthData = JSON.parse(localStorage.getItem('socialAuthData') || '{}');

            // Populate profile fields with social data
            if (socialAuthData.first_name) {
                document.getElementById('profileFirstName').value = socialAuthData.first_name;
            }
            if (socialAuthData.last_name) {
                document.getElementById('profileLastName').value = socialAuthData.last_name;
            }
            if (socialAuthData.email) {
                document.getElementById('profileEmail').value = socialAuthData.email;
            }
            if (socialAuthData.phone) {
                document.getElementById('profilePhone').value = socialAuthData.phone;
            }
            if (socialAuthData.avatar_url) {
                updateProfileAvatarFromUrl(socialAuthData.avatar_url);
            }

            // Load saved profile data from localStorage
            const savedProfile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            if (savedProfile.dob) document.getElementById('profileDob').value = savedProfile.dob;
            if (savedProfile.gender) document.getElementById('profileGender').value = savedProfile.gender;
            if (savedProfile.address) document.getElementById('profileAddress').value = savedProfile.address;
            if (savedProfile.bio) document.getElementById('profileBio').value = savedProfile.bio;

            // Update social login status
            updateSocialLoginStatus();
        }

        function updateSocialLoginStatus() {
            const socialAuthData = JSON.parse(localStorage.getItem('socialAuthData') || '{}');

            if (socialAuthData.provider === 'google') {
                document.getElementById('googleStatus').textContent = `Connected as ${socialAuthData.email || 'user'}`;
                document.getElementById('googleStatus').style.color = '#38e77b';
            } else {
                document.getElementById('googleStatus').textContent = 'Not connected';
            }

            if (socialAuthData.provider === 'facebook') {
                document.getElementById('facebookStatus').textContent = `Connected as ${socialAuthData.email || 'user'}`;
                document.getElementById('facebookStatus').style.color = '#3b82f6';
            } else {
                document.getElementById('facebookStatus').textContent = 'Not connected';
            }
        }

        function updateProfileAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const avatarDiv = document.getElementById('profileAvatar');
                    avatarDiv.style.backgroundImage = `url(${e.target.result})`;
                    avatarDiv.style.backgroundSize = 'cover';
                    avatarDiv.style.backgroundPosition = 'center';
                    avatarDiv.innerHTML = ''; // Remove the icon

                    // Show remove button
                    document.getElementById('remove-icon-btn').style.display = 'flex';

                    // Save to localStorage
                    localStorage.setItem('userAvatar', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function updateProfileAvatarFromUrl(url) {
            const avatarDiv = document.getElementById('profileAvatar');
            avatarDiv.style.backgroundImage = `url(${url})`;
            avatarDiv.style.backgroundSize = 'cover';
            avatarDiv.style.backgroundPosition = 'center';
            avatarDiv.innerHTML = ''; // Remove the icon
            document.getElementById('remove-icon-btn').style.display = 'flex';
        }

        function removeProfilePicture() {
            const avatarDiv = document.getElementById('profileAvatar');
            avatarDiv.style.backgroundImage = '';
            avatarDiv.innerHTML = '<span id="profile-initials">TM</span>';

            // Hide remove button
            document.getElementById('remove-icon-btn').style.display = 'none';

            // Clear from localStorage
            localStorage.removeItem('userAvatar');
            document.getElementById('profile-upload').value = '';
        }

        function saveProfile() {
            const profileData = {
                firstName: document.getElementById('profileFirstName').value,
                lastName: document.getElementById('profileLastName').value,
                email: document.getElementById('profileEmail').value,
                phone: document.getElementById('profilePhone').value,
                dob: document.getElementById('profileDob').value,
                gender: document.getElementById('profileGender').value,
                address: document.getElementById('profileAddress').value,
                bio: document.getElementById('profileBio').value,
                updatedAt: new Date().toISOString()
            };

            // Save to localStorage
            localStorage.setItem('userProfile', JSON.stringify(profileData));

            // Show success message
            showSuccess('Profile updated successfully!');

            // Update initials if no avatar
            const avatarDiv = document.getElementById('profileAvatar');
            if (!avatarDiv.style.backgroundImage) {
                const initials = (profileData.firstName.charAt(0) + profileData.lastName.charAt(0)).toUpperCase();
                document.getElementById('profile-initials').textContent = initials;
            }
        }

        function resetProfile() {
            // Reload profile data
            loadUserProfile();
            showSuccess('Profile reset to saved data');
        }

        function showSuccess(message) {
            // Create and show success notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(56, 231, 123, 0.9);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add message to chat
        function addMessage(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isUser ? 'user' : 'ai'}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = `<i class="fas fa-${isUser ? 'user' : 'robot'}"></i>`;
            
            const bubble = document.createElement('div');
            const bubbleContent = document.createElement('div');
            bubbleContent.className = 'message-bubble';
            bubbleContent.innerHTML = `<p>${text}</p>`;
            
            bubble.appendChild(bubbleContent);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Show typing indicator
        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message ai';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <div class="message-bubble">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        // Send message
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, true);
            chatInput.value = '';
            
            // Show typing indicator
            showTyping();
            
            // Simulate AI response delay
            setTimeout(() => {
                removeTyping();
                const response = getAIResponse(message);
                addMessage(response, false);
            }, 1500);
        }

        // Quick reply function
        function sendQuickReply(message) {
            addMessage(message, true);
            showTyping();
            
            setTimeout(() => {
                removeTyping();
                const response = getAIResponse(message);
                addMessage(response, false);
            }, 1500);
        }

        // Event listeners
        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Copy Referral Code
        function copyReferralCode() {
            const codeElement = document.querySelector('#referrals-section .loan-card span[style*="font-size: 24px"]');
            const code = codeElement?.getAttribute('data-code') || codeElement?.textContent || 'LOADING...';
            
            navigator.clipboard.writeText(code).then(() => {
                // Show success message
                alert('Referral code copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy referral code');
            });
        }

        // Logout functionality
        async function handleLogout() {
            if (!confirm('Are you sure you want to logout?')) {
                return;
            }

            try {
                // Call logout API
                await window.ZimCrowdAPI.logout();
                
                // Clear local storage
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                
                // Redirect to login
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Logout error:', error);
                
                // Even if API fails, clear local data and redirect
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        }

        // Attach logout to button
        document.addEventListener('DOMContentLoaded', function() {
            const logoutBtn = document.querySelector('.logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleLogout();
                });
            }
        });

        // ============================================
        // WALLET FUNCTIONS
        // ============================================

        // Show Deposit Modal
        function showDepositModal() {
            const modal = document.createElement('div');
            modal.id = 'depositModal';
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                    <div style="background: #1e293b; border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2 style="margin: 0;"> Add Funds</h2>
                            <button onclick="closeWalletModal('depositModal')" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
                        </div>
                        
                        <form id="depositForm" onsubmit="handleDeposit(event)">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Amount (USD)</label>
                                <input type="number" id="depositAmount" min="10" max="10000" step="0.01" required
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                    placeholder="Enter amount">
                                <small style="color: #94a3b8; display: block; margin-top: 5px;">Min: $10, Max: $10,000</small>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Payment Method</label>
                                <select id="depositMethod" required
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;">
                                    <option value="">Select payment method</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="credit_card">Credit Card (2.9% fee)</option>
                                    <option value="debit_card">Debit Card (1.5% fee)</option>
                                    <option value="mobile_money">Mobile Money - EcoCash ($2 fee)</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 30px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Reference (Optional)</label>
                                <input type="text" id="depositReference" maxlength="100"
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                    placeholder="Transaction reference">
                            </div>
                            
                            <button type="submit" class="btn-primary" style="width: 100%; padding: 15px; font-size: 16px;">
                                <span id="depositBtnText">Deposit Funds</span>
                                <span id="depositBtnSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Show Withdraw Modal
        function showWithdrawModal() {
            const modal = document.createElement('div');
            modal.id = 'withdrawModal';
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                    <div style="background: #1e293b; border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2 style="margin: 0;"> Withdraw Funds</h2>
                            <button onclick="closeWalletModal('withdrawModal')" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
                        </div>
                        
                        <form id="withdrawForm" onsubmit="handleWithdraw(event)">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Amount (USD)</label>
                                <input type="number" id="withdrawAmount" min="20" max="5000" step="0.01" required
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                    placeholder="Enter amount">
                                <small style="color: #94a3b8; display: block; margin-top: 5px;">Min: $20, Max: $5,000</small>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Withdrawal Method</label>
                                <select id="withdrawMethod" required onchange="toggleWithdrawFields()"
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;">
                                    <option value="">Select withdrawal method</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="mobile_money">Mobile Money - EcoCash</option>
                                </select>
                            </div>
                            
                            <div id="bankFields" style="display: none;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Bank Name</label>
                                    <input type="text" id="bankName"
                                        style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                        placeholder="Enter bank name">
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Account Number</label>
                                    <input type="text" id="accountNumber"
                                        style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                        placeholder="Enter account number">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Account Holder Name</label>
                                    <input type="text" id="accountHolder"
                                        style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                        placeholder="Enter account holder name">
                                </div>
                            </div>
                            
                            <div id="mobileFields" style="display: none;">
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Mobile Number</label>
                                    <input type="tel" id="mobileNumber"
                                        style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                        placeholder="+263 XXX XXX XXX">
                                </div>
                            </div>
                            
                            <button type="submit" class="btn-primary" style="width: 100%; padding: 15px; font-size: 16px;">
                                <span id="withdrawBtnText">Withdraw Funds</span>
                                <span id="withdrawBtnSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Show Transfer Modal
        function showTransferModal() {
            const modal = document.createElement('div');
            modal.id = 'transferModal';
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                    <div style="background: #1e293b; border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2 style="margin: 0;"> Transfer Funds</h2>
                            <button onclick="closeWalletModal('transferModal')" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
                        </div>
                        
                        <form id="transferForm" onsubmit="handleTransfer(event)">
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Recipient User ID</label>
                                <input type="text" id="recipientId" required
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                    placeholder="Enter recipient user ID">
                                <small style="color: #94a3b8; display: block; margin-top: 5px;">Ask the recipient for their User ID</small>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Amount (USD)</label>
                                <input type="number" id="transferAmount" min="5" max="5000" step="0.01" required
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px;"
                                    placeholder="Enter amount">
                                <small style="color: #94a3b8; display: block; margin-top: 5px;">Min: $5, Max: $5,000</small>
                            </div>
                            
                            <div style="margin-bottom: 30px;">
                                <label style="display: block; margin-bottom: 8px; color: #94a3b8;">Description (Optional)</label>
                                <textarea id="transferDescription" maxlength="200" rows="3"
                                    style="width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 12px; color: white; font-size: 16px; resize: vertical;"
                                    placeholder="What's this transfer for?"></textarea>
                            </div>
                            
                            <button type="submit" class="btn-primary" style="width: 100%; padding: 15px; font-size: 16px;">
                                <span id="transferBtnText">Transfer Funds</span>
                                <span id="transferBtnSpinner" style="display: none;"><i class="fas fa-spinner fa-spin"></i></span>
                            </button>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Toggle withdraw fields based on method
        function toggleWithdrawFields() {
            const method = document.getElementById('withdrawMethod').value;
            const bankFields = document.getElementById('bankFields');
            const mobileFields = document.getElementById('mobileFields');
            
            if (method === 'bank_transfer') {
                bankFields.style.display = 'block';
                mobileFields.style.display = 'none';
                document.getElementById('bankName').required = true;
                document.getElementById('accountNumber').required = true;
                document.getElementById('accountHolder').required = true;
                document.getElementById('mobileNumber').required = false;
            } else if (method === 'mobile_money') {
                bankFields.style.display = 'none';
                mobileFields.style.display = 'block';
                document.getElementById('bankName').required = false;
                document.getElementById('accountNumber').required = false;
                document.getElementById('accountHolder').required = false;
                document.getElementById('mobileNumber').required = true;
            } else {
                bankFields.style.display = 'none';
                mobileFields.style.display = 'none';
            }
        }

        // Close Modal
        function closeWalletModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.remove();
            }
        }

        // Handle Deposit
        async function handleDeposit(event) {
            event.preventDefault();
            
            const amount = document.getElementById('depositAmount').value;
            const method = document.getElementById('depositMethod').value;
            const reference = document.getElementById('depositReference').value;
            
            const btnText = document.getElementById('depositBtnText');
            const btnSpinner = document.getElementById('depositBtnSpinner');
            
            btnText.style.display = 'none';
            btnSpinner.style.display = 'inline';
            
            try {
                const response = await window.ZimCrowdAPI.depositFunds(parseFloat(amount), method, reference);
                
                if (response.success) {
                    alert(` Deposit request submitted successfully!\n\nAmount: $${amount}\nMethod: ${method}\nStatus: ${response.data.status}\nEstimated completion: ${response.data.estimated_completion}`);
                    closeWalletModal('depositModal');
                    // Reload wallet data
                    loadDashboardOverview();
                    loadWalletTransactions();
                } else {
                    alert(' Deposit failed: ' + response.message);
                }
            } catch (error) {
                console.error('Deposit error:', error);
                alert(' Failed to process deposit. Please try again.');
            } finally {
                btnText.style.display = 'inline';
                btnSpinner.style.display = 'none';
            }
        }

        // Handle Withdraw
        async function handleWithdraw(event) {
            event.preventDefault();
            
            const amount = document.getElementById('withdrawAmount').value;
            const method = document.getElementById('withdrawMethod').value;
            
            let accountDetails = {};
            if (method === 'bank_transfer') {
                accountDetails = {
                    bank_name: document.getElementById('bankName').value,
                    account_number: document.getElementById('accountNumber').value,
                    account_holder: document.getElementById('accountHolder').value
                };
            } else if (method === 'mobile_money') {
                accountDetails = {
                    phone_number: document.getElementById('mobileNumber').value
                };
            }
            
            const btnText = document.getElementById('withdrawBtnText');
            const btnSpinner = document.getElementById('withdrawBtnSpinner');
            
            btnText.style.display = 'none';
            btnSpinner.style.display = 'inline';
            
            try {
                const response = await window.ZimCrowdAPI.withdrawFunds(parseFloat(amount), method, accountDetails);
                
                if (response.success) {
                    alert(` Withdrawal request submitted successfully!\n\nAmount: $${amount}\nMethod: ${method}\nStatus: ${response.data.status}\nEstimated completion: ${response.data.estimated_completion}\nFees: $${response.data.fees}`);
                    closeWalletModal('withdrawModal');
                    // Reload wallet data
                    loadDashboardOverview();
                    loadWalletTransactions();
                } else {
                    alert(' Withdrawal failed: ' + response.message);
                }
            } catch (error) {
                console.error('Withdrawal error:', error);
                alert(' Failed to process withdrawal. Please try again.');
            } finally {
                btnText.style.display = 'inline';
                btnSpinner.style.display = 'none';
            }
        }

        // Handle Transfer
        async function handleTransfer(event) {
            event.preventDefault();
            
            const recipientId = document.getElementById('recipientId').value;
            const amount = document.getElementById('transferAmount').value;
            const description = document.getElementById('transferDescription').value;
            
            const btnText = document.getElementById('transferBtnText');
            const btnSpinner = document.getElementById('transferBtnSpinner');
            
            btnText.style.display = 'none';
            btnSpinner.style.display = 'inline';
            
            try {
                const response = await window.ZimCrowdAPI.transferFunds(recipientId, parseFloat(amount), description);
                
                if (response.success) {
                    alert(` Transfer completed successfully!\n\nRecipient: ${response.data.recipient.name}\nAmount: $${amount}\n${description ? 'Description: ' + description : ''}`);
                    closeWalletModal('transferModal');
                    // Reload wallet data
                    loadDashboardOverview();
                    loadWalletTransactions();
                } else {
                    alert(' Transfer failed: ' + response.message);
                }
            } catch (error) {
                console.error('Transfer error:', error);
                alert(' Failed to process transfer. Please try again.');
            } finally {
                btnText.style.display = 'inline';
                btnSpinner.style.display = 'none';
            }
        }

        // Load Wallet Transactions
        async function loadWalletTransactions() {
            try {
                const response = await window.ZimCrowdAPI.getWalletTransactions(1, 20);
                
                if (response.success) {
                    updateWalletTransactionsUI(response.data.transactions);
                }
            } catch (error) {
                console.error('Failed to load wallet transactions:', error);
            }
        }

        // Update Wallet Transactions UI
        function updateWalletTransactionsUI(transactions) {
            const container = document.querySelector('#wallet-section .transaction-list');
            if (!container) return;
            
            if (!transactions || transactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 40px;">No transactions yet</p>';
                return;
            }
            
            container.innerHTML = transactions.map(tx => {
                const isCredit = tx.type === 'deposit';
                const icon = isCredit ? 'arrow-down' : 'arrow-up';
                const color = isCredit ? '#38e77b' : '#ef4444';
                
                return `
                    <div class="loan-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 50px; height: 50px; background: rgba(${isCredit ? '56, 231, 123' : '239, 68, 68'}, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-${icon}" style="color: ${color};"></i>
                                </div>
                                <div>
                                    <h4 style="margin-bottom: 5px;">${tx.description || tx.type}</h4>
                                    <p style="color: #94a3b8; font-size: 14px;">${new Date(tx.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 20px; font-weight: 700; color: ${color};">${isCredit ? '+' : '-'}$${parseFloat(tx.amount).toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // END WALLET FUNCTIONS
        // ============================================

        // ============================================
        // MARKET DISPLAY FUNCTIONS
        // ============================================

        // Update Primary Market UI
        function updatePrimaryMarketUI(loans) {
            const container = document.getElementById('primaryMarketLoans');
            if (!container) return;
            
            if (!loans || loans.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 40px; grid-column: 1 / -1;">No investment opportunities available at the moment</p>';
                return;
            }
            
            container.innerHTML = loans.map(loan => {
                const riskColor = loan.risk_rating === 'low' ? '#38e77b' : loan.risk_rating === 'medium' ? '#f59e0b' : '#ef4444';
                const riskLabel = loan.risk_rating ? loan.risk_rating.toUpperCase() : 'MEDIUM';
                
                return `
                    <div class="portfolio-card" style="cursor: pointer;" onclick="window.location.href='primary-market.html'">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">${loan.borrower_name ? loan.borrower_name[0].toUpperCase() : 'B'}</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">${loan.borrower_name || 'Borrower'}</div>
                                    <div class="borrower-purpose">${loan.purpose || 'Personal Loan'}</div>
                                    <span class="risk-badge ${loan.risk_rating || 'medium'}" style="background: rgba(${riskColor === '#38e77b' ? '56, 231, 123' : riskColor === '#f59e0b' ? '245, 158, 11' : '239, 68, 68'}, 0.1); color: ${riskColor};">
                                        ${riskLabel} RISK
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Loan Amount</span>
                                    <span class="metric-value">$${parseFloat(loan.amount || 0).toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Interest Rate</span>
                                    <span class="metric-value returns-positive">${parseFloat(loan.interest_rate || 0).toFixed(1)}% APR</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Term</span>
                                    <span class="metric-value">${loan.term || 12} months</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Funded</span>
                                    <span>${loan.funded_percentage || 0}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${loan.funded_percentage || 0}%; background: ${riskColor};"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-primary" style="width: 100%; padding: 10px;" onclick="event.stopPropagation(); window.location.href='primary-market.html'">
                                <i class="fas fa-hand-holding-usd"></i> Invest Now
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update Secondary Market UI
        function updateSecondaryMarketUI(listings) {
            const container = document.getElementById('secondaryMarketLoans');
            if (!container) return;
            
            if (!listings || listings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 40px; grid-column: 1 / -1;">No trading opportunities available at the moment</p>';
                return;
            }
            
            container.innerHTML = listings.map(listing => {
                const discount = listing.discount_percentage || 0;
                const discountColor = discount > 0 ? '#38e77b' : '#94a3b8';
                const remainingValue = listing.remaining_principal || listing.asking_price || 0;
                
                return `
                    <div class="portfolio-card" style="cursor: pointer;" onclick="window.location.href='secondary-market.html'">
                        <div class="card-header">
                            <div class="borrower-info">
                                <div class="borrower-avatar">${listing.seller_name ? listing.seller_name[0].toUpperCase() : 'S'}</div>
                                <div class="borrower-details">
                                    <div class="borrower-name">${listing.loan_purpose || 'Investment Opportunity'}</div>
                                    <div class="borrower-purpose">Seller: ${listing.seller_name || 'Anonymous'}</div>
                                    ${discount > 0 ? `<span class="risk-badge low" style="background: rgba(56, 231, 123, 0.1); color: #38e77b;">
                                        ${discount}% DISCOUNT
                                    </span>` : ''}
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="card-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">Asking Price</span>
                                    <span class="metric-value">$${parseFloat(listing.asking_price || 0).toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Original Value</span>
                                    <span class="metric-value">$${parseFloat(listing.original_investment || listing.asking_price || 0).toLocaleString()}</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Interest Rate</span>
                                    <span class="metric-value returns-positive">${parseFloat(listing.interest_rate || 0).toFixed(1)}% APR</span>
                                </div>
                            </div>

                            <div class="card-progress">
                                <div class="progress-info">
                                    <span>Remaining Term</span>
                                    <span>${listing.remaining_term || listing.term || 0} months</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${((listing.term - (listing.remaining_term || 0)) / listing.term * 100) || 50}%; background: #3b82f6;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-primary" style="width: 100%; padding: 10px; background: #3b82f6;" onclick="event.stopPropagation(); window.location.href='secondary-market.html'">
                                <i class="fas fa-exchange-alt"></i> Buy Investment
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show Market Error
        function showMarketError(containerId, message) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                    <i class="fas fa-exclamation-circle" style="font-size: 48px; color: #ef4444; margin-bottom: 15px;"></i>
                    <p style="color: #94a3b8; font-size: 16px;">${message}</p>
                    <button onclick="location.reload()" style="margin-top: 15px; padding: 10px 20px; background: #38e77b; color: white; border: none; border-radius: 8px; cursor: pointer;">
                        <i class="fas fa-redo"></i> Retry
                    </button>
                </div>
            `;
        }

        // ============================================
        // END MARKET DISPLAY FUNCTIONS
        // ============================================

        // Pagination System
        const paginationState = {
            transactions: { currentPage: 1, totalPages: 5, itemsPerPage: 6, totalItems: 30 },
            referrals: { currentPage: 1, totalPages: 2, itemsPerPage: 10, totalItems: 12 },
            secondaryMarket: { currentPage: 1, totalPages: 3, itemsPerPage: 5, totalItems: 15 },
            documents: { currentPage: 1, totalPages: 2, itemsPerPage: 5, totalItems: 8 },
            activeLoans: { currentPage: 1, totalPages: 2, itemsPerPage: 3, totalItems: 5 },
            walletTransactions: { currentPage: 1, totalPages: 3, itemsPerPage: 6, totalItems: 18 },
            myPortfolio: { currentPage: 1, totalPages: 3, itemsPerPage: 3, totalItems: 8 }
        };

        // Generic pagination function
        function changePage(section, direction) {
            const state = paginationState[section];
            
            if (direction === 'next' && state.currentPage < state.totalPages) {
                state.currentPage++;
            } else if (direction === 'prev' && state.currentPage > 1) {
                state.currentPage--;
            }
            
            // Update UI
            updatePaginationDisplay(section);
            
            // Show feedback
            console.log(`${section} - Page ${state.currentPage} of ${state.totalPages}`);
            
            // In a real app, this would fetch new data from the server
            // For now, we'll just show a visual feedback
            showPageChangeAnimation(section);
        }

        // Go to specific page
        function goToPage(section, pageNumber) {
            const state = paginationState[section];
            const page = parseInt(pageNumber);
            
            if (page >= 1 && page <= state.totalPages) {
                state.currentPage = page;
                updatePaginationDisplay(section);
                showPageChangeAnimation(section);
                console.log(`${section} - Jumped to page ${page}`);
            }
        }

        // Update pagination display
        function updatePaginationDisplay(section) {
            const state = paginationState[section];
            const paginationElements = document.querySelectorAll(`[data-pagination="${section}"]`);
            
            paginationElements.forEach(element => {
                // Update page number display
                const pageNumber = element.querySelector('[data-page-number]');
                if (pageNumber) {
                    pageNumber.textContent = state.currentPage;
                }
                
                // Update Previous button
                const prevBtn = element.querySelector('[data-prev-btn]');
                if (prevBtn) {
                    prevBtn.disabled = state.currentPage === 1;
                    prevBtn.style.opacity = state.currentPage === 1 ? '0.5' : '1';
                    prevBtn.style.cursor = state.currentPage === 1 ? 'not-allowed' : 'pointer';
                }
                
                // Update Next button
                const nextBtn = element.querySelector('[data-next-btn]');
                if (nextBtn) {
                    nextBtn.disabled = state.currentPage === state.totalPages;
                    nextBtn.style.opacity = state.currentPage === state.totalPages ? '0.5' : '1';
                    nextBtn.style.cursor = state.currentPage === state.totalPages ? 'not-allowed' : 'pointer';
                }
                
                // Update page number buttons
                const pageButtons = element.querySelectorAll('[data-page-btn]');
                pageButtons.forEach(btn => {
                    const btnPage = parseInt(btn.getAttribute('data-page-btn'));
                    if (btnPage === state.currentPage) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            });
        }

        // Show page change animation
        function showPageChangeAnimation(section) {
            // Add a subtle animation effect when changing pages
            const sectionElement = document.getElementById(`${section}-section`);
            if (sectionElement) {
                sectionElement.style.opacity = '0.7';
                setTimeout(() => {
                    sectionElement.style.opacity = '1';
                }, 200);
            }
        }

        // Initialize pagination on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Add data attributes and event listeners to pagination buttons
            initializePagination();
        });

        function initializePagination() {
            // This would be called after the DOM is fully loaded
            // to attach event listeners to all pagination buttons
            console.log('Pagination system initialized');
        }
    </script>

    <!-- Notification Panel Handler -->
    <script>
        // Toggle notification panel
        function toggleNotifications() {
            const panel = document.getElementById('notification-panel');
            panel.classList.toggle('active');
        }

        // Mark single notification as read
        function markAsRead(element) {
            element.classList.remove('unread');
            updateNotificationCount();
        }

        // Mark all notifications as read
        function markAllAsRead() {
            const unreadItems = document.querySelectorAll('.notification-item.unread');
            unreadItems.forEach(item => {
                item.classList.remove('unread');
            });
            updateNotificationCount();
        }

        // Update notification count badge
        function updateNotificationCount() {
            const unreadCount = document.querySelectorAll('.notification-item.unread').length;
            const badge = document.getElementById('notification-count');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        // View all notifications (placeholder)
        function viewAllNotifications() {
            console.log('View all notifications clicked');
            // In a real app, this would navigate to a full notifications page
            alert('This would open a full notifications page');
            toggleNotifications();
        }

        // Close notification panel when clicking outside
        document.addEventListener('click', function(event) {
            const panel = document.getElementById('notification-panel');
            const notificationBtn = document.getElementById('notification-btn');
            
            if (panel && notificationBtn) {
                const isClickInside = panel.contains(event.target) || notificationBtn.contains(event.target);
                
                if (!isClickInside && panel.classList.contains('active')) {
                    panel.classList.remove('active');
                }
            }
        });
    </script>

    <!-- Profile Picture Upload Handler -->
    <script>
        let currentProfileImage = null;

        // Handle file upload
        document.getElementById('profile-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Validate file size (5MB max)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    return;
                }

                // Validate file type
                if (!file.type.match('image.*')) {
                    alert('Please upload an image file (JPG, PNG, or GIF)');
                    return;
                }

                // Read and display the image
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentProfileImage = event.target.result;
                    updateProfilePicture(currentProfileImage);
                };
                reader.readAsDataURL(file);
            }
        });

        // Update profile picture in both locations
        function updateProfilePicture(imageUrl) {
            const profileAvatar = document.getElementById('profile-avatar');
            const navAvatar = document.getElementById('nav-avatar');
            const profileInitials = document.getElementById('profile-initials');
            const removeIconBtn = document.getElementById('remove-icon-btn');

            if (imageUrl) {
                // Set background image for profile avatar
                profileAvatar.style.backgroundImage = `url(${imageUrl})`;
                profileAvatar.style.backgroundSize = 'cover';
                profileAvatar.style.backgroundPosition = 'center';
                profileInitials.style.display = 'none';

                // Set background image for nav avatar
                navAvatar.style.backgroundImage = `url(${imageUrl})`;
                navAvatar.style.backgroundSize = 'cover';
                navAvatar.style.backgroundPosition = 'center';
                navAvatar.textContent = '';

                // Show remove icon button
                if (removeIconBtn) {
                    removeIconBtn.style.display = 'flex';
                }
            }
        }

        // Remove profile picture
        function removeProfilePicture() {
            const profileAvatar = document.getElementById('profile-avatar');
            const navAvatar = document.getElementById('nav-avatar');
            const profileInitials = document.getElementById('profile-initials');
            const removeIconBtn = document.getElementById('remove-icon-btn');

            // Reset to initials
            profileAvatar.style.backgroundImage = 'none';
            profileInitials.style.display = 'block';
            
            navAvatar.style.backgroundImage = 'none';
            navAvatar.textContent = 'TM';

            // Hide remove icon button
            if (removeIconBtn) {
                removeIconBtn.style.display = 'none';
            }

            currentProfileImage = null;
            document.getElementById('profile-upload').value = '';
            
            // Remove from localStorage
            localStorage.removeItem('profilePicture');
        }

        // Save profile picture (in real app, would upload to server)
        function saveProfilePicture() {
            if (currentProfileImage) {
                // In a real application, you would send this to your server
                console.log('Saving profile picture...');
                alert('Profile picture saved successfully!');
                // Store in localStorage for demo purposes
                localStorage.setItem('profilePicture', currentProfileImage);
            } else {
                alert('Please upload a picture first');
            }
        }

        // Load saved profile picture and check profile completion on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedImage = localStorage.getItem('profilePicture');
            if (savedImage) {
                currentProfileImage = savedImage;
                updateProfilePicture(savedImage);
            }

            // Check if user needs to complete profile registration
            checkProfileCompletion();
        });

        // Check if profile is completed and show banner if needed
        function checkProfileCompletion() {
            const profileCompleted = localStorage.getItem('profileCompleted');
            const isAuthenticated = localStorage.getItem('isAuthenticated');

            // Show banner if user is authenticated but profile is not completed
            if (isAuthenticated === 'true' && profileCompleted !== 'true') {
                showProfileCompletionBanner();
            }
        }

        // Show profile completion banner
        function showProfileCompletionBanner() {
            const banner = document.getElementById('profileCompletionBanner');
            if (banner) {
                banner.style.display = 'block';
            }
        }

        // Complete registration button
        function completeRegistration() {
            window.location.href = 'post-registration.html';
        }

        // Dismiss banner button
        function dismissBanner() {
            const banner = document.getElementById('profileCompletionBanner');
            if (banner) {
                banner.style.display = 'none';
            }
        }

        // ============================================
        // PROFILE MANAGEMENT FUNCTIONS
        // ============================================

        // Load user profile data
        async function loadUserProfile() {
            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    console.warn('No auth token found, skipping profile load');
                    return;
                }

                const response = await fetch('/api/profile', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success && data.data) {
                    populateProfileForm(data.data);
                    updateProfileCompletion(data.data.profile_completion || 0);
                } else {
                    console.warn('Failed to load profile:', data.message);
                    // Show some default values or prompt to complete profile
                    showProfileCompletionBanner();
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                // Keep existing mock data if API fails
            }
        }

        // Populate profile form with data
        function populateProfileForm(profile) {
            document.getElementById('firstName').value = profile.first_name || '';
            document.getElementById('lastName').value = profile.last_name || '';
            document.getElementById('email').value = profile.email || '';
            document.getElementById('phone').value = profile.phone || '';
            document.getElementById('dateOfBirth').value = profile.date_of_birth || '';
            document.getElementById('country').value = profile.country || '';

            // Update profile picture if available
            if (profile.profile_picture_url) {
                updateProfilePicture(profile.profile_picture_url);
            }

            // Update initials
            const firstName = profile.first_name || '';
            const lastName = profile.last_name || '';
            const initials = `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();
            document.getElementById('profile-initials').textContent = initials || 'TM';
        }

        // Save profile information
        async function saveProfileInfo() {
            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    alert('You must be logged in to save profile changes');
                    return;
                }

                const profileData = {
                    first_name: document.getElementById('firstName').value.trim(),
                    last_name: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    date_of_birth: document.getElementById('dateOfBirth').value,
                    country: document.getElementById('country').value
                };

                // Basic validation
                if (!profileData.first_name || !profileData.last_name) {
                    alert('First name and last name are required');
                    return;
                }

                const response = await fetch('/api/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(profileData)
                });

                const data = await response.json();

                if (data.success) {
                    alert('Profile updated successfully!');
                    // Reload profile data to reflect changes
                    loadUserProfile();
                } else {
                    alert('Failed to update profile: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving profile:', error);
                alert('Network error. Please try again.');
            }
        }

        // Upload profile picture
        async function saveProfilePicture() {
            if (!currentProfileImage) {
                alert('Please select an image first');
                return;
            }

            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    alert('You must be logged in to upload profile pictures');
                    return;
                }

                // Convert base64 to blob
                const response = await fetch(currentProfileImage);
                const blob = await response.blob();

                const formData = new FormData();
                formData.append('profilePicture', blob, 'profile-picture.jpg');

                const uploadResponse = await fetch('/api/profile/upload-picture', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                const data = await uploadResponse.json();

                if (data.success) {
                    alert('Profile picture updated successfully!');
                    // Update the UI with the new image URL
                    if (data.data && data.data.profile_picture_url) {
                        updateProfilePicture(data.data.profile_picture_url);
                    }
                } else {
                    alert('Failed to upload profile picture: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                alert('Network error. Please try again.');
            }
        }

        // Delete profile picture
        async function removeProfilePicture() {
            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    alert('You must be logged in to delete profile pictures');
                    return;
                }

                const response = await fetch('/api/profile/picture', {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert('Profile picture removed successfully!');
                    // Reset to initials
                    const profileAvatar = document.getElementById('profile-avatar');
                    const profileInitials = document.getElementById('profile-initials');
                    const removeIconBtn = document.getElementById('remove-icon-btn');

                    profileAvatar.style.backgroundImage = 'none';
                    profileInitials.style.display = 'block';
                    if (removeIconBtn) {
                        removeIconBtn.style.display = 'none';
                    }

                    currentProfileImage = null;
                    document.getElementById('profile-upload').value = '';
                } else {
                    alert('Failed to remove profile picture: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error removing profile picture:', error);
                alert('Network error. Please try again.');
            }
        }

        // Update profile completion status
        function updateProfileCompletion(percentage) {
            const completionBar = document.getElementById('completion-bar');
            const completionPercentage = document.getElementById('completion-percentage');
            const completionStatus = document.getElementById('completion-status');

            if (completionBar && completionPercentage && completionStatus) {
                // Update progress bar
                completionBar.style.width = `${percentage}%`;

                // Update percentage text
                completionPercentage.textContent = `${percentage}%`;

                // Update status badge
                let statusText, statusColor;
                if (percentage < 25) {
                    statusText = 'Getting Started';
                    statusColor = '#ef4444'; // red
                } else if (percentage < 50) {
                    statusText = 'Making Progress';
                    statusColor = '#f97316'; // orange
                } else if (percentage < 75) {
                    statusText = 'Almost There';
                    statusColor = '#eab308'; // yellow
                } else if (percentage < 100) {
                    statusText = 'Nearly Complete';
                    statusColor = '#22c55e'; // green
                } else {
                    statusText = 'Complete';
                    statusColor = '#38e77b'; // bright green
                }

                completionStatus.textContent = statusText;
                completionStatus.style.background = `rgba(${hexToRgb(statusColor)}, 0.1)`;
                completionStatus.style.color = statusColor;
            }

            console.log(`Profile completion: ${percentage}%`);
        }

        // Helper function to convert hex to rgb
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '56, 231, 123';
        }

        // ============================================
        // REAL API DATA LOADING FUNCTIONS
        // ============================================

        // Load user profile data
        async function loadUserProfile() {
            try {
                const response = await window.ZimCrowdAPI.getProfile();
                updateUserProfileUI(response);
            } catch (error) {
                console.error('Failed to load profile:', error);
                // Keep existing mock data if API fails
            }
        }

        // Load dashboard overview data
        async function loadDashboardOverview() {
            try {
                // Load wallet balance
                const walletResponse = await window.ZimCrowdAPI.getWalletBalance();
                updateWalletBalance(walletResponse);

                // Load recent loans
                const loansResponse = await window.ZimCrowdAPI.getLoans(1, 3);
                updateLoansOverview(loansResponse);

                // Load recent investments
                const investmentsResponse = await window.ZimCrowdAPI.getInvestments(1, 3);
                updateInvestmentsOverview(investmentsResponse);

                // Load primary market opportunities
                loadPrimaryMarketLoans();

                // Load secondary market opportunities
                loadSecondaryMarketLoans();

            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                // Keep existing mock data if API fails
            }
        }

        // Load Primary Market Loans
        async function loadPrimaryMarketLoans() {
            try {
                const response = await window.ZimCrowdAPI.getPrimaryMarketLoans(1, 6);
                
                if (response.success && response.data && response.data.loans) {
                    updatePrimaryMarketUI(response.data.loans);
                } else {
                    showMarketError('primaryMarketLoans', 'No investment opportunities available');
                }
            } catch (error) {
                console.error('Failed to load primary market:', error);
                showMarketError('primaryMarketLoans', 'Failed to load opportunities');
            }
        }

        // Load Secondary Market Loans
        async function loadSecondaryMarketLoans() {
            try {
                const response = await window.ZimCrowdAPI.getSecondaryMarketLoans(1, 6);
                
                if (response.success && response.data && response.data.listings) {
                    updateSecondaryMarketUI(response.data.listings);
                } else {
                    showMarketError('secondaryMarketLoans', 'No trading opportunities available');
                }
            } catch (error) {
                console.error('Failed to load secondary market:', error);
                showMarketError('secondaryMarketLoans', 'Failed to load opportunities');
            }
        }

        // Load loans data for loans section
        async function loadLoansData() {
            try {
                // Load loan statistics
                const statsResponse = await window.ZimCrowdAPI.getLoanStats();
                if (statsResponse.success) {
                    updateLoanStats(statsResponse.data);
                }

                // Load active loans
                const activeResponse = await window.ZimCrowdAPI.getMyLoans(1, 10, 'active');
                if (activeResponse.success) {
                    updateLoansList(activeResponse.data, 'active');
                }

                // Load completed loans
                const completedResponse = await window.ZimCrowdAPI.getMyLoans(1, 10, 'completed');
                if (completedResponse.success) {
                    updateLoansList(completedResponse.data, 'completed');
                }

                // Load pending applications
                const pendingResponse = await window.ZimCrowdAPI.getMyLoans(1, 10, 'pending');
                if (pendingResponse.success) {
                    updateLoansList(pendingResponse.data, 'pending');
                }
            } catch (error) {
                console.error('Failed to load loans:', error);
                showLoansError();
            }
        }

        // Update Loan Statistics
        function updateLoanStats(stats) {
            // Update stats cards
            document.getElementById('totalLoanAmount').textContent = `$${parseFloat(stats.totalLoanAmount || 0).toLocaleString()}`;
            document.getElementById('averageTerm').textContent = `${stats.averageTerm || 0} Months`;
            document.getElementById('averageInterest').textContent = `${stats.averageInterest || 0}%`;
            document.getElementById('activeLoansCount').textContent = `${stats.activeLoansCount || 0} Active`;

            // Update tab counts
            document.getElementById('activeLoansTabCount').textContent = stats.activeLoansCount || 0;
            document.getElementById('completedLoansTabCount').textContent = stats.completedLoansCount || 0;
            document.getElementById('pendingLoansTabCount').textContent = stats.pendingLoansCount || 0;
        }

        // Update Loans List
        function updateLoansList(loans, status) {
            const container = document.querySelector(`[data-loan-container="${status}"]`);
            if (!container) return;

            if (!loans || loans.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <i class="fas fa-inbox" style="font-size: 64px; color: #334155; margin-bottom: 20px;"></i>
                        <h3 style="color: #94a3b8; margin-bottom: 10px;">No ${status} loans</h3>
                        <p style="color: #64748b;">You don't have any ${status} loans at the moment.</p>
                        ${status === 'pending' ? '<button onclick="window.location.href=\'direct-loan-request.html\'" class="btn-primary" style="margin-top: 20px;"><i class="fas fa-plus"></i> Apply for Loan</button>' : ''}
                    </div>
                `;
                return;
            }

            container.innerHTML = loans.map(loan => {
                const statusLabel = status === 'active' ? 'Active' : status === 'completed' ? 'Completed' : 'Under Review';
                const statusColor = status === 'active' ? '#38e77b' : status === 'completed' ? '#38e77b' : '#f59e0b';
                const riskRating = loan.risk_rating || 'medium';
                const riskColor = riskRating === 'low' ? 'low' : riskRating === 'high' ? 'high' : 'medium';
                
                // Calculate progress
                const totalPaid = loan.loan_installments?.filter(i => i.status === 'paid').length || 0;
                const totalInstallments = loan.loan_installments?.length || loan.term || 1;
                const progressPercent = Math.round((totalPaid / totalInstallments) * 100);

                // Calculate next payment date
                const nextInstallment = loan.loan_installments?.find(i => i.status === 'pending');
                const nextPaymentDate = nextInstallment ? new Date(nextInstallment.due_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'N/A';

                // Calculate monthly payment
                const monthlyPayment = loan.monthly_payment || (loan.amount / loan.term).toFixed(2);

                return `
                    <div class="loan-card">
                        <div class="loan-header">
                            <div>
                                <h4>${loan.purpose || loan.loan_type || 'Personal Loan'}</h4>
                                <span class="loan-status" style="background: rgba(${statusColor === '#38e77b' ? '56, 231, 123' : statusColor === '#f59e0b' ? '245, 158, 11' : '239, 68, 68'}, 0.2); color: ${statusColor};">${statusLabel}</span>
                                <span class="risk-badge ${riskColor}">
                                    ${generateStarRating(loan.zimscore || 3.5)}
                                </span>
                            </div>
                            <div class="loan-amount">$${parseFloat(loan.amount || 0).toLocaleString()}</div>
                        </div>
                        <div class="loan-details">
                            <div class="detail-row">
                                <span>Monthly Payment</span>
                                <strong>$${parseFloat(monthlyPayment).toLocaleString()}</strong>
                            </div>
                            <div class="detail-row">
                                <span>Interest Rate</span>
                                <strong>${parseFloat(loan.interest_rate || 0).toFixed(1)}%</strong>
                            </div>
                            <div class="detail-row">
                                <span>Term</span>
                                <strong>${loan.term || 0} months</strong>
                            </div>
                            ${status === 'active' ? `
                            <div class="detail-row">
                                <span>Next Payment</span>
                                <strong>${nextPaymentDate}</strong>
                            </div>
                            ` : ''}
                        </div>
                        ${status !== 'pending' ? `
                        <div class="loan-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="progress-text">${progressPercent}% paid off</div>
                        </div>
                        ` : ''}
                        ${status === 'pending' ? `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #334155; display: flex; gap: 10px;">
                            <button class="btn-secondary" style="flex: 1;" onclick="viewLoanDetails('${loan.id}')">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                            <button class="btn-secondary" style="flex: 1; background: rgba(239, 68, 68, 0.1); color: #ef4444;" onclick="cancelLoanApplication('${loan.id}')">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Generate Star Rating HTML
        function generateStarRating(score) {
            const fullStars = Math.floor(score);
            const hasHalfStar = score % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let html = '';
            for (let i = 0; i < fullStars; i++) {
                html += '<i class="fas fa-star"></i>';
            }
            if (hasHalfStar) {
                html += '<i class="fas fa-star-half-alt"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                html += '<i class="far fa-star"></i>';
            }
            html += `<span class="rating-text">${score.toFixed(1)}/5</span>`;
            return html;
        }

        // Show Loans Error
        function showLoansError() {
            const containers = document.querySelectorAll('[data-loan-container]');
            containers.forEach(container => {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 64px; color: #ef4444; margin-bottom: 20px;"></i>
                        <h3 style="color: #94a3b8; margin-bottom: 10px;">Failed to load loans</h3>
                        <p style="color: #64748b;">Unable to fetch your loan data. Please try again.</p>
                        <button onclick="loadLoansData()" class="btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </div>
                `;
            });
        }

        // View Loan Details
        function viewLoanDetails(loanId) {
            // TODO: Implement loan details modal or navigate to details page
            alert(`View details for loan: ${loanId}`);
        }

        // Cancel Loan Application
        async function cancelLoanApplication(loanId) {
            if (!confirm('Are you sure you want to cancel this loan application?')) {
                return;
            }

            try {
                // TODO: Implement cancel endpoint
                alert('Loan application cancelled successfully');
                loadLoansData(); // Reload loans
            } catch (error) {
                console.error('Failed to cancel loan:', error);
                alert('Failed to cancel loan application');
            }
        }

        // Switch Loan Tab
        function switchLoanTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('#loans-section .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#loans-section .tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Load Wallet Data
        async function loadWalletData() {
            try {
                const statsResponse = await window.ZimCrowdAPI.getWalletStats();
                if (statsResponse.success) {
                    updateWalletStats(statsResponse.data);
                }
                const transactionsResponse = await window.ZimCrowdAPI.getWalletTransactions(1, 5);
                if (transactionsResponse.success) {
                    updateWalletTransactions(transactionsResponse.data);
                }
            } catch (error) {
                console.error('Failed to load wallet:', error);
            }
        }

        function updateWalletStats(stats) {
            document.getElementById('walletAvailableBalance').textContent = `$${parseFloat(stats.available_balance || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('walletPending').textContent = `$${parseFloat(stats.pending_balance || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('walletTotalTransactions').textContent = `$${parseFloat(stats.total_transactions_amount || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('walletThisMonth').textContent = `$${parseFloat(stats.this_month_amount || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}`;
        }

        function updateWalletTransactions(transactions) {
            const container = document.getElementById('walletRecentTransactions');
            if (!container || !transactions || transactions.length === 0) return;
            
            container.innerHTML = transactions.map(txn => {
                const isCredit = ['deposit', 'credit', 'loan_disbursement', 'investment_return'].includes(txn.type);
                const icon = isCredit ? 'fa-arrow-down' : 'fa-arrow-up';
                const color = isCredit ? '#38e77b' : '#ef4444';
                const prefix = isCredit ? '+' : '-';
                const date = new Date(txn.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                
                return `<div class="loan-card"><div style="display: flex; justify-content: space-between; align-items: center;"><div style="display: flex; align-items: center; gap: 15px;"><div style="width: 50px; height: 50px; background: rgba(${isCredit ? '56, 231, 123' : '239, 68, 68'}, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;"><i class="fas ${icon}" style="color: ${color};"></i></div><div><h4 style="margin-bottom: 5px;">${txn.description || 'Transaction'}</h4><p style="color: #94a3b8; font-size: 14px;">${date}</p></div></div><div style="text-align: right;"><div class="loan-amount" style="font-size: 20px; color: ${color};">${prefix}$${parseFloat(txn.amount).toLocaleString()}</div></div></div></div>`;
            }).join('');
        }

        // Load investments data
        async function loadInvestmentsData() {
            try {
                const portfolioResponse = await window.ZimCrowdAPI.getInvestmentPortfolio();
                if (portfolioResponse.success) {
                    updateInvestmentPortfolio(portfolioResponse.data);
                }
                const investmentsResponse = await window.ZimCrowdAPI.getInvestments(1, 20);
                if (investmentsResponse.success) {
                    updateInvestmentsList(investmentsResponse.data);
                }
                const statsResponse = await window.ZimCrowdAPI.getInvestmentStats();
                if (statsResponse.success) {
                    updatePerformanceStats(statsResponse.data);
                }
            } catch (error) {
                console.error('Failed to load investments:', error);
            }
        }

        function updateInvestmentPortfolio(data) {
            if (!data) return;
            document.getElementById('portfolioTotalInvested').textContent = `$${parseFloat(data.total_invested || 0).toLocaleString()}`;
            document.getElementById('portfolioAvgReturn').textContent = `${parseFloat(data.average_return || 0).toFixed(1)}%`;
            document.getElementById('portfolioActiveCount').textContent = data.active_count || 0;
            document.getElementById('portfolioTotalReturns').textContent = `$${parseFloat(data.total_returns || 0).toLocaleString()}`;
            document.getElementById('portfolioHeaderInvested').textContent = `$${parseFloat(data.total_invested || 0).toLocaleString('en-US', {minimumFractionDigits: 2})} Total Invested`;
            document.getElementById('portfolioHeaderReturns').textContent = `$${parseFloat(data.total_returns || 0).toLocaleString('en-US', {minimumFractionDigits: 2})} Total Returns`;
            document.getElementById('portfolioHeaderAvgReturn').textContent = `${parseFloat(data.average_return || 0).toFixed(1)}% Avg. Return`;
        }

        function updateInvestmentsList(investments) {
            const container = document.getElementById('portfolioCardsContainer');
            if (!container || !investments || investments.length === 0) return;
            
            container.innerHTML = investments.map(inv => {
                const initial = (inv.borrower_name || 'U').charAt(0).toUpperCase();
                const riskClass = inv.risk_rating === 'low' ? 'low' : inv.risk_rating === 'high' ? 'high' : 'medium';
                const progress = inv.progress_percentage || 0;
                const returns = inv.returns_amount || 0;
                const returnsPercent = inv.returns_percentage || 0;
                const returnsClass = returns >= 0 ? 'returns-positive' : 'returns-negative';
                
                return `<div class="portfolio-card"><div class="card-header"><div class="borrower-info"><div class="borrower-avatar">${initial}</div><div class="borrower-details"><div class="borrower-name">${inv.borrower_name || 'Anonymous'}</div><div class="borrower-purpose">${inv.loan_purpose || 'Loan'}</div><span class="risk-badge ${riskClass}">${generateStarRating(inv.zimscore || 3.5)}</span></div></div></div><div class="card-body"><div class="card-metrics"><div class="metric-item"><span class="metric-label">Principal</span><span class="metric-value">$${parseFloat(inv.amount || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}</span></div><div class="metric-item"><span class="metric-label">Returns</span><span class="metric-value ${returnsClass}">+$${parseFloat(returns).toLocaleString('en-US', {minimumFractionDigits: 2})} (${returnsPercent.toFixed(1)}%)</span></div><div class="metric-item"><span class="metric-label">Monthly Return</span><span class="metric-value">$${parseFloat(inv.monthly_return || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}</span></div></div><div class="card-progress"><div class="progress-info"><span>Progress</span><span>${progress}%</span></div><div class="progress-bar"><div class="progress-fill" style="width: ${progress}%"></div></div></div></div></div>`;
            }).join('');
        }

        // Update Performance Stats
        function updatePerformanceStats(data) {
            if (!data) return;
            
            // Update performance stats
            document.getElementById('perfTotalEarnings').textContent = `+$${parseFloat(data.total_earnings || 0).toLocaleString()}`;
            document.getElementById('perfThisMonth').textContent = `+$${parseFloat(data.this_month || 0).toLocaleString()}`;
            document.getElementById('perfAvgReturn').textContent = `${parseFloat(data.average_return || 0).toFixed(1)}%`;
            document.getElementById('perfOnTimePayments').textContent = `${parseFloat(data.on_time_payments || 100).toFixed(0)}%`;
            
            // Update risk distribution
            const riskDist = data.risk_distribution || {};
            const lowPercent = riskDist.low?.percentage || 0;
            const mediumPercent = riskDist.medium?.percentage || 0;
            const highPercent = riskDist.high?.percentage || 0;
            
            document.getElementById('riskLowPercent').textContent = `${lowPercent}%`;
            document.getElementById('riskLowBar').style.width = `${lowPercent}%`;
            document.getElementById('riskMediumPercent').textContent = `${mediumPercent}%`;
            document.getElementById('riskMediumBar').style.width = `${mediumPercent}%`;
            document.getElementById('riskHighPercent').textContent = `${highPercent}%`;
            document.getElementById('riskHighBar').style.width = `${highPercent}%`;
        }

        // Load Referrals Data
        async function loadReferralsData() {
            try {
                const statsResponse = await window.ZimCrowdAPI.getReferralStats();
                if (statsResponse.success) {
                    updateReferralStats(statsResponse.data);
                }
                
                const codeResponse = await window.ZimCrowdAPI.getReferralCode();
                if (codeResponse.success) {
                    updateReferralCode(codeResponse.data);
                }
                
                const historyResponse = await window.ZimCrowdAPI.getReferrals(1, 10);
                if (historyResponse.success) {
                    updateReferralHistory(historyResponse.data);
                }
            } catch (error) {
                console.error('Failed to load referrals:', error);
            }
        }

        function updateReferralStats(stats) {
            document.getElementById('refTotalReferrals').textContent = stats.total_referrals || 0;
            document.getElementById('refTotalEarnings').textContent = `$${parseFloat(stats.total_earnings || 0).toLocaleString()}`;
            document.getElementById('refActiveLoans').textContent = stats.active_loans_from_referrals || 0;
        }

        function updateReferralCode(data) {
            const code = data.referral_code;
            const shareUrl = data.share_url;
            const qrUrl = data.qr_code_url;
            
            document.getElementById('referralCodeDisplay').textContent = code;
            
            // Update QR code
            const qrContainer = document.getElementById('referralQRCode');
            qrContainer.innerHTML = `<img src="${qrUrl}" alt="Referral QR Code" style="width: 100%; height: 100%; border-radius: 12px;">`;
            
            // Setup share buttons
            document.getElementById('shareWhatsApp').onclick = () => {
                window.open(`https://wa.me/?text=Join ZimCrowd and get instant loans! Use my referral code: ${code} - ${shareUrl}`, '_blank');
            };
            
            document.getElementById('shareFacebook').onclick = () => {
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
            };
            
            document.getElementById('shareTwitter').onclick = () => {
                window.open(`https://twitter.com/intent/tweet?text=Join ZimCrowd with my referral code ${code}&url=${encodeURIComponent(shareUrl)}`, '_blank');
            };
            
            document.getElementById('shareEmail').onclick = () => {
                window.location.href = `mailto:?subject=Join ZimCrowd&body=Join ZimCrowd and get instant loans! Use my referral code: ${code} - ${shareUrl}`;
            };
            
            // Store code for copy function
            window.currentReferralCode = code;
        }

        function copyReferralCode() {
            const code = window.currentReferralCode || document.getElementById('referralCodeDisplay').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('Referral code copied to clipboard!');
            });
        }

        function updateReferralHistory(referrals) {
            const tbody = document.getElementById('referralHistoryTable');
            if (!tbody || !referrals || referrals.length === 0) {
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="5" style="padding: 40px; text-align: center; color: #94a3b8;">No referrals yet. Start sharing your code!</td></tr>';
                }
                return;
            }
            
            tbody.innerHTML = referrals.map(ref => {
                const statusColor = ref.status === 'active' ? '#38e77b' : '#f59e0b';
                const statusBg = ref.status === 'active' ? 'rgba(56, 231, 123, 0.1)' : 'rgba(245, 158, 11, 0.1)';
                const statusText = ref.status === 'active' ? 'Active' : 'Pending';
                const statusIcon = ref.status === 'active' ? 'fa-check-circle' : 'fa-clock';
                
                return `
                    <tr style="border-bottom: 1px solid #334155;">
                        <td style="padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #38e77b, #34d399); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">${ref.avatar || ref.name.substring(0, 2).toUpperCase()}</div>
                                <span>${ref.name}</span>
                            </div>
                        </td>
                        <td style="padding: 16px;">${ref.joined_date}</td>
                        <td style="padding: 16px;">
                            <span style="padding: 4px 12px; background: ${statusBg}; color: ${statusColor}; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                <i class="fas ${statusIcon}"></i> ${statusText}
                            </span>
                        </td>
                        <td style="padding: 16px;">${ref.loans_count} ${ref.loans_count === 1 ? 'loan' : 'loans'}</td>
                        <td style="padding: 16px; color: #38e77b; font-weight: 600;">$${parseFloat(ref.earnings || 0).toLocaleString()}</td>
                    </tr>
                `;
            }).join('');
        }

        // Transactions State
        let transactionsState = {
            currentPage: 1,
            limit: 10,
            totalPages: 1,
            totalCount: 0,
            typeFilter: '',
            dateFilter: '',
            allTransactions: []
        };

        // Load transactions data
        async function loadTransactionsData() {
            try {
                const response = await window.ZimCrowdAPI.getTransactions(transactionsState.currentPage, transactionsState.limit);
                if (response.success) {
                    const responseData = response.data;
                    transactionsState.allTransactions = responseData.transactions || responseData;
                    transactionsState.totalCount = responseData.pagination?.total || transactionsState.allTransactions.length;
                    transactionsState.totalPages = responseData.pagination?.pages || Math.ceil(transactionsState.totalCount / transactionsState.limit);
                    updateTransactionsSection(transactionsState.allTransactions);
                    updateTransactionsPagination();
                }
            } catch (error) {
                console.error('Failed to load transactions:', error);
                showTransactionsError();
            }
        }

        function updateTransactionsSection(transactions) {
            const container = document.getElementById('transactionsListContainer');
            if (!container) return;

            if (!transactions || transactions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <i class="fas fa-inbox" style="font-size: 64px; color: #334155; margin-bottom: 20px;"></i>
                        <h3 style="color: #94a3b8; margin-bottom: 10px;">No transactions found</h3>
                        <p style="color: #64748b;">Your transaction history will appear here.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = transactions.map(txn => {
                const isCredit = ['deposit', 'credit', 'loan_disbursement', 'investment_return', 'transfer_in'].includes(txn.type);
                const color = isCredit ? '#38e77b' : '#ef4444';
                const bgColor = isCredit ? 'rgba(56, 231, 123, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                const prefix = isCredit ? '+' : '-';
                
                const typeIcons = {
                    'deposit': 'fa-wallet',
                    'withdrawal': 'fa-money-bill-wave',
                    'loan_payment': 'fa-hand-holding-usd',
                    'loan_disbursement': 'fa-hand-holding-usd',
                    'investment': 'fa-chart-line',
                    'investment_return': 'fa-chart-line',
                    'transfer_in': 'fa-exchange-alt',
                    'transfer_out': 'fa-exchange-alt'
                };
                
                const typeLabels = {
                    'deposit': 'Wallet Deposit',
                    'withdrawal': 'Withdrawal',
                    'loan_payment': 'Loan Payment',
                    'loan_disbursement': 'Loan Disbursement',
                    'investment': 'Investment',
                    'investment_return': 'Investment Return',
                    'transfer_in': 'Transfer Received',
                    'transfer_out': 'Transfer Sent'
                };
                
                const icon = typeIcons[txn.type] || 'fa-exchange-alt';
                const label = typeLabels[txn.type] || txn.description || 'Transaction';
                const date = new Date(txn.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const status = txn.status || 'completed';
                const statusColor = status === 'completed' ? '#38e77b' : status === 'pending' ? '#f59e0b' : '#ef4444';
                const statusLabel = status.charAt(0).toUpperCase() + status.slice(1);
                
                return `
                    <div class="loan-card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 50px; height: 50px; background: ${bgColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas ${icon}" style="color: ${color};"></i>
                                </div>
                                <div>
                                    <h4 style="margin-bottom: 5px;">${label}</h4>
                                    <p style="color: #94a3b8; font-size: 14px;">${txn.description || ''}  ${date}</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 20px; font-weight: 700; color: ${color};">${prefix}$${parseFloat(txn.amount).toLocaleString('en-US', {minimumFractionDigits: 2})}</div>
                                <span style="font-size: 11px; color: ${statusColor}; background: rgba(${statusColor === '#38e77b' ? '56, 231, 123' : statusColor === '#f59e0b' ? '245, 158, 11' : '239, 68, 68'}, 0.1); padding: 4px 8px; border-radius: 4px;">${statusLabel}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateTransactionsPagination() {
            document.getElementById('transactionsCurrentPage').textContent = transactionsState.currentPage;
            document.getElementById('transactionsTotalPages').textContent = transactionsState.totalPages;
            document.getElementById('transactionsTotalCount').textContent = transactionsState.totalCount;
            
            const prevBtn = document.getElementById('transactionsPrevBtn');
            const nextBtn = document.getElementById('transactionsNextBtn');
            
            if (prevBtn) prevBtn.disabled = transactionsState.currentPage === 1;
            if (nextBtn) nextBtn.disabled = transactionsState.currentPage >= transactionsState.totalPages;
        }

        function changeTransactionsPage(direction) {
            if (direction === 'prev' && transactionsState.currentPage > 1) {
                transactionsState.currentPage--;
                loadTransactionsData();
            } else if (direction === 'next' && transactionsState.currentPage < transactionsState.totalPages) {
                transactionsState.currentPage++;
                loadTransactionsData();
            }
        }

        function filterTransactions() {
            const typeFilter = document.getElementById('transactionTypeFilter').value;
            const dateFilter = document.getElementById('transactionDateFilter').value;
            
            transactionsState.typeFilter = typeFilter;
            transactionsState.dateFilter = dateFilter;
            transactionsState.currentPage = 1;
            
            loadTransactionsData();
        }

        function exportTransactions() {
            const transactions = transactionsState.allTransactions;
            if (!transactions || transactions.length === 0) {
                alert('No transactions to export');
                return;
            }
            
            // Create CSV content
            const headers = ['Date', 'Type', 'Description', 'Amount', 'Status'];
            const csvRows = [headers.join(',')];
            
            transactions.forEach(txn => {
                const date = new Date(txn.created_at).toLocaleDateString('en-US');
                const type = txn.type || 'N/A';
                const description = (txn.description || '').replace(/,/g, ';');
                const amount = parseFloat(txn.amount).toFixed(2);
                const status = txn.status || 'completed';
                
                csvRows.push([date, type, description, amount, status].join(','));
            });
            
            const csvContent = csvRows.join('\\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transactions_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function showTransactionsError() {
            const container = document.getElementById('transactionsListContainer');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 64px; color: #ef4444; margin-bottom: 20px;"></i>
                        <h3 style="color: #94a3b8; margin-bottom: 10px;">Failed to load transactions</h3>
                        <p style="color: #64748b;">Unable to fetch your transaction history.</p>
                        <button onclick="loadTransactionsData()" class="btn-primary" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </div>
                `;
            }
        }

        // Settings Functions
        async function loadSettingsData() {
            try {
                const response = await window.ZimCrowdAPI.getProfile();
                if (response.success) {
                    populateProfileForm(response.data);
                    updateProfileCompletion(response.data);
                }
            } catch (error) {
                console.error('Failed to load settings:', error);
            }
        }

        function populateProfileForm(data) {
            // Personal Information
            if (document.getElementById('firstName')) document.getElementById('firstName').value = data.first_name || '';
            if (document.getElementById('lastName')) document.getElementById('lastName').value = data.last_name || '';
            if (document.getElementById('email')) document.getElementById('email').value = data.email || '';
            if (document.getElementById('phone')) document.getElementById('phone').value = data.phone || '';
            if (document.getElementById('dateOfBirth')) document.getElementById('dateOfBirth').value = data.date_of_birth || '';
            if (document.getElementById('country')) document.getElementById('country').value = data.country || '';
            
            // Address Information
            if (document.getElementById('streetAddress')) document.getElementById('streetAddress').value = data.street_address || '';
            if (document.getElementById('city')) document.getElementById('city').value = data.city || '';
            if (document.getElementById('suburb')) document.getElementById('suburb').value = data.suburb || '';
            if (document.getElementById('postalCode')) document.getElementById('postalCode').value = data.postal_code || '';
            
            // Profile Picture
            const initials = ((data.first_name || 'T').charAt(0) + (data.last_name || 'U').charAt(0)).toUpperCase();
            if (document.getElementById('profile-initials')) {
                document.getElementById('profile-initials').textContent = initials;
            }
        }

        function updateProfileCompletion(data) {
            const fields = ['first_name', 'last_name', 'email', 'phone', 'date_of_birth', 'country', 'street_address', 'city'];
            const completed = fields.filter(field => data[field] && data[field].trim() !== '').length;
            const percentage = Math.round((completed / fields.length) * 100);
            
            if (document.getElementById('completion-percentage')) {
                document.getElementById('completion-percentage').textContent = `${percentage}%`;
            }
            if (document.getElementById('completion-bar')) {
                document.getElementById('completion-bar').style.width = `${percentage}%`;
            }
            
            const status = percentage === 100 ? 'Complete' : percentage >= 75 ? 'Almost There' : percentage >= 50 ? 'In Progress' : 'Getting Started';
            if (document.getElementById('completion-status')) {
                document.getElementById('completion-status').textContent = status;
            }
        }

        async function saveProfileInfo() {
            const profileData = {
                first_name: document.getElementById('firstName')?.value,
                last_name: document.getElementById('lastName')?.value,
                email: document.getElementById('email')?.value,
                phone: document.getElementById('phone')?.value,
                date_of_birth: document.getElementById('dateOfBirth')?.value,
                country: document.getElementById('country')?.value,
                street_address: document.getElementById('streetAddress')?.value,
                city: document.getElementById('city')?.value,
                suburb: document.getElementById('suburb')?.value,
                postal_code: document.getElementById('postalCode')?.value
            };
            
            try {
                const response = await window.ZimCrowdAPI.updateProfile(profileData);
                if (response.success) {
                    alert('Profile updated successfully!');
                    updateProfileCompletion(profileData);
                } else {
                    alert('Failed to update profile: ' + (response.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Profile update error:', error);
                alert('Failed to update profile');
            }
        }

        function saveProfilePicture() {
            alert('Profile picture upload functionality will be implemented with backend integration');
        }

        function removeProfilePicture() {
            if (confirm('Are you sure you want to remove your profile picture?')) {
                const initials = document.getElementById('profile-initials');
                if (initials) {
                    document.getElementById('profile-avatar').innerHTML = `<span id="profile-initials">${initials.textContent}</span>`;
                }
                alert('Profile picture removed');
            }
        }

        function switchSettingsTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('#settings-section .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#settings-section .tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            event.target.classList.add('active');
            const tabContent = document.getElementById(tabName + '-tab');
            if (tabContent) {
                tabContent.classList.add('active');
            }
        }

        // Security Tab Functions
        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword')?.value;
            const newPassword = document.getElementById('newPassword')?.value;
            const confirmPassword = document.getElementById('confirmPassword')?.value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('Please fill in all password fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }
            
            if (newPassword.length < 8) {
                alert('Password must be at least 8 characters long');
                return;
            }
            
            try {
                const response = await window.ZimCrowdAPI.changePassword(currentPassword, newPassword);
                if (response.success) {
                    alert('Password changed successfully!');
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    alert('Failed to change password: ' + (response.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Password change error:', error);
                alert('Failed to change password');
            }
        }

        async function saveSecuritySettings() {
            const twoFactorEnabled = document.getElementById('twoFactorAuth')?.checked || false;
            
            try {
                const response = await window.ZimCrowdAPI.updateSecuritySettings({ two_factor_enabled: twoFactorEnabled });
                if (response.success) {
                    alert('Security settings saved successfully!');
                } else {
                    alert('Failed to save security settings');
                }
            } catch (error) {
                console.error('Security settings error:', error);
                alert('Failed to save security settings');
            }
        }

        // Notifications Tab Functions
        async function saveNotificationSettings() {
            const settings = {
                email_loan_reminders: document.getElementById('emailLoanReminders')?.checked || false,
                email_investment_returns: document.getElementById('emailInvestmentReturns')?.checked || false,
                email_loan_opportunities: document.getElementById('emailLoanOpportunities')?.checked || false,
                email_marketing: document.getElementById('emailMarketing')?.checked || false,
                push_transaction_alerts: document.getElementById('pushTransactionAlerts')?.checked || false,
                push_account_activity: document.getElementById('pushAccountActivity')?.checked || false,
                push_promotional: document.getElementById('pushPromotional')?.checked || false
            };
            
            try {
                const response = await window.ZimCrowdAPI.updateNotificationSettings(settings);
                if (response.success) {
                    alert('Notification preferences saved successfully!');
                } else {
                    alert('Failed to save notification preferences');
                }
            } catch (error) {
                console.error('Notification settings error:', error);
                alert('Failed to save notification preferences');
            }
        }

        // Display Tab Functions
        async function saveDisplaySettings() {
            const settings = {
                language: document.getElementById('displayLanguage')?.value || 'en',
                currency: document.getElementById('displayCurrency')?.value || 'USD',
                date_format: document.getElementById('displayDateFormat')?.value || 'DD/MM/YYYY',
                show_animations: document.getElementById('displayAnimations')?.checked || false,
                compact_view: document.getElementById('displayCompactView')?.checked || false
            };
            
            try {
                const response = await window.ZimCrowdAPI.updateDisplaySettings(settings);
                if (response.success) {
                    alert('Display settings saved successfully!');
                    // Optionally reload page to apply settings
                    // location.reload();
                } else {
                    alert('Failed to save display settings');
                }
            } catch (error) {
                console.error('Display settings error:', error);
                alert('Failed to save display settings');
            }
        }

        // Privacy Tab Functions
        async function savePrivacySettings() {
            const settings = {
                profile_visibility: document.getElementById('profileVisibility')?.value || 'public',
                show_portfolio: document.getElementById('showPortfolio')?.checked || false,
                show_loan_history: document.getElementById('showLoanHistory')?.checked || false,
                allow_messages: document.getElementById('allowMessages')?.checked || false,
                allow_cookies: document.getElementById('allowCookies')?.checked || false,
                share_data: document.getElementById('shareData')?.checked || false,
                third_party_analytics: document.getElementById('thirdPartyAnalytics')?.checked || false
            };
            
            try {
                const response = await window.ZimCrowdAPI.updatePrivacySettings(settings);
                if (response.success) {
                    alert('Privacy settings saved successfully!');
                } else {
                    alert('Failed to save privacy settings');
                }
            } catch (error) {
                console.error('Privacy settings error:', error);
                alert('Failed to save privacy settings');
            }
        }

        async function downloadMyData() {
            try {
                const response = await window.ZimCrowdAPI.downloadUserData();
                if (response.success) {
                    // Create download link
                    const blob = new Blob([JSON.stringify(response.data, null, 2)], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `zimcrowd_data_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                } else {
                    alert('Failed to download data');
                }
            } catch (error) {
                console.error('Download data error:', error);
                alert('Failed to download data');
            }
        }

        function deactivateAccount() {
            if (confirm('Are you sure you want to deactivate your account? You can reactivate it later by logging in.')) {
                alert('Account deactivation feature will be implemented with backend integration');
            }
        }

        function deleteAccount() {
            if (confirm(' WARNING: This will permanently delete your account and all data. This action cannot be undone. Are you absolutely sure?')) {
                const confirmation = prompt('Type "DELETE" to confirm account deletion:');
                if (confirmation === 'DELETE') {
                    alert('Account deletion feature will be implemented with backend integration');
                } else {
                    alert('Account deletion cancelled');
                }
            }
        }

        // Documents Tab Functions
        function uploadDocument(documentType) {
            alert(`Document upload for ${documentType} will be implemented with backend integration`);
        }

        // UI Update Functions
        function updateUserProfileUI(profileData) {
            if (!profileData || !profileData.success) return;

            const user = profileData.data;
            const userInfo = document.querySelector('.user-info');
            const headerUser = document.querySelector('.header-user');

            // Update sidebar user info
            if (userInfo) {
                const userDetails = userInfo.querySelector('.user-details h4');
                if (userDetails) {
                    userDetails.textContent = `${user.first_name || 'Test'} ${user.last_name || 'User'}`;
                }

                // Update avatar with initials
                const avatar = userInfo.querySelector('.user-avatar');
                if (avatar) {
                    const initials = `${(user.first_name || 'T')[0]}${(user.last_name || 'U')[0]}`.toUpperCase();
                    avatar.textContent = initials;
                }
            }

            // Update header user info
            if (headerUser) {
                const headerName = headerUser.querySelector('h4');
                const headerAvatar = headerUser.querySelector('.header-user-avatar');

                if (headerName) {
                    headerName.textContent = `${user.first_name || 'Test'} ${user.last_name || 'User'}`;
                }

                if (headerAvatar) {
                    const initials = `${(user.first_name || 'T')[0]}${(user.last_name || 'U')[0]}`.toUpperCase();
                    headerAvatar.textContent = initials;
                }
            }
        }

        function updateWalletBalance(walletData) {
            if (!walletData || !walletData.success) return;

            const data = walletData.data;
            
            // Update overview section stats
            const statsCards = document.querySelectorAll('#overview-section .stats-grid .stat-card h3');
            if (statsCards.length >= 1) {
                // Total Balance
                const totalBalance = (data.wallet1_balance || 0) + (data.wallet2_balance || 0);
                statsCards[0].textContent = `$${totalBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            // Update wallet section balances
            const wallet1Balance = document.querySelector('#wallet-section .stat-card:nth-child(1) h3');
            const wallet2Balance = document.querySelector('#wallet-section .stat-card:nth-child(2) h3');
            
            if (wallet1Balance) {
                wallet1Balance.textContent = `$${(data.wallet1_balance || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
            
            if (wallet2Balance) {
                wallet2Balance.textContent = `$${(data.wallet2_balance || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            console.log(' Wallet balance updated:', data);
        }

        function updateLoansOverview(loansData) {
            if (!loansData || !loansData.success) return;

            const loans = loansData.data.loans || [];
            const stats = loansData.data.stats || {};

            // Update overview section stats
            const statsCards = document.querySelectorAll('#overview-section .stats-grid .stat-card h3');
            if (statsCards.length >= 2) {
                // Total Loans (index 1)
                statsCards[1].textContent = `$${(stats.total_borrowed || 0).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            }
            if (statsCards.length >= 4) {
                // Active Loans count (index 3)
                statsCards[3].textContent = stats.active_loans || 0;
            }

            // Update loans section stats
            const loanStatsCards = document.querySelectorAll('#loans-section .stats-grid .stat-card h3');
            if (loanStatsCards.length >= 4) {
                loanStatsCards[0].textContent = `$${(stats.total_borrowed || 0).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
                loanStatsCards[1].textContent = `${stats.average_duration || 0} Months`;
                loanStatsCards[2].textContent = `${stats.average_interest_rate || 0}%`;
                loanStatsCards[3].textContent = `${stats.active_loans || 0} Active`;
            }

            console.log(' Loans overview updated:', stats);
        }

        function updateLoansSection(loansData) {
            if (!loansData || !loansData.success) return;

            const loans = loansData.data.loans || [];
            
            // Update active loans tab
            const activeTab = document.querySelector('#active-tab');
            if (activeTab && loans.length > 0) {
                const activeLoans = loans.filter(loan => loan.status === 'active' || loan.status === 'disbursed');
                
                if (activeLoans.length > 0) {
                    activeTab.innerHTML = activeLoans.map(loan => {
                        const paidPercentage = loan.amount_paid ? ((loan.amount_paid / loan.amount) * 100).toFixed(0) : 0;
                        
                        return `
                        <div class="loan-card">
                            <div class="loan-header">
                                <div>
                                    <h4>${loan.loan_type ? loan.loan_type.charAt(0).toUpperCase() + loan.loan_type.slice(1) : 'Personal'} Loan</h4>
                                    <span class="loan-status">${loan.status}</span>
                                </div>
                                <div class="loan-amount">$${parseFloat(loan.amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}</div>
                            </div>
                            <div class="loan-details">
                                <div class="detail-row">
                                    <span>Monthly Payment</span>
                                    <strong>$${(loan.amount / (loan.duration_months || 12)).toFixed(2)}</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Interest Rate</span>
                                    <strong>${loan.interest_rate || 0}%</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Term</span>
                                    <strong>${loan.duration_months || 12} months</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Next Payment</span>
                                    <strong>${loan.next_payment_date ? new Date(loan.next_payment_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'N/A'}</strong>
                                </div>
                            </div>
                            <div class="loan-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${paidPercentage}%"></div>
                                </div>
                                <div class="progress-text">${paidPercentage}% paid off</div>
                            </div>
                        </div>
                    `}).join('');
                } else {
                    activeTab.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 40px;">No active loans</p>';
                }
            }

            // Update tab counts
            const activeBtn = document.querySelector('.tab-btn:nth-child(1)');
            if (activeBtn) {
                const activeCount = loans.filter(l => l.status === 'active' || l.status === 'disbursed').length;
                activeBtn.textContent = `Active Loans (${activeCount})`;
            }

            const completedBtn = document.querySelector('.tab-btn:nth-child(2)');
            if (completedBtn) {
                const completedCount = loans.filter(l => l.status === 'completed' || l.status === 'paid').length;
                completedBtn.textContent = `Completed (${completedCount})`;
            }

            console.log(' Loans section updated with', loans.length, 'loans');
        }

        function updateInvestmentsOverview(investmentsData) {
            if (!investmentsData || !investmentsData.success) return;

            const investments = investmentsData.data.investments || [];
            const stats = investmentsData.data.stats || {};

            // Update overview section stats
            const statsCards = document.querySelectorAll('#overview-section .stats-grid .stat-card h3');
            if (statsCards.length >= 3) {
                // Investments (index 2)
                statsCards[2].textContent = `$${(stats.total_invested || 0).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            }

            console.log(' Investments overview updated:', stats);
        }

        function updateInvestmentPortfolio(portfolioData) {
            if (!portfolioData || !portfolioData.success) return;

            const data = portfolioData.data;
            const investments = data.investments || [];

            // Update investments section stats
            const investStatsCards = document.querySelectorAll('#investments-section .stats-grid .stat-card h3');
            if (investStatsCards.length >= 4) {
                investStatsCards[0].textContent = `$${(data.total_invested || 0).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                investStatsCards[1].textContent = `$${(data.total_returns || 0).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                investStatsCards[2].textContent = `${(data.roi || 0).toFixed(1)}%`;
                investStatsCards[3].textContent = `${data.active_investments || 0} Active`;
            }

            // Update active investments tab
            const activeInvestTab = document.querySelector('#active-investments-tab');
            if (activeInvestTab && investments.length > 0) {
                const activeInvestments = investments.filter(inv => inv.status === 'active');
                
                if (activeInvestments.length > 0) {
                    activeInvestTab.innerHTML = activeInvestments.map(inv => `
                        <div class="loan-card">
                            <div class="loan-header">
                                <div>
                                    <h4>Investment #${inv.investment_id?.substring(0, 8) || 'N/A'}</h4>
                                    <span class="loan-status">${inv.status}</span>
                                </div>
                                <div class="loan-amount">$${parseFloat(inv.amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}</div>
                            </div>
                            <div class="loan-details">
                                <div class="detail-row">
                                    <span>Expected Return</span>
                                    <strong>$${(inv.expected_return || 0).toFixed(2)}</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Interest Rate</span>
                                    <strong>${inv.interest_rate || 0}%</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Duration</span>
                                    <strong>${inv.duration_months || 0} months</strong>
                                </div>
                                <div class="detail-row">
                                    <span>Next Return</span>
                                    <strong>${inv.next_return_date ? new Date(inv.next_return_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : 'N/A'}</strong>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    activeInvestTab.innerHTML = '<p style="text-align: center; color: #94a3b8; padding: 40px;">No active investments</p>';
                }
            }

            console.log(' Investment portfolio updated with', investments.length, 'investments');
        }

        function updateTransactionsSection(transactionsData) {
            if (!transactionsData || !transactionsData.success) return;

            const transactions = transactionsData.data.transactions || [];

            // Update wallet transactions
            const walletTransactionsContainer = document.querySelector('#wallet-section .transaction-list');
            if (walletTransactionsContainer && transactions.length > 0) {
                walletTransactionsContainer.innerHTML = transactions.slice(0, 10).map(tx => {
                    const isCredit = tx.transaction_type === 'deposit' || tx.transaction_type === 'credit';
                    const icon = isCredit ? 'arrow-down' : 'arrow-up';
                    const iconClass = isCredit ? 'success' : 'danger';
                    
                    return `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(${isCredit ? '56, 231, 123' : '239, 68, 68'}, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-${icon}" style="color: ${isCredit ? '#38e77b' : '#ef4444'};"></i>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 5px;">${tx.description || tx.transaction_type}</h4>
                                <p style="color: #94a3b8; font-size: 14px;">${new Date(tx.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="loan-amount" style="font-size: 20px; color: ${isCredit ? '#38e77b' : '#ef4444'};">${isCredit ? '+' : '-'}$${parseFloat(tx.amount).toLocaleString('en-US', { minimumFractionDigits: 2 })}</div>
                        </div>
                    </div>
                `}).join('');
            }

            console.log(' Transactions updated with', transactions.length, 'transactions');
        }

        // Load referrals data
        async function loadReferralsData() {
            try {
                const [statsResponse, codeResponse, referralsResponse] = await Promise.all([
                    window.ZimCrowdAPI.getReferralStats(),
                    window.ZimCrowdAPI.getReferralCode(),
                    window.ZimCrowdAPI.getReferrals(1, 10)
                ]);

                updateReferralsSection(statsResponse, codeResponse, referralsResponse);
            } catch (error) {
                console.error('Failed to load referrals:', error);
            }
        }

        function updateReferralsSection(statsData, codeData, referralsData) {
            if (!statsData || !statsData.success) return;

            const stats = statsData.data;
            const code = codeData?.data?.referral_code || 'LOADING...';
            const referrals = referralsData?.data?.referrals || [];

            // Update stats cards
            const referralStatsCards = document.querySelectorAll('#referrals-section .stats-grid .stat-card h3');
            if (referralStatsCards.length >= 3) {
                referralStatsCards[0].textContent = stats.total_referrals || 0;
                referralStatsCards[1].textContent = `$${(stats.total_earnings || 0).toFixed(2)}`;
                referralStatsCards[2].textContent = stats.active_referrals || 0;
            }

            // Update referral code
            const codeElement = document.querySelector('#referrals-section .loan-card span[style*="font-size: 24px"]');
            if (codeElement) {
                codeElement.textContent = code;
                codeElement.setAttribute('data-code', code);
            }

            // Update referrals table
            const referralsTable = document.querySelector('#referrals-section table tbody');
            if (referralsTable && referrals.length > 0) {
                referralsTable.innerHTML = referrals.map(ref => `
                    <tr style="border-bottom: 1px solid #334155;">
                        <td style="padding: 16px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 40px; height: 40px; background: rgba(56, 231, 123, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <span style="font-weight: 600; color: #38e77b;">${ref.referred_user_name ? ref.referred_user_name.charAt(0).toUpperCase() : 'U'}</span>
                                </div>
                                <div>
                                    <h4 style="margin-bottom: 3px;">${ref.referred_user_name || 'Anonymous User'}</h4>
                                    <p style="color: #94a3b8; font-size: 13px;">${ref.referred_user_email || 'N/A'}</p>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 16px;">${new Date(ref.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</td>
                        <td style="padding: 16px;">
                            <span style="padding: 4px 12px; background: rgba(${ref.status === 'active' ? '56, 231, 123' : '245, 158, 11'}, 0.1); color: ${ref.status === 'active' ? '#38e77b' : '#f59e0b'}; border-radius: 12px; font-size: 12px; text-transform: capitalize;">
                                ${ref.status || 'pending'}
                            </span>
                        </td>
                        <td style="padding: 16px; color: #38e77b; font-weight: 600;">$${(ref.reward_earned || 0).toFixed(2)}</td>
                    </tr>
                `).join('');
            }

            console.log(' Referrals section updated with', referrals.length, 'referrals');
        }

        // Load notifications
        async function loadNotifications() {
            try {
                const response = await window.ZimCrowdAPI.getNotifications();
                updateNotifications(response);
            } catch (error) {
                console.error('Failed to load notifications:', error);
            }
        }

        function updateNotifications(notificationsData) {
            if (!notificationsData || !notificationsData.success) return;

            const notifications = notificationsData.data.notifications || [];
            const notificationsList = document.querySelector('#notification-panel .notification-list');

            if (notificationsList && notifications.length > 0) {
                notificationsList.innerHTML = notifications.slice(0, 5).map(notif => {
                    const iconMap = {
                        'loan': 'fa-hand-holding-usd',
                        'investment': 'fa-chart-line',
                        'payment': 'fa-credit-card',
                        'wallet': 'fa-wallet',
                        'security': 'fa-shield-alt',
                        'default': 'fa-bell'
                    };

                    const colorMap = {
                        'success': 'success',
                        'warning': 'warning',
                        'danger': 'danger',
                        'info': 'info'
                    };

                    const icon = iconMap[notif.type] || iconMap.default;
                    const color = colorMap[notif.priority] || 'info';

                    return `
                    <div class="notification-item ${notif.is_read ? 'read' : ''}" onclick="markAsRead(this, '${notif.notification_id}')">
                        <div class="notification-icon ${color}">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notif.title}</div>
                            <div class="notification-message">${notif.message}</div>
                            <div class="notification-time">${getTimeAgo(notif.created_at)}</div>
                        </div>
                    </div>
                `}).join('');
            }

            // Update notification count badge
            const unreadCount = notifications.filter(n => !n.is_read).length;
            const badge = document.querySelector('#notification-btn .notification-badge');
            if (badge) {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'flex' : 'none';
            }

            console.log(' Notifications updated:', unreadCount, 'unread');
        }

        // Helper function to get time ago
        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);

            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
            if (seconds < 604800) return `${Math.floor(seconds / 86400)} days ago`;
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        // Mark notification as read
        async function markAsRead(element, notificationId) {
            try {
                await window.ZimCrowdAPI.markNotificationRead(notificationId);
                element.classList.add('read');
                
                // Update badge count
                const badge = document.querySelector('#notification-btn .notification-badge');
                if (badge) {
                    const currentCount = parseInt(badge.textContent) || 0;
                    const newCount = Math.max(0, currentCount - 1);
                    badge.textContent = newCount;
                    badge.style.display = newCount > 0 ? 'flex' : 'none';
                }
            } catch (error) {
                console.error('Failed to mark notification as read:', error);
            }
        }

        function updateWalletTransactions(transactions) {
            const walletContainer = document.querySelector('#wallet-section .transaction-list');
            if (!walletContainer || !transactions.length) return;

            walletContainer.innerHTML = transactions.slice(0, 6).map(tx => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon ${tx.type === 'deposit' ? 'success' : tx.type === 'withdrawal' ? 'danger' : 'info'}">
                            <i class="fas fa-${tx.type === 'deposit' ? 'arrow-down' : tx.type === 'withdrawal' ? 'arrow-up' : 'exchange-alt'}"></i>
                        </div>
                        <div class="transaction-details">
                            <h4>${tx.description || tx.type}</h4>
                            <p>${new Date(tx.created_at).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="transaction-amount ${tx.type === 'deposit' ? 'positive' : 'negative'}">
                        ${tx.type === 'deposit' ? '+' : '-'}$${Math.abs(tx.amount).toFixed(2)}
                    </div>
                </div>
            `).join('');
        }

        function updateLoansSection(loansData) {
            if (!loansData || !loansData.success) return;

            const loans = loansData.data.loans || [];
            // Update loans section with more detailed data
            console.log('Updating loans section with', loans.length, 'loans');
        }

        function updateInvestmentPortfolio(portfolioData) {
            if (!portfolioData || !portfolioData.success) return;

            // Update investment portfolio section
            console.log('Updating investment portfolio');
        }

        function checkRegistrationCompletion() {
            // Check if user has completed all required registration steps
            const onboardingCompleted = localStorage.getItem('onboardingCompleted') === 'true';
            const socialSignupCompleted = localStorage.getItem('socialSignupCompleted') === 'true';

            // Only check for social signup users
            if (!socialSignupCompleted) {
                return; // Not a social signup user
            }

            // Check comprehensive completion status (this would be stored in user profile)
            // For now, we'll check localStorage flags that would be set by post-registration.html
            const profileCompleted = localStorage.getItem('profileCompleted') === 'true';
            const documentsUploaded = localStorage.getItem('documentsUploaded') === 'true';
            const employmentVerified = localStorage.getItem('employmentVerified') === 'true';
            const paymentSetup = localStorage.getItem('paymentSetup') === 'true';

            // Show red completion card if any required step is incomplete
            const allComplete = profileCompleted && documentsUploaded && employmentVerified && paymentSetup;

            if (!allComplete) {
                showCompletionMessageCard();
                limitAppFunctionality(); // Limit features for incomplete profiles
            } else {
                hideCompletionMessageCard();
                enableFullFunctionality();
            }
        }

        function limitAppFunctionality() {
            // Add visual indicators and disable certain features for incomplete profiles
            const body = document.body;

            // Add a banner or overlay indicating limited functionality
            if (!document.getElementById('limitedAccessBanner')) {
                const banner = document.createElement('div');
                banner.id = 'limitedAccessBanner';
                banner.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        background: rgba(239, 68, 68, 0.9);
                        color: white;
                        text-align: center;
                        padding: 10px;
                        z-index: 1000;
                        font-size: 14px;
                        border-bottom: 2px solid #dc2626;
                    ">
                        <i class="fas fa-exclamation-triangle"></i>
                        Complete your registration to unlock full access to ZimCrowd features
                    </div>
                `;
                body.insertBefore(banner, body.firstChild);

                // Add padding to body to account for banner
                body.style.paddingTop = '50px';
            }
        }

        function enableFullFunctionality() {
            // Remove limited access banner
            const banner = document.getElementById('limitedAccessBanner');
            if (banner) {
                banner.remove();
                document.body.style.paddingTop = '';
            }
        }

        function hideCompletionMessageCard() {
            const existingCard = document.getElementById('completionMessageCard');
            if (existingCard) {
                existingCard.remove();
            }
        }

        function completeRegistration() {
            // Redirect to comprehensive registration flow (profile, employment, payment details)
            window.location.href = 'post-registration.html';
        }

        // Handle OAuth callback and extract token from URL
        function handleAuthCallback() {
            // Check for token in URL hash (Supabase OAuth callback)
            const hashParams = new URLSearchParams(window.location.hash.substring(1));
            const accessToken = hashParams.get('access_token');
            
            if (accessToken) {
                console.log(' OAuth token found in URL hash, storing...');
                localStorage.setItem('authToken', accessToken);
                
                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
                return accessToken;
            }
            
            // Check for token in URL query params (alternative callback format)
            const queryParams = new URLSearchParams(window.location.search);
            const queryToken = queryParams.get('access_token');
            
            if (queryToken) {
                console.log(' OAuth token found in query params, storing...');
                localStorage.setItem('authToken', queryToken);
                
                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
                return queryToken;
            }
            
            // Check localStorage
            const storedToken = localStorage.getItem('authToken');
            if (storedToken) {
                console.log(' Auth token found in localStorage');
            }
            return storedToken;
        }

        // Initialize data loading on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Handle OAuth callback and get token
            const authToken = handleAuthCallback();
            
            if (authToken) {
                // User is authenticated, load real data
                window.ZimCrowdAPI.setToken(authToken);
                console.log(' Loading real data from backend...');

                // Load all dashboard data
                loadUserProfile(); // Use the new profile loading function
                loadDashboardOverview();
                loadLoansData();
                loadInvestmentsData();
                loadTransactionsData();
                loadReferralsData();
                loadNotifications();
            } else {
                console.log(' No auth token found, showing mock data');
                // Show login prompt or redirect to login
                if (confirm('You need to be logged in to view your dashboard. Go to login page?')) {
                    window.location.href = 'login.html';
                }
            }
        });
    </script>

    <!-- Font Awesome Icon Loading Check and Fallback -->
    <script>
        // Check if Font Awesome is loaded
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Test if Font Awesome is loaded by checking if icons have proper width
                const testIcon = document.createElement('i');
                testIcon.className = 'fas fa-check';
                testIcon.style.position = 'absolute';
                testIcon.style.left = '-9999px';
                document.body.appendChild(testIcon);
                
                const iconWidth = testIcon.offsetWidth;
                document.body.removeChild(testIcon);
                
                // If icon width is 0 or very small, Font Awesome didn't load
                if (iconWidth < 5) {
                    console.warn('Font Awesome icons not loading from CDN. Loading from alternative source...');
                    
                    // Try loading from jsDelivr CDN as backup
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = 'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css';
                    document.head.appendChild(link);
                    
                    // If still failing after 2 seconds, show alert
                    setTimeout(function() {
                        const testIcon2 = document.createElement('i');
                        testIcon2.className = 'fas fa-check';
                        testIcon2.style.position = 'absolute';
                        testIcon2.style.left = '-9999px';
                        document.body.appendChild(testIcon2);
                        
                        if (testIcon2.offsetWidth < 5) {
                            console.error('Font Awesome failed to load from all CDNs. Please check your internet connection or disable ad blockers.');
                            alert('Icons are not loading. Please:\n1. Check your internet connection\n2. Disable ad blockers\n3. Try refreshing the page (Ctrl+Shift+R)\n4. Or use a local server instead of opening the file directly');
                        } else {
                            console.log('Font Awesome loaded successfully from backup CDN');
                        }
                        document.body.removeChild(testIcon2);
                    }, 2000);
                } else {
                    console.log('Font Awesome icons loaded successfully');
                }
            }, 500);
        });
    </script>
</body>
</html>
